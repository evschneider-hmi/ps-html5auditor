import{r as m,j as t}from"./index-Dykb5sAM.js";const k=1024;function C(e){return e[0]===255&&e[1]===216&&e[2]===255?"jpeg":e.length>8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71?"png":e.length>6&&e[0]===71&&e[1]===73&&e[2]===70&&e[3]===56&&(e[4]===57||e[4]===55)&&e[5]===97?"gif":e.length>12&&e[0]===82&&e[1]===73&&e[2]===70&&e[3]===70&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80?"webp":"unknown"}function G(e){let r=0;for(let l=0;l<e.length;l++)if(e[l]===44&&(r++,r>1))return!0;return!1}function I(e){let r=8;for(;r+8<=e.length;){const l=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3];if(String.fromCharCode(e[r+4],e[r+5],e[r+6],e[r+7])==="acTL")return!0;r+=12+Math.max(0,l)}return!1}function R(e){if(e.length<16)return!1;let r=12;for(;r+8<=e.length;){const l=String.fromCharCode(e[r],e[r+1],e[r+2],e[r+3]),s=e[r+4]|e[r+5]<<8|e[r+6]<<16|e[r+7]<<24;if(l==="ANIM")return!0;r+=8+s+s%2}return!1}async function z(e){return new Promise((r,l)=>{try{const s=URL.createObjectURL(e),c=new Image;c.onload=()=>{try{URL.revokeObjectURL(s)}catch{}r({width:c.naturalWidth||c.width,height:c.naturalHeight||c.height})},c.onerror=()=>{try{URL.revokeObjectURL(s)}catch{}l(new Error("Failed to decode image"))},c.src=s}catch(s){l(s)}})}const U=()=>{const[e,r]=m.useState([]),l=m.useRef(null);async function s(n){if(!n||!n.length)return;const a=Array.from(n).filter(i=>/\.(jpe?g|png|gif|webp)$/i.test(i.name)),o=[];for(const i of a)try{const d=new Uint8Array(await i.arrayBuffer()),h=C(d),x=h==="gif"?G(d):h==="png"?I(d):h==="webp"?R(d):!1,{width:j,height:w}=await z(i),v=URL.createObjectURL(i),f={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,file:i,name:i.name,sizeBytes:i.size,type:h,width:j,height:w,animated:x,url:v};f.alerts=c(f),o.push(f)}catch(d){const h={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,file:i,name:i.name,sizeBytes:i.size,type:"unknown",alerts:[`Failed to analyze: ${d.message||String(d)}`]};o.push(h)}r(i=>[...i,...o])}function c(n){const a=[];if(n.type==="unknown"&&a.push("Unsupported or unrecognized image format (use JPG, PNG, or non-animated GIF)"),n.type==="gif"&&n.animated&&a.push("GIF appears animated — use a static JPG/PNG or non-animated GIF for static placements"),["webp"].includes(n.type)&&a.push("WebP may be unsupported in some ad servers — prefer JPG or PNG for static creatives"),n.width&&n.height){const o=n.name.match(/(\d{2,4})[xX](\d{2,4})/);if(o){const i=parseInt(o[1],10),d=parseInt(o[2],10);(i!==n.width||d!==n.height)&&a.push(`Filename size ${i}x${d} does not match actual ${n.width}x${n.height}`)}}else a.push("Could not determine image dimensions");return a}function p(n){r(a=>a.filter(o=>o.id!==n))}function g(){r([])}const u=e.map(n=>({...n,alerts:c(n)}));return t.jsxs("div",{children:[t.jsx("div",{role:"button",tabIndex:0,"aria-label":"Upload Static images",onClick:()=>{var n;return(n=l.current)==null?void 0:n.click()},onKeyDown:n=>{var a;(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),(a=l.current)==null||a.click())},onDragOver:n=>{n.preventDefault()},onDrop:n=>{n.preventDefault(),s(n.dataTransfer.files)},style:{border:"2px dashed var(--border)",borderRadius:12,padding:32,minHeight:320,background:"var(--surface)",color:"var(--text)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",outline:"none",transition:"background 120ms ease, border-color 120ms ease",marginBottom:12},children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:6},children:"Drop images or click anywhere to choose files"}),t.jsx("div",{style:{fontSize:12,opacity:.8},children:"Accept: .jpg, .jpeg, .png, .gif, .webp (multiple allowed)"}),t.jsx("input",{ref:l,type:"file",accept:".jpg,.jpeg,.png,.gif,.webp,image/*",multiple:!0,onChange:n=>void s(n.target.files),style:{display:"none"}})]})}),u.length>0&&t.jsx("div",{className:"panel",style:{padding:12,marginBottom:12},children:t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[t.jsx("div",{style:{fontSize:12,color:"var(--text-2)"},children:"Guidance: Use JPG or PNG for static creatives. GIF is allowed only if non-animated."}),t.jsx("div",{style:{flex:1}}),t.jsx("div",{children:t.jsx("button",{className:"btn",onClick:g,children:"Clear"})})]})}),u.length>0&&t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{className:"table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"File"}),t.jsx("th",{children:"Format"}),t.jsx("th",{children:"Dimensions"}),t.jsx("th",{children:"Size"}),t.jsx("th",{children:"Animated"}),t.jsx("th",{children:"Alerts"}),t.jsx("th",{children:"Preview"}),t.jsx("th",{})]})}),t.jsx("tbody",{children:u.map(n=>t.jsxs("tr",{children:[t.jsx("td",{title:n.name,style:{maxWidth:260,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.name}),t.jsx("td",{children:n.type.toUpperCase()}),t.jsx("td",{children:n.width&&n.height?`${n.width}x${n.height}`:"-"}),t.jsxs("td",{children:[Math.round((n.sizeBytes||0)/k)," KB"]}),t.jsx("td",{children:n.animated?"Yes":"No"}),t.jsx("td",{children:n.alerts&&n.alerts.length>0?t.jsxs("details",{children:[t.jsxs("summary",{style:{cursor:"pointer"},children:[n.alerts.length," issue",n.alerts.length>1?"s":""]}),t.jsx("ul",{style:{margin:0,paddingLeft:18},children:n.alerts.map((a,o)=>t.jsx("li",{style:{color:"#b91c1c"},children:a},o))})]}):t.jsx("span",{style:{color:"var(--ok)"},children:"OK"})}),t.jsx("td",{children:n.url?t.jsx("img",{src:n.url,alt:"preview",style:{maxHeight:60,border:"1px solid var(--border)",borderRadius:4}}):"-"}),t.jsx("td",{children:t.jsx("button",{className:"btn",onClick:()=>p(n.id),children:"Remove"})})]},n.id))})]})})]})};export{U as StaticCM360,U as default};
