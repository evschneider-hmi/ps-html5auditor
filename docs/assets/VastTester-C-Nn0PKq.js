import{R as Ze,c as Ht,r as h,j as t,_ as Wt}from"./index-Dykb5sAM.js";import{u as Ee}from"./ExtendedHome-Bj2mkDZV.js";import{p as Dt}from"./bulk-QCl06fV8.js";import{J as Ct}from"./jszip.min-CwPCxiH3.js";const Kt=[{vendor:"Innovid",test:n=>/(^|\.)innovid\.com$/i.test(n)},{vendor:"CM360",test:n=>/(^|\.)doubleclick\.net$/i.test(n)},{vendor:"DoubleVerify",test:n=>/(^|\.)doubleverify\.com$/i.test(n)||/(^|\.)dv\.tech$/i.test(n)},{vendor:"DISQO",test:n=>/(^|\.)activemetering\.com$/i.test(n)}];function Qt(n){try{const a=new URL(n);for(const[u,f]of a.searchParams.entries()){const x=f,b=x.match(/https?:\/\/[^\s'"<>]+/i);if(b)return b[0];try{const S=decodeURIComponent(x).match(/https?:\/\/[^\s'"<>]+/i);if(S)return S[0]}catch{}}}catch{}try{const a=String(n).match(/(?:click|url|dest|el)=([^&]+)/i);if(a&&a[1])try{const f=decodeURIComponent(a[1]).match(/https?:\/\/[^\s'"<>]+/i);if(f)return f[0]}catch{}}catch{}}function At(n){const a=Jt(n);if(!a)return{vendor:"Other",host:""};const u=a.toLowerCase();for(const f of Kt)try{if(f.test(u))return{vendor:f.vendor,host:u}}catch{}return{vendor:"Other",host:u}}function fe(n){const a=At(n);if(a.vendor==="Innovid"||a.vendor==="Other"){const u=Qt(n);if(u){const f=At(u);if(f.vendor!=="Other")return f}}return a}function Jt(n){try{const a=String(n).match(/https?:\/\/([^\s'"<>/]+)/i);return a&&a[1]?a[1]:/^\/\//.test(n)?new URL((location.protocol==="https:"?"https:":"http:")+n).host:new URL(n).host}catch{return""}}const Et=["ClickTracking","NonLinearClickTracking","CompanionClickTracking","IconClickTracking","ClickThrough","NonLinearClickThrough"],$t={CM360:{start:"impression"}};let et=null;async function Rt(){return et||(et=Wt(()=>import("./xlsx-Ao6DAF9L.js"),[],import.meta.url)),et}const Mt=/(\.xlsx|\.xlsm|\.xlsb|\.xls|\.csv)$/i,Ue=n=>n==null?"":String(n).trim(),Lt=n=>n.replace(/\s+/g," ").trim().toLowerCase(),tt=(n,a,u)=>{const f=[],x=new Set(["placement id","placementid","placement_id","placement name","placementname","platform","start date","startdate","end date","enddate","tag","vast url","vast","vasturl","ad tag","adtag","ad tag uri","adtaguri","ad tag url","adtag url","vast tag","vasttag","vast ad tag uri","vast ad tag url"]);return a.SheetNames.forEach(b=>{const E=a.Sheets[b];if(!E)return;const S=n.utils.sheet_to_json(E,{header:1,defval:"",raw:!1});if(!Array.isArray(S)||S.length===0)return;let W=0,J=-1;for(let $=0;$<Math.min(S.length,50);$++){const R=S[$];if(!Array.isArray(R))continue;const V=R.reduce((M,ne)=>{const me=Lt(Ue(ne));return M+(x.has(me)?1:0)},0);if(V>J&&(J=V,W=$),V>=4)break}const P=S[W].map($=>Ue($)),de=new Map;P.forEach(($,R)=>{const V=Lt($);V&&de.set(V,R)});const re=($,R)=>{for(const V of R){const M=de.get(V);if(M===void 0||M>=$.length)continue;const ne=Ue($[M]);if(ne)return ne}};for(let $=W+1;$<S.length;$++){const R=S[$];if(!R)continue;const V=R.map(Ue).filter(Boolean);let M=re(R,["vast url","vast","vasturl","tag","ad tag","adtag","ad tag uri","adtaguri","ad tag url","adtag url","vast tag","vasttag","vast ad tag uri","vast ad tag url"]);if(M||(M=V.find(ke=>/https?:\/\//i.test(ke)&&/(vast|adtag)/i.test(ke))),!M)continue;const ne=Dt(M),me=ne[0]?{...ne[0],raw:M}:{i:$,type:"VAST URL",raw:M,host:"",vendor:"",params:{}},$e=b?`${u} - ${b}`:u,Re={placementId:re(R,["placement id","placementid","placement_id"]),placementName:re(R,["placement name","placementname"]),platform:re(R,["platform"]),startDate:re(R,["start date","startdate"]),endDate:re(R,["end date","enddate"]),vastUrl:M,sourceLabel:`${$e} #${$+1}`};f.push({entry:me,meta:Re,source:"upload",key:`${$e}|${$+1}|${M}`})}}),f},hr=()=>{var wt;try{const e=((wt=Ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)==null?void 0:wt.ReactCurrentDispatcher)||Ze,r=Ht.version||"react-dom/client";console.debug("[VAST] React diag:",{reactVersion:Ze.version,domClient:r,idAType:typeof e})}catch{}const[n,a]=h.useState("url"),[u,f]=h.useState(""),[x,b]=h.useState(""),[E,S]=h.useState([]),[W,J]=h.useState([]),[P,de]=h.useState([]),[re,$]=h.useState([]),R=h.useRef(null),[V,M]=h.useState(!1),[ne,me]=h.useState(!1),[$e,Re]=h.useState(!1),[ke,st]=h.useState(!1),[Me,je]=h.useState({q25:!1,q50:!1,q75:!1,complete:!1}),[it,_e]=h.useState(void 0),[ge,ot]=h.useState(void 0),[ye,at]=h.useState(void 0),[F,we]=h.useState(""),[B,Te]=h.useState(""),[Y,ct]=h.useState(""),lt=h.useRef(null),[Le,Ce]=h.useState(0),[qe,Fe]=h.useState({}),[ir,dt]=h.useState(""),[or,ut]=h.useState(""),[ar,De]=h.useState(void 0),[ht,pt]=h.useState(""),[K,Be]=h.useState(""),[_,Xe]=h.useState(null),[It,Ie]=h.useState(!1),[Ve,ve]=h.useState([]),Vt=h.useCallback(e=>{ve(r=>r.filter(s=>Se(s)!==e))},[]),ue=h.useRef(null),[He,Nt]=h.useState(!1),[N,Ot]=h.useState(null),ft=h.useMemo(()=>N?Se(N):null,[N]),Ut=Ee(e=>e.vastSeed),zt=Ee(e=>e.setVastSeed),Pt=Ee(e=>e.setTagSeed),mt=He?u:"",We=h.useMemo(()=>Dt(mt).filter(e=>e.type==="VAST URL"),[mt]),gt=h.useMemo(()=>We.map((e,r)=>({entry:e,meta:{vastUrl:e.raw},source:"manual",key:`manual-${r}-${e.raw}`})),[We]),xe=h.useMemo(()=>[...gt,...Ve],[gt,Ve]),[_t,Ke]=h.useState({}),yt=h.useCallback(async e=>{var c,d,l,i,g;const r=(e==null?void 0:e.entry)||e;if(!r||!(r.type==="VAST URL"||r.type==="VAST XML"))return{imp:[],click:[],status:"error"};let s="";try{if(r.type==="VAST XML")s=String(r.raw||"");else{const y=String(r.raw||((c=e==null?void 0:e.meta)==null?void 0:c.vastUrl)||"");if(!/^https?:\/\//i.test(y))throw new Error("not a URL");const v=await fetch(y,{mode:"cors"});if(!v.ok)throw new Error("HTTP "+v.status);s=await v.text()}const o=new DOMParser,j=o.parseFromString(s,"application/xml");if(j.querySelector("parsererror"))throw new Error("parse error");const m=[j];try{const y=le(j,["VASTAdTagURI","AdTagURI"]).trim();if(y&&/^https?:\/\//i.test(y)){const v=await fetch(y,{mode:"cors"});if(v.ok){const I=await v.text(),q=o.parseFromString(I,"application/xml");q.querySelector("parsererror")||m.push(q)}}}catch{}const T=new Set,C=new Set;for(const y of m)ce(y,"Impression").forEach(v=>{const I=(v.textContent||"").trim();if(!I)return;const{vendor:q,host:Z}=fe(I);T.add(q==="Other"?Z||"Other":q)}),ce(y,"Tracking").forEach(v=>{const I=(v.textContent||"").trim();if(!I)return;const q=v.getAttribute&&v.getAttribute("event")?v.getAttribute("event").trim().toLowerCase():"",{vendor:Z,host:Ye}=fe(I),Ge=Z==="Other"?Ye||"Other":Z,Tt=($t[Ge]||{})[q];Tt==="impression"&&T.add(Ge),Tt==="click"&&C.add(Ge)}),Et.forEach(v=>{ce(y,v).forEach(I=>{const q=(I.textContent||"").trim();if(!q)return;const{vendor:Z,host:Ye}=fe(q);C.add(Z==="Other"?Ye||"Other":Z)})});const U=j.documentElement&&j.documentElement.getAttribute("version")||"",z=m[m.length-1];let oe="";const p=ce(z,"Linear");for(const y of p){const v=le(y,["Duration"]);if(v){oe=v;break}}const w=nt(oe),k=le(z,["AdTitle","Title","Ad Title"])||"",A=[],Q=Array.from(T).includes("CM360"),he=Array.from(C).includes("CM360"),ae=Array.from(T).includes("Innovid"),be=Array.from(C).includes("Innovid"),D=Array.from(T).includes("DoubleVerify")||Array.from(C).includes("DoubleVerify");if(Q||A.push("Missing CM360 Impression tracker"),he||A.push("Missing CM360 Click tracker"),ae||A.push("Missing Innovid Impression tracker"),be||A.push("Missing Innovid Click tracker"),D||A.push("Missing DoubleVerify tracker"),isFinite(w)){const y=Math.round(w),v=String(y),I=String(((d=e==null?void 0:e.meta)==null?void 0:d.placementName)||""),q=k||"",Z=new RegExp(`(^|\\D)${v}(s|sec|secs|seconds)?(\\D|$)`,"i");I&&!Z.test(I)&&A.push(`Duration ${y}s not found in placement name`),q&&!Z.test(q)&&A.push(`Duration ${y}s not found in creative name`)}else A.push("Duration tag missing or invalid");try{const y=String(((l=e==null?void 0:e.meta)==null?void 0:l.vastUrl)||((i=e==null?void 0:e.entry)==null?void 0:i.raw)||"");/live\s*stream(ing)?/i.test(String(((g=e==null?void 0:e.meta)==null?void 0:g.placementName)||""))&&/(^|\.)dvrtr\.com/i.test(y)&&A.push("Live Stream detected with dvrtr.com — consider using DV Universal Monitoring Pixel (viewability not tracked)")}catch{}return{imp:Array.from(T).sort(),click:Array.from(C).sort(),status:"ok",version:U,durationSec:isFinite(w)?w:void 0,creative:k,alerts:A}}catch{return{imp:[],click:[],status:"error"}}},[]);h.useEffect(()=>{let e=!1;return(async()=>{var r,s;for(const c of xe){if(e)return;const d=Se(c);if(!d||!(((r=c.entry)==null?void 0:r.type)==="VAST URL"||((s=c.entry)==null?void 0:s.type)==="VAST XML"))continue;Ke(i=>i[d]?i:{...i,[d]:{imp:[],click:[],status:"pending"}});const l=await yt(c);if(e)return;Ke(i=>({...i,[d]:{...i[d]||{},...l}}))}})(),()=>{e=!0}},[xe,yt]),We.length>1;const Qe=xe.length>0||Ve.length>0,qt=xe.length,Ne=h.useRef(null),se=[{key:"idx",label:"#",min:50},{key:"type",label:"Type",min:80},{key:"vendor",label:"Vendor",min:100},{key:"host",label:"Host",min:120},{key:"pid",label:"Placement ID",min:120},{key:"pname",label:"Placement Name",min:180},{key:"platform",label:"Platform",min:100},{key:"start",label:"Start Date",min:110},{key:"end",label:"End Date",min:110},{key:"url",label:"VAST URL",min:260},{key:"creative",label:"Creative",min:180,title:"Creative from <AdTitle> (Note: only one creative shown; rotations not enumerated)"},{key:"ver",label:"VAST Ver",min:90},{key:"dur",label:"Duration",min:90},{key:"imp",label:"Impression Vendors",min:180},{key:"click",label:"Click Vendors",min:180},{key:"params",label:"Other Params",min:220},{key:"alerts",label:"Alerts",min:80}],vt="vast_table_colw_v1";function Ft(e){const r={};if(!e||typeof e!="object"||Array.isArray(e))return r;const s=new Map(se.map(c=>[c.key,Math.max(c.min||60,40)]));for(const[c,d]of Object.entries(e)){const l=typeof d=="number"&&isFinite(d)?d:NaN,i=c;!isNaN(l)&&s.has(i)&&(r[i]=Math.max(l,s.get(i)))}return r}const[O,xt]=h.useState(()=>{try{const e=localStorage.getItem(vt);if(e)return Ft(JSON.parse(e))}catch{}return{}}),G=h.useRef(null);h.useEffect(()=>{try{localStorage.setItem(vt,JSON.stringify(O))}catch{}},[O]),h.useEffect(()=>{if(!Ne.current)return;let e=!1;try{e=O&&typeof O=="object"&&Object.keys(O).length>0}catch{e=!1}if(e)return;const r=Ne.current.querySelectorAll("thead th[data-colkey]"),s={};r.forEach(c=>{const d=c.getAttribute("data-colkey")||"";if(!d)return;const l=se.find(o=>o.key===d),i=Math.max((l==null?void 0:l.min)||60,40),g=c.getBoundingClientRect().width;s[d]=Math.max(g|0,i)}),Object.keys(s).length&&xt(s)},[]),h.useEffect(()=>{function e(s){if(!G.current)return;s.preventDefault();const c=s.clientX-G.current.startX,d=G.current.startW,l=G.current.min,i=G.current.neighborStartW,g=G.current.neighborMin;let o=Math.max(d+c,l),j=i-c;if(j<g){const m=i-g;o=Math.max(d+m,l),j=g}xt(m=>({...m,[G.current.key]:o,[G.current.neighborKey]:j}))}function r(){G.current=null,document.body.style.cursor=""}return window.addEventListener("mousemove",e),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",r)}},[]);const L={padding:8,verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},bt=h.useCallback(async e=>{if(!e||e.length===0)return;const r=Array.from(e),s=await Rt(),c=[],d=[],l=[];for(const i of r)try{if(/\.zip$/i.test(i.name)){const g=await Ct.loadAsync(await i.arrayBuffer());let o=0;const j=Object.values(g.files).filter(m=>!m.dir&&Mt.test(m.name));for(const m of j){const T=/\.csv$/i.test(m.name),C=await m.async(T?"string":"arraybuffer"),U=s.read(C,{type:T?"string":"array",raw:!1,cellDates:!0}),z=tt(s,U,`${i.name} - ${m.name}`);o+=z.length,c.push(...z)}d.push(o?`Extracted ${o} VAST tags from ${i.name}`:`No VAST tags detected in ${i.name}`)}else if(Mt.test(i.name)){const g=/\.csv$/i.test(i.name),o=g?await i.text():await i.arrayBuffer(),j=s.read(o,{type:g?"string":"array",raw:!1,cellDates:!0}),m=tt(s,j,i.name);c.push(...m),d.push(m.length?`Extracted ${m.length} VAST tags from ${i.name}`:`No VAST tags detected in ${i.name}`)}else l.push(`Unsupported file type: ${i.name}`)}catch(g){const o=g&&g.message?g.message:String(g);l.push(`Failed to parse ${i.name}: ${o}`)}c.length&&ve(i=>[...i,...c]),d.length&&de(i=>[...i,...d]),l.length&&S(i=>[...i,...l]),ue.current&&(ue.current.value="")},[S,de,ve]),Bt=h.useCallback(()=>{ve([]),ue.current&&(ue.current.value="")},[ve]),Oe=Ee(e=>e.vastAutoPayload);Ee(e=>e.setVastAutoPayload),h.useEffect(()=>{let e=!1;return(async()=>{try{if(!Oe||!(Oe instanceof Uint8Array))return;const r=await Rt(),s=await Ct.loadAsync(Oe),c=Object.values(s.files).filter(l=>!l.dir&&/\.(xlsx|xlsm|xls|csv)$/i.test(l.name)),d=[];for(const l of c){const i=/\.csv$/i.test(l.name),g=await l.async(i?"string":"arraybuffer"),o=r.read(g,{type:i?"string":"array",raw:!1,cellDates:!0}),j=tt(r,o,l.name);d.push(...j)}!e&&d.length&&ve(l=>[...l,...d])}catch{}})(),()=>{e=!0}},[Oe]);const St=e=>{const r=(e==null?void 0:e.entry)||e;if(r){if(Ot(e),r.type==="VAST URL"){a("url"),f(r.raw);try{kt(!0,r.raw)}catch{}return}if(r.type==="VAST XML"){a("xml"),b(r.raw);try{kt(!0)}catch{}return}if(r.type==="Ad Tag"){try{Pt(r.raw)}catch{}try{const s=Array.from(document.querySelectorAll(".tabs .tab")).find(c=>{var d;return((d=c.textContent)==null?void 0:d.trim())==="Ad Tag"});s==null||s.click()}catch{}}}};h.useEffect(()=>{try{const e=Ut;e&&e.value&&(e.mode==="xml"?(a("xml"),b(e.value)):(a("url"),f(e.value)),zt(void 0))}catch{}},[]);function X(e){const r=new Date,s=`${Je(r.getHours())}:${Je(r.getMinutes())}:${Je(r.getSeconds())}:${Xt(r.getMilliseconds())}`;$(c=>[...c,{time:s,label:e}])}function Je(e){return e<10?`0${e}`:String(e)}function Xt(e){return e.toString().padStart(3,"0")}async function kt(e,r){var c,d;S([]),J([]),de([]),$([]),je({q25:!1,q50:!1,q75:!1,complete:!1}),M(!1),me(!1),Re(!1),st(!1),pt(""),Be(""),Xe(null),Ie(!1),_e(void 0),at(void 0),we(""),Te(""),ct(""),Fe({}),dt(""),ut(""),De(void 0);let s=x.trim();if(n==="url"){const l=String(r||u||"").trim();if(!/^https?:\/\//i.test(l)){S(["Please enter a valid http(s) URL"]);return}try{ot(performance.now()),X("request");const i=await fetch(l,{mode:"cors"});if(!i.ok)throw new Error(`HTTP ${i.status}`);s=await i.text(),we(s),Te(ze(s))}catch(i){S([`Failed to fetch VAST: ${i.message||String(i)} (CORS may block some tags)`]);return}}if(!s.startsWith("<"))if(/^https?:\/\//i.test(s))try{ot(performance.now()),X("request");const l=await fetch(s,{mode:"cors"});if(!l.ok)throw new Error(`HTTP ${l.status}`);s=await l.text(),we(s),Te(ze(s))}catch(l){S([`Failed to fetch VAST: ${l.message||String(l)} (CORS may block some tags)`]);return}else{S(["Input does not look like XML. Start tag '<' not found."]);return}try{F||we(s),B||Te(ze(s));const l=new DOMParser,i=l.parseFromString(s,"application/xml"),g=i.querySelector("parsererror");if(g){S([g.textContent||"XML parse error"]);return}const o=i.documentElement.nodeName.toLowerCase();o!=="vast"&&P.push(`Root <${o}>`);const j=(d=(c=i.querySelector("VASTAdTagURI, AdTagURI"))==null?void 0:c.textContent)==null?void 0:d.trim();if(j&&/^https?:\/\//i.test(j))try{X("request");const m=await fetch(j,{mode:"cors"});if(m.ok){const T=await m.text();we(T),Te(ze(T));const C=l.parseFromString(T,"application/xml");if(C.querySelector("parsererror"))Ae(i);else{Ae(C);const z=rt(C)||rt(i)||"";Be(oe=>oe||z)}}else Ae(i)}catch{Ae(i)}else Ae(i);de([...P])}catch(l){S([l.message||"Failed to parse"])}}function ie(e){Fe(r=>{const s=nr(r,e);try{const c=(s[e]||[]).filter(d=>d.status==="requested").map(d=>d.url);rr(c)}catch{}return s})}function Ae(e){var C,U,z,oe;const r=ce(e,"Impression");P.push(`Impressions: ${r.length}`);const s={};function c(p,w){if(!w)return;const k=w.trim();k&&(s[p]||(s[p]=[]),s[p].some(A=>A.url===k)||s[p].push({url:k}))}r.forEach(p=>c("impression",p.textContent));const d=le(e,["ClickThrough","NonLinearClickThrough"]);d&&c("clickThrough",d),Et.forEach(p=>{ce(e,p).forEach(w=>c("click",w.textContent))}),ce(e,"Tracking").forEach(p=>{const w=p.getAttribute&&p.getAttribute("event")?p.getAttribute("event").trim():"";c(w||"tracking",p.textContent)});try{Object.entries(s).forEach(([p,w])=>{w.forEach(({url:k})=>{const{vendor:A,host:Q}=fe(k),ae=($t[A==="Other"?Q||"Other":A]||{})[String(p).trim().toLowerCase()];ae&&c(ae,k)})})}catch{}const l={};Object.keys(s).forEach(p=>{l[p]=s[p].map(w=>({url:w.url}))}),Fe(l);const i=Array.from(e.querySelectorAll("Linear MediaFile"));let g,o=0;for(const p of i){const w=(p.textContent||"").trim(),k=(p.getAttribute("type")||"").toLowerCase(),A=k.includes("mp4")?2:k.includes("webm")?1:0;w&&(g===void 0||A>o)&&(g=w,o=A)}!g&&i.length>0&&(g=(i[0].textContent||"").trim()),g&&pt(g),P.push(`MediaFiles: ${i.length}${g?" (selected)":""}`);const j=((C=e.querySelector("Linear > Duration"))==null?void 0:C.textContent)||"",m=nt(j);if(isFinite(m))_e(m),De(m);else{let p="";const w=ce(e,"Linear");for(const A of w){const Q=le(A,["Duration"]);if(Q){p=Q;break}}const k=nt(p);isFinite(k)?(_e(k),De(k)):De(void 0)}const T=rt(e)||"";if(Be(T),T){P.push("ClickThrough detected");try{Yt(T).then(p=>{Xe(p)}).catch(()=>{const p=Pe(T)||T;Xe({status:"error",initial:p})})}catch{}}try{const p=le(e,["AdTitle","Title","Ad Title"])||"";p&&(dt(p),P.push(`Creative: ${p} (Note: only one creative shown; rotations not enumerated)`))}catch{}try{const p=e.documentElement&&e.documentElement.getAttribute("version")||"";p&&(ut(p),P.push(`VAST version: ${p}`))}catch{}try{const p=new Set,w=new Set;(l.impression||[]).forEach(D=>{const{vendor:y,host:v}=fe(D.url);p.add(y==="Other"?v||"Other":y)}),(l.click||[]).forEach(D=>{const{vendor:y,host:v}=fe(D.url);w.add(y==="Other"?v||"Other":y)});const k=[],A=p.has("CM360"),Q=w.has("CM360"),he=p.has("Innovid"),ae=w.has("Innovid"),be=p.has("DoubleVerify")||w.has("DoubleVerify");if(A||k.push("Missing CM360 Impression tracker"),Q||k.push("Missing CM360 Click tracker"),he||k.push("Missing Innovid Impression tracker"),ae||k.push("Missing Innovid Click tracker"),be||k.push("Missing DoubleVerify tracker"),isFinite(m)){const D=Math.round(m),y=new RegExp(`(^|\\D)${D}(s|sec|secs|seconds)?(\\D|$)`,"i"),v=String(((U=N==null?void 0:N.meta)==null?void 0:U.placementName)||""),I=le(e,["AdTitle","Title","Ad Title"])||"";v&&!y.test(v)&&k.push(`Duration ${D}s not found in placement name`),I&&!y.test(I)&&k.push(`Duration ${D}s not found in creative name`)}else k.push("Duration tag missing or invalid");try{const D=String(((z=N==null?void 0:N.meta)==null?void 0:z.vastUrl)||u||"");/live\s*stream(ing)?/i.test(String(((oe=N==null?void 0:N.meta)==null?void 0:oe.placementName)||""))&&/(^|\.)dvrtr\.com/i.test(D)&&k.push("Live Stream detected with dvrtr.com — consider using DV Universal Monitoring Pixel (viewability not tracked)")}catch{}J(k);try{const D=N?Se(N):"";if(D){const y=e.documentElement&&e.documentElement.getAttribute("version")||"";let v;try{isFinite(m)&&(v=m)}catch{}Ke(I=>({...I,[D]:{imp:Array.from(p),click:Array.from(w),status:"ok",version:y,durationSec:v,creative:le(e,["AdTitle","Title","Ad Title"])||"",alerts:k}}))}}catch{}}catch{}}h.useEffect(()=>{const e=R.current;if(!e)return;let r=!1,s=!1,c=!1;function d(){V||(M(!0),X("started"),ie("start"))}function l(){!ye&&ge!==void 0&&(at(performance.now()),X("impression"),ie("impression"),ie("creativeView"))}function i(){me(!0),X("pause"),ie("pause")}function g(){je(m=>({...m,complete:!0})),X("complete"),ie("complete")}function o(){try{const m=it||e.duration||0,T=e.currentTime;!r&&m>0&&T>=m*.25&&(r=!0,je(C=>({...C,q25:!0})),X("firstQuartile"),ie("firstQuartile")),!s&&m>0&&T>=m*.5&&(s=!0,je(C=>({...C,q50:!0})),X("midpoint"),ie("midpoint")),!c&&m>0&&T>=m*.75&&(c=!0,je(C=>({...C,q75:!0})),X("thirdQuartile"),ie("thirdQuartile"))}catch{}}function j(){ke||(st(!0),X("audio toggle"))}return e.addEventListener("play",d),e.addEventListener("playing",l),e.addEventListener("pause",i),e.addEventListener("ended",g),e.addEventListener("timeupdate",o),e.addEventListener("volumechange",j),()=>{e.removeEventListener("play",d),e.removeEventListener("playing",l),e.removeEventListener("pause",i),e.removeEventListener("ended",g),e.removeEventListener("timeupdate",o),e.removeEventListener("volumechange",j)}},[it,V,ye,ge]);const jt=h.useMemo(()=>ge!==void 0&&ye!==void 0?Math.round(ye-ge):void 0,[ge,ye]);return h.useEffect(()=>{try{const e=lt.current;if(!e)return;const r=pe(B||F||"",Y);if(r<=0)return;const s=(Le%r+r)%r,c=e.querySelector(`#xml-match-${s}`);if(c){const d=e.parentElement||e,l=d.getBoundingClientRect(),g=c.getBoundingClientRect().top-l.top,o=Math.max(60,Math.round(d.clientHeight*.25));d.scrollTo({top:Math.max(d.scrollTop+g-o,0),behavior:"smooth"})}}catch{}},[Le,Y,B,F]),t.jsxs("div",{children:[t.jsxs("div",{className:"panel",style:{padding:8,marginTop:8},children:[t.jsx("div",{role:"button",tabIndex:0,onClick:()=>{var e;return(e=ue.current)==null?void 0:e.click()},onKeyDown:e=>{var r;(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),(r=ue.current)==null||r.click())},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.background="var(--surface-2)"},onDragLeave:e=>{e.preventDefault(),e.currentTarget.style.background="var(--surface)"},onDrop:e=>{e.preventDefault(),e.currentTarget.style.background="var(--surface)",bt(e.dataTransfer.files)},style:{border:"2px dashed var(--border)",borderRadius:12,padding:32,minHeight:320,background:"var(--surface)",color:"var(--text)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",cursor:"pointer",outline:"none"},children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:6},children:"Drop Excel/CSV/Zip or click anywhere to choose files"}),t.jsx("div",{style:{fontSize:14,opacity:.85,marginBottom:6},children:"Accept: .xlsx, .xlsm, .xls, .csv, .zip (multiple allowed)"}),t.jsx("input",{type:"file",ref:ue,accept:".xlsx,.xlsm,.xls,.csv,.zip",multiple:!0,onChange:e=>bt(e.target.files),style:{display:"none"}})]})}),t.jsx("div",{style:{marginTop:10},children:t.jsx("button",{type:"button",className:"btn",onClick:()=>Nt(e=>!e),children:He?"Hide VAST URL entry":"Enter VAST URL"})}),He&&t.jsx("div",{style:{marginTop:8},children:t.jsx("input",{value:u,onChange:e=>f(e.target.value),placeholder:"Paste one or more VAST URLs (newline separated)",style:{width:"100%",padding:8,border:"1px solid var(--border)",borderRadius:6,fontFamily:"monospace",fontSize:12,background:"var(--surface)",color:"var(--text)"}})}),Ve.length>0&&t.jsx("div",{style:{marginTop:8},children:t.jsx("button",{type:"button",className:"btn",onClick:()=>{Bt()},children:"Clear Uploads"})}),!Qe&&E.length>0&&t.jsxs("div",{className:"panel",style:{padding:8,marginTop:8},children:[t.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:6},children:"Upload Errors"}),t.jsx("ul",{style:{fontFamily:"monospace",fontSize:11,background:"var(--surface-2)",color:"var(--text)",padding:6,borderRadius:6,border:"1px solid var(--border)"},children:E.map((e,r)=>t.jsx("li",{style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.3)",margin:"2px 0",padding:"2px 4px"},children:e},`uplerr-${r}`))})]})]}),Qe&&t.jsxs("div",{className:"panel",style:{padding:8,marginTop:8},children:[t.jsxs("div",{style:{fontSize:12,fontWeight:700,marginBottom:6},children:["Detected ",qt," inputs"]}),t.jsxs("div",{style:{overflowX:"auto",paddingLeft:48},children:[t.jsx("style",{children:`
          .vast-row td:first-child { position: relative; padding-left: 26px; }
          .vast-row .row-trash {
            opacity: 0.7;
            transition: opacity .14s ease, background-color .14s ease, color .14s ease, border-color .14s ease, transform .14s ease;
            color: #475569;
          }
          .vast-row:hover .row-trash,
          .vast-row.selected .row-trash {
            opacity: 1;
            color: #dc2626;
            border-color: rgba(220, 38, 38, 0.45);
            background: rgba(220, 38, 38, 0.1);
            transform: translateX(-2px);
          }
          .vast-row .row-trash:hover {
            color: #dc2626;
            border-color: rgba(220, 38, 38, 0.6);
          }
        `}),t.jsxs("table",{ref:Ne,className:"table",style:{tableLayout:O&&typeof O=="object"&&Object.keys(O).length?"fixed":void 0},children:[t.jsx("colgroup",{children:se.map(e=>t.jsx("col",{style:{width:O[e.key]?`${O[e.key]}px`:void 0}},e.key))}),t.jsx("thead",{children:t.jsx("tr",{children:se.map(e=>t.jsxs("th",{"data-colkey":e.key,style:{position:"relative",textAlign:"left",padding:8,whiteSpace:"nowrap"},title:e.title||void 0,onMouseMove:r=>{const s=r.currentTarget;s.getBoundingClientRect().right-r.clientX<=8?(s.classList.add("near-edge"),s.style.cursor="col-resize"):(s.classList.remove("near-edge"),s.style.cursor="")},onMouseLeave:r=>{const s=r.currentTarget;s.classList.remove("near-edge"),s.style.cursor=""},children:[e.label,t.jsx("span",{role:"separator","aria-orientation":"vertical",title:"Drag to resize",onMouseDown:r=>{var T,C;const s=r.currentTarget.parentElement,c=se.findIndex(U=>U.key===e.key),d=c>=0&&c<se.length-1?c+1:c>0?c-1:-1;if(d<0)return;const l=se[d].key,i=Ne.current,g=O&&O[e.key]||(s?s.getBoundingClientRect().width:120)||120;let o=O&&O[l]||0;if(!o&&i){const U=i.querySelector(`thead th[data-colkey="${l}"]`);o=U&&U.getBoundingClientRect().width||120}const j=Math.max(((T=se[c])==null?void 0:T.min)||60,40),m=Math.max(((C=se[d])==null?void 0:C.min)||60,40);G.current={key:e.key,startX:r.clientX,startW:g,min:j,neighborKey:l,neighborStartW:o,neighborMin:m},document.body.style.cursor="col-resize",r.preventDefault()},style:{position:"absolute",right:0,top:0,height:"100%",width:6,cursor:"col-resize",userSelect:"none"}})]},e.key))})}),t.jsxs("tbody",{children:[xe.map((e,r)=>{var p,w,k,A,Q,he,ae,be,D;const s=(((p=e.meta)==null?void 0:p.vastUrl)||e.entry.raw||"").trim(),c=Object.entries(e.entry.params||{}).map(([y,v])=>`${y}=${v}`).slice(0,6),d=c.length?c.join("  "):"-",l=(w=e.meta)!=null&&w.sourceLabel?d==="-"?e.meta.sourceLabel:`${d} | ${e.meta.sourceLabel}`:d,i=Se(e),g=ft!==null&&i===ft,o=_t[i],j=(k=o==null?void 0:o.imp)!=null&&k.length?o.imp.join(", "):(o==null?void 0:o.status)==="pending"?"…":"-",m=(A=o==null?void 0:o.click)!=null&&A.length?o.click.join(", "):(o==null?void 0:o.status)==="pending"?"…":"-",T=(o==null?void 0:o.status)==="pending"?"…":isFinite(o==null?void 0:o.durationSec)?`${Math.round(o.durationSec)}s`:"-",C=(o==null?void 0:o.status)==="pending"?"…":(o==null?void 0:o.creative)||"-",U=(o==null?void 0:o.status)==="pending"?"…":(o==null?void 0:o.version)||"-",z=(o==null?void 0:o.alerts)||[],oe=z.length?z.join(`
`):"";return t.jsxs("tr",{role:"button",tabIndex:0,onClick:()=>St(e),onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),St(e))},className:`vast-row${g?" selected":""}`,style:{cursor:"pointer"},children:[t.jsxs("td",{style:{...L,position:"relative",paddingLeft:26},children:[t.jsx("span",{className:"row-trash",title:"Remove this row",role:"button","aria-label":"Remove row",onClick:y=>{y.stopPropagation();const v=Se(e);v&&Vt(v)},style:{position:"absolute",left:-40,top:"50%",width:30,height:30,borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",background:"var(--surface)",border:"1px solid var(--border)",color:"#475569",opacity:.7,pointerEvents:"auto",transform:"translateY(-50%)",boxShadow:"0 0 0 1px rgba(15, 23, 42, 0.08)",zIndex:2},children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"10",height:"10",fill:"currentColor","aria-hidden":"true",children:t.jsx("path",{d:"M3 6h18v2H3V6zm2 3h14l-1.2 11.1c-.1.9-.8 1.9-1.7 1.9H8c-.9 0-1.6-1-1.7-1.9L5 9zm5-5h4l1 2H9l1-2z"})})}),r+1]}),t.jsx("td",{style:L,children:e.entry.type}),t.jsx("td",{style:L,children:e.entry.vendor}),t.jsx("td",{style:L,children:e.entry.host||"-"}),t.jsx("td",{style:L,children:((Q=e.meta)==null?void 0:Q.placementId)||"-"}),t.jsx("td",{style:L,children:((he=e.meta)==null?void 0:he.placementName)||"-"}),t.jsx("td",{style:L,children:((ae=e.meta)==null?void 0:ae.platform)||"-"}),t.jsx("td",{style:L,children:((be=e.meta)==null?void 0:be.startDate)||"-"}),t.jsx("td",{style:L,children:((D=e.meta)==null?void 0:D.endDate)||"-"}),t.jsx("td",{style:{...L,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:s||"",children:s||"-"}),t.jsx("td",{style:{...L,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:(o==null?void 0:o.creative)||"",children:C}),t.jsx("td",{style:L,children:U}),t.jsx("td",{style:L,children:T}),t.jsx("td",{style:{...L,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:j,children:j}),t.jsx("td",{style:{...L,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},title:m,children:m}),t.jsx("td",{style:{...L,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:l}),t.jsx("td",{style:L,title:oe,children:z.length||"-"})]},e.key||`${e.source}-${r}-${s}`)}),xe.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:17,style:{fontStyle:"italic",color:"#6b7280"},children:"No entries parsed"})})]})]})]})]}),Qe&&t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Alerts"}),t.jsxs("ul",{style:{fontFamily:"monospace",fontSize:11,minHeight:80,background:"var(--surface-2)",color:"var(--text)",padding:6,borderRadius:6,border:"1px solid var(--border)"},children:[W.map((e,r)=>t.jsx("li",{style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.3)",margin:"2px 0",padding:"2px 4px"},children:e},`a-${r}`)),E.map((e,r)=>t.jsx("li",{style:{background:"rgba(239,68,68,0.12)",border:"1px solid rgba(239,68,68,0.3)",margin:"2px 0",padding:"2px 4px"},children:e},`e-${r}`))]})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Info"}),t.jsx("ul",{style:{fontFamily:"monospace",fontSize:11,minHeight:80,background:"var(--surface-2)",color:"var(--text)",padding:6,borderRadius:6,border:"1px solid var(--border)"},children:P.map((e,r)=>t.jsx("li",{children:e},r))})]})]}),ht&&t.jsx("div",{style:{marginTop:16},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsxs("div",{children:[t.jsx("video",{ref:R,src:ht,controls:!0,muted:!0,playsInline:!0,style:{width:"100%",border:"1px solid var(--border)",borderRadius:6,cursor:K?"pointer":"default"},title:K?"Open ClickThrough":void 0,onCanPlay:()=>{var e;try{(e=R.current)==null||e.play().catch(()=>{})}catch{}},onClick:()=>{K&&(Gt(K),Re(!0),X("click"),ie("click"))}}),K&&t.jsx("div",{style:{marginTop:6},children:t.jsxs("button",{type:"button",className:"btn primary",onClick:()=>Ie(!0),children:["CTURL Status",_&&_.status?` (Status: ${_.status})`:""]})})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:6},children:"Progression"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:6},children:[t.jsx(ee,{label:"request",done:ge!==void 0}),t.jsx(ee,{label:"impression",done:ye!==void 0,hint:jt?`${jt} ms`:void 0}),t.jsx(ee,{label:"started",done:V}),t.jsx(ee,{label:"25%",done:Me.q25}),t.jsx(ee,{label:"50%",done:Me.q50}),t.jsx(ee,{label:"75%",done:Me.q75}),t.jsx(ee,{label:"complete",done:Me.complete}),t.jsx(ee,{label:"pause",done:ne}),t.jsx(ee,{label:"audio toggle",done:ke}),t.jsx(ee,{label:"click",done:$e})]}),t.jsx("div",{style:{fontSize:12,fontWeight:700,marginTop:12},children:"Events"}),t.jsx("div",{style:{maxHeight:200,overflow:"auto",border:"1px solid var(--border)",borderRadius:6,background:"var(--surface)"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"var(--table-head)"},children:[t.jsx("th",{style:te,children:"Time"}),t.jsx("th",{style:te,children:"Event"})]})}),t.jsxs("tbody",{children:[re.map((e,r)=>t.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[t.jsx("td",{style:H,children:e.time}),t.jsx("td",{style:H,children:e.label})]},r)),re.length===0&&t.jsx("tr",{children:t.jsx("td",{style:H,colSpan:2,children:"(no events yet)"})})]})]})}),t.jsx("div",{style:{fontSize:12,fontWeight:700,marginTop:12},children:"Trackers"}),t.jsx(sr,{trackers:qe}),t.jsxs("details",{style:{marginTop:12},children:[t.jsx("summary",{style:{cursor:"pointer",fontWeight:700,fontSize:12},children:"Trackers (raw)"}),t.jsx("div",{style:{maxHeight:240,overflow:"auto",border:"1px solid var(--border)",borderRadius:6,background:"var(--surface)",marginTop:8},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"var(--table-head)"},children:[t.jsx("th",{style:te,children:"Event"}),t.jsx("th",{style:{...te,width:"55%"},children:"URL"}),t.jsx("th",{style:te,children:"Fired At"}),t.jsx("th",{style:te,children:"Status"})]})}),t.jsx("tbody",{children:Object.keys(qe).length===0?t.jsx("tr",{children:t.jsx("td",{style:H,colSpan:4,children:"(none)"})}):Object.entries(qe).flatMap(([e,r])=>r.map((s,c)=>t.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[t.jsx("td",{style:H,children:e}),t.jsx("td",{style:{...H,wordBreak:"break-all"},children:s.url}),t.jsx("td",{style:H,children:s.firedAt||""}),t.jsx("td",{style:H,children:s.status||""})]},`${e}-${c}`)))})]})})]})]})]})}),(F||B)&&t.jsx("div",{style:{marginTop:16},children:t.jsxs("details",{children:[t.jsx("summary",{style:{cursor:"pointer",fontWeight:700,fontSize:12},children:"XML Source Code"}),t.jsxs("div",{style:{position:"sticky",top:0,zIndex:2,background:"var(--surface)",padding:"6px 0",display:"flex",alignItems:"center",gap:8,borderBottom:"1px solid var(--border)"},children:[t.jsx("input",{value:Y,onChange:e=>{ct(e.target.value),Ce(0)},onKeyDown:e=>{if(e.key==="Enter"){e.preventDefault();const r=pe(B||F||"",Y);r>0&&(e.shiftKey?Ce(s=>(s-1+r)%r):Ce(s=>(s+1)%r))}},placeholder:"Search XML...",style:{flex:"0 0 240px",padding:"4px 8px",border:"1px solid var(--border)",borderRadius:6,fontSize:12,background:"var(--surface)",color:"var(--text)"}}),t.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("button",{className:"btn",title:"Previous match",onClick:()=>{const e=pe(B||F||"",Y);e<=0||Ce(r=>(r-1+e)%e)},disabled:pe(B||F,Y)<=1,style:{padding:"2px 6px",fontSize:12},children:"←"}),t.jsx("button",{className:"btn",title:"Next match",onClick:()=>{const e=pe(B||F||"",Y);e<=0||Ce(r=>(r+1)%e)},disabled:pe(B||F,Y)<=1,style:{padding:"2px 6px",fontSize:12},children:"→"}),t.jsx("span",{style:{fontSize:11,opacity:.8},children:(()=>{const e=pe(B||F,Y);return e?`${(Le%e+e)%e+1} of ${e}`:"0 matches"})()})]}),t.jsx("div",{style:{marginLeft:"auto"},children:t.jsx("button",{className:"btn",title:"Copy XML",onClick:()=>{try{const e=(B||F||"").toString();navigator.clipboard.writeText(e).catch(()=>{})}catch{}},style:{fontSize:11,padding:"4px 8px"},children:"Copy"})})]}),t.jsx("pre",{ref:lt,style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:11,lineHeight:1.3,background:"var(--surface-2)",color:"var(--text)",padding:8,borderRadius:6,border:"1px solid var(--border)"},children:Zt(B||F,Y,Le)})]})}),It&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},onClick:e=>{e.target===e.currentTarget&&Ie(!1)},children:t.jsxs("div",{className:"panel",style:{padding:12,width:"min(560px, 92vw)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[t.jsx("div",{style:{fontSize:13,fontWeight:700},children:"CTURL Status"}),t.jsx("button",{onClick:()=>Ie(!1),className:"btn",style:{fontSize:12,padding:"2px 6px"},children:"Close"})]}),!K&&t.jsx("div",{style:{fontSize:12,background:"rgba(245,158,11,0.12)",color:"var(--text)",border:"1px solid rgba(245,158,11,0.3)",padding:8,borderRadius:6},children:"No ClickThrough detected."}),K&&t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsxs("div",{style:{fontSize:12},children:["Status:"," ",t.jsx("strong",{children:(_==null?void 0:_.status)||"resolving..."})]}),t.jsx("div",{style:{fontSize:12,fontFamily:"monospace",wordBreak:"break-all"},children:_?_.final&&_.final!==(_.initial||"")?`${_.initial} -> ${_.final}`:`${_.initial}`:Pe(K)||K}),t.jsx("div",{style:{fontSize:12},children:t.jsx("a",{href:Pe(K)||K,target:"_blank",rel:"noopener noreferrer",children:"Open clickthrough"})})]})]})})]})};function ze(n){try{const a="  ",u=/(>)(<)(\/*)/g;let f=n.replace(/\r?\n/g,"").replace(u,`$1
$2$3`),x=0;return f.split(`
`).map(b=>{let E=0;b.match(/.+<\/.*>$/)?E=0:b.match(/^<\/.+>/)?x!==0&&(x-=1):b.match(/^<[^!?].*>$/)&&(E=1);const S=a.repeat(x);return x+=E,S+b}).join(`
`)}catch{return n}}function ce(n,a){const u=[],f=n.querySelectorAll?n.querySelectorAll("*"):n.getElementsByTagName("*");for(const x of Array.from(f)){const b=x.localName||x.tagName;b&&String(b).toLowerCase()===String(a).toLowerCase()&&u.push(x)}return u}function le(n,a){for(const u of a){const f=ce(n,u);for(const x of f){const b=(x.textContent||"").trim();if(b)return b}}return""}function rt(n){return le(n,["ClickThrough","NonLinearClickThrough","CompanionClickTracking","IconClickTracking"])||""}async function Yt(n){const a=Pe(n)||n;try{const u=await fetch(a,{method:"HEAD",mode:"cors",redirect:"follow"});return{status:u.ok?"ok":`HTTP ${u.status}`,initial:a}}catch{return{status:"unknown",initial:a}}}function Pe(n){try{return new URL(n).toString()}catch{try{if(n.startsWith("//"))return(location.protocol==="https:"?"https:":"http:")+n;if(/^www\./i.test(n))return"https://"+n}catch{}return""}}function Gt(n){try{return!!window.open(n,"_blank","noopener")}catch{return!1}}function pe(n,a){const u=String(a||"").trim();if(!u)return 0;const f=new RegExp(u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return(n.match(f)||[]).length}function Zt(n,a,u){const f=String(a||"").trim();if(!f)return n;const x=new RegExp(f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),b=[];let E=0,S,W=0;for(;(S=x.exec(n))!==null;){const J=S.index;J>E&&b.push(n.slice(E,J));const P=typeof u=="number"&&W===(u%999999+999999)%999999;b.push(t.jsx("mark",{id:P?`xml-match-${W}`:void 0,style:P?{backgroundColor:"rgba(99,102,241,0.35)"}:void 0,children:S[0]},J)),W++,E=J+S[0].length}return E<n.length&&b.push(n.slice(E)),b}function nt(n){const a=n.match(/^(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,3}))?$/);if(!a)return NaN;const u=parseInt(a[1],10),f=parseInt(a[2],10),x=parseInt(a[3],10),b=a[4]?parseInt(a[4].padEnd(3,"0"),10):0;return u*3600+f*60+x+b/1e3}const te={textAlign:"left",padding:6,whiteSpace:"nowrap"},H={padding:6,verticalAlign:"top"},ee=({label:n,done:a,hint:u})=>t.jsx("div",{title:u,style:{padding:"6px 8px",borderRadius:6,background:a?"var(--ok)":"var(--btn-bg)",color:a?"#fff":"var(--text)",textAlign:"center",fontSize:12,fontWeight:700,border:"1px solid var(--btn-border)"},children:n});function er(){const n=new Date;return`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}:${String(n.getMilliseconds()).padStart(3,"0")}`}function tr(n){try{const a=new URL(n);return a.searchParams.set("cb",String(Date.now())),a.toString()}catch{return n+(n.includes("?")?"&":"?")+"cb="+Date.now()}}function rr(n){n.forEach(a=>{try{const u=new Image;u.onload=()=>{},u.onerror=()=>{},u.src=tr(a)}catch{}})}function nr(n,a){const u=JSON.parse(JSON.stringify(n||{}));if(!u[a])return u;const f=er();return u[a]=u[a].map(x=>x.firedAt?x:{...x,firedAt:f,status:"requested"}),u}const sr=({trackers:n})=>{const a=[];Object.entries(n||{}).forEach(([f,x])=>{x.forEach(b=>{const{vendor:E,host:S}=fe(b.url);a.push({vendor:E,host:S,event:f,url:b.url,firedAt:b.firedAt,status:b.status})})});const u=new Map;return a.forEach(f=>{const x=`${f.vendor}|${f.host}`;u.has(x)||u.set(x,[]),u.get(x).push(f)}),a.length===0?t.jsx("div",{style:{fontSize:12,opacity:.8},children:"(no trackers)"}):t.jsx("div",{style:{display:"grid",gap:8},children:Array.from(u.entries()).map(([f,x])=>{const[b,E]=f.split("|");return t.jsxs("details",{open:!0,children:[t.jsxs("summary",{style:{cursor:"pointer",fontWeight:700,fontSize:12},children:[b," — ",E," ",t.jsxs("span",{style:{opacity:.7,fontWeight:400},children:["(",x.length,")"]})]}),t.jsx("div",{style:{maxHeight:220,overflow:"auto",border:"1px solid var(--border)",borderRadius:6,background:"var(--surface)",marginTop:6},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"var(--table-head)"},children:[t.jsx("th",{style:te,children:"Event"}),t.jsx("th",{style:{...te,width:"60%"},children:"URL"}),t.jsx("th",{style:te,children:"Fired At"}),t.jsx("th",{style:te,children:"Status"})]})}),t.jsx("tbody",{children:x.map((S,W)=>t.jsxs("tr",{style:{borderTop:"1px solid var(--border)"},children:[t.jsx("td",{style:H,children:S.event}),t.jsx("td",{style:{...H,wordBreak:"break-all"},children:S.url}),t.jsx("td",{style:H,children:S.firedAt||""}),t.jsx("td",{style:H,children:S.status||""})]},W))})]})})]},f)})})};function Se(n){var f;const a=(n==null?void 0:n.entry)||n,u=String(((f=n==null?void 0:n.meta)==null?void 0:f.vastUrl)||(a==null?void 0:a.raw)||"").trim();return(n==null?void 0:n.key)||`${n==null?void 0:n.source}-${(a==null?void 0:a.i)||""}-${u}`}export{hr as VastTester};
