import{r as D,j as s,R as _e,_ as Rt}from"./index-Dykb5sAM.js";import{u as Be}from"./ExtendedHome-Bj2mkDZV.js";function Tt(n){const a=Object.keys(n.files).filter(u=>/\.(html?)$/i.test(u)),o=[];if(a.length===0)return o.push("No HTML files present"),{htmlCandidates:[],messages:o};if(a.length===1)return{primary:{path:a[0]},htmlCandidates:a,messages:o};const t=[];for(const u of a){const m=new TextDecoder().decode(n.files[u]);/meta[^>]+name=["']ad\.size["']/i.test(m)&&t.push(u)}if(t.length===1)return{primary:{path:t[0]},htmlCandidates:a,messages:o};if(t.length>1){t.sort((m,v)=>m.split("/").length-v.split("/").length||m.length-v.length);const u=t[0];return o.push("Multiple HTMLs with ad.size meta; chose "+u),{primary:{path:u},htmlCandidates:a,messages:o}}const l=_t(a);return o.push("Multiple HTML files without ad.size meta; chose fallback "+l),{primary:{path:l},htmlCandidates:a,messages:o}}function _t(n){const a=u=>u.split("/").length,o=u=>/\/(index\.html?)$/i.test("/"+u),t=n.filter(o);return t.length?(t.sort((u,m)=>a(u)-a(m)||u.length-m.length),t[0]):[...n].sort((u,m)=>a(u)-a(m)||u.length-m.length)[0]}const ft=new TextDecoder;function it(n,a=160){if(!n)return;const o=n.replace(/\s+/g," ").trim();if(o)return o.length>a?o.slice(0,a)+"…":o}function pt(n,a){if(!n)return;function o(S,L,T){const M=/width\s*:\s*(\d{2,4})px/i.exec(S),h=/height\s*:\s*(\d{2,4})px/i.exec(S);if(!M||!h)return;const A=parseInt(M[1],10),e=parseInt(h[1],10);if(!(!Number.isFinite(A)||!Number.isFinite(e))&&!(A<10||e<10))return{size:{width:A,height:e},source:{method:L,snippet:it(S),path:a.path}}}let t,l=0;const u=S=>{if(!S)return;const L=S.size.width*S.size.height;L>l&&(t=S,l=L)},m=/@media[^{}]*\{[^}]*\}/gi;let v;for(;v=m.exec(n);)u(o(v[0],"css-media"));const I=/\{[^{}]*\}/g;let b;for(;b=I.exec(n);){const S=a.type==="css-file"?"css-file":"css-rule";u(o(b[0],S))}if(!t){const S=a.type==="inline-style"?"inline-style":a.type==="css-file"?"css-file":"css-rule";u(o(n,S))}return t}function zt(n,a){const o=n.querySelector('meta[name="ad.size"]');if(o){const t=o.getAttribute("content")||"",l=/width\s*=\s*(\d+)\s*,\s*height\s*=\s*(\d+)/i.exec(t);if(l)return{size:{width:parseInt(l[1],10),height:parseInt(l[2],10)},source:{method:"meta",snippet:it(o.outerHTML||t),path:a}}}try{const t=n.querySelector('script[type="text/gwd-admetadata"]');if(t&&t.textContent){const l=t.textContent.trim();if(l){const u=JSON.parse(l),m=u&&u.creativeProperties||{},v=Number(m.maxWidth??m.minWidth),I=Number(m.maxHeight??m.minHeight);if(isFinite(v)&&isFinite(I)&&v>0&&I>0)return{size:{width:Math.round(v),height:Math.round(I)},source:{method:"gwd-admetadata",snippet:it(l),path:a}}}}}catch{}}function Nt(n,a){const o=[];function t(l,u,m){u&&o.push({from:a,type:m,url:u,inZip:!1,external:/^https?:\/\//i.test(u),secure:/^https:\/\//i.test(u)})}return n.querySelectorAll("img[src]").forEach(l=>t(l,l.getAttribute("src"),"img")),n.querySelectorAll("gwd-image[source]").forEach(l=>t(l,l.getAttribute("source"),"img")),n.querySelectorAll("video[src]").forEach(l=>t(l,l.getAttribute("src"),"media")),n.querySelectorAll("audio[src]").forEach(l=>t(l,l.getAttribute("src"),"media")),n.querySelectorAll("source[src]").forEach(l=>t(l,l.getAttribute("src"),"media")),n.querySelectorAll('link[rel="stylesheet"][href]').forEach(l=>t(l,l.getAttribute("href"),"css")),n.querySelectorAll("script[src]").forEach(l=>t(l,l.getAttribute("src"),"js")),n.querySelectorAll("a[href]").forEach(l=>t(l,l.getAttribute("href"),"anchor")),n.querySelectorAll("[style]").forEach(l=>{const u=l.getAttribute("style")||"";for(const m of st(u,a))o.push(m)}),o}function st(n,a){const o=[],t=/url\(([^)]+)\)/gi;let l;for(;l=t.exec(n);){let u=l[1].trim().replace(/^['"]|['"]$/g,"");u&&o.push({from:a,type:"font",url:u,inZip:!1,external:/^https?:\/\//i.test(u),secure:/^https:\/\//i.test(u)})}return o}function mt(n,a){const o=n.files[a.path],t=ft.decode(o),u=new DOMParser().parseFromString(t,"text/html");let m=zt(u,a.path),v=m==null?void 0:m.size,I=m==null?void 0:m.source;const b=Nt(u,a.path),S=[];if(u.querySelectorAll("style").forEach(L=>{const T=L.textContent||"";if(T){const M={type:"css-rule",path:a.path};S.push({text:T,context:M}),b.push(...st(T,a.path))}}),u.querySelectorAll("[style]").forEach(L=>{const T=L.getAttribute("style")||"";T&&S.push({text:T,context:{type:"inline-style",path:a.path}})}),!v)for(const L of S){const T=pt(L.text,L.context);if(T){v=T.size,I=T.source;break}}for(const L of[...b])if(L.type==="css"&&!L.external){const T=gt(n,a.path,L.url);if(T&&n.files[T]){const M=ft.decode(n.files[T]);b.push(...st(M,T));const h={type:"css-file",path:T};if(S.push({text:M,context:h}),!v){const A=pt(M,h);A&&(v=A.size,I=A.source)}}}for(const L of b){if(L.external)continue;const T=gt(n,a.path,L.url);T&&(L.normalized=Pt(T),n.lowerCaseIndex[L.normalized.toLowerCase()]&&(L.inZip=!0))}return{adSize:v,adSizeSource:I,references:b}}function Pt(n){return n.replace(/[?#].*$/,"")}function gt(n,a,o){if(/^https?:/i.test(o)||/^data:/i.test(o)||o.startsWith("javascript:"))return;if(o.startsWith("/"))return o.slice(1);o.startsWith("./")&&(o=o.slice(2));const t=a.split("/").slice(0,-1).join("/");return(t?t+"/"+o:o).split("/").filter(m=>m&&m!==".").reduce((m,v)=>(v===".."?m.pop():m.push(v),m),[]).join("/")}function Wt(n){if(!n)return"detected heuristics";const a=n.path?` in ${n.path}`:"";switch(n.method){case"meta":return'<meta name="ad.size"> tag';case"gwd-admetadata":return"GWD admetadata script";case"css-media":return`CSS @media rule${a}`.trim();case"css-rule":return`CSS rule${a}`.trim();case"inline-style":return"inline style attribute";case"css-file":return`CSS file${a}`.trim();default:return"detected heuristics"}}function Bt(n,a){const o=[],t=[];let l="PASS";if(!n.primary)l="FAIL",t.push("Missing primary HTML asset"),o.push({path:"(bundle root)",detail:"No primary HTML selected"});else{const u=(()=>{try{return n.primary.path.split("/").pop()||n.primary.path}catch{return n.primary.path}})(),m=n.adSize,v=n.adSizeSource||n.primary.sizeSource,I=Wt(v),b=String(u||"").match(new RegExp("(?<!\\d)(\\d{2,4})\\s*[xX]\\s*(\\d{2,4})(?!\\d)"));if(m&&b){const S=parseInt(b[1],10),L=parseInt(b[2],10);S===m.width&&L===m.height?(l="PASS",t.push("Primary file detected"),t.push(`Size detected from ${I}`)):(l="FAIL",t.push("Primary file detected; size token does not match actual dimensions"),o.push({path:u,detail:`Filename ${S}x${L} vs actual ${m.width}x${m.height}`}),v&&t.push(`Size detected from ${I}`))}else m&&!b?(l="PASS",t.push("Primary file detected"),t.push(`Size detected from ${I}`)):!m&&b?(l="WARN",t.push(`Primary file detected; ad.size missing (filename has ${b[1]}x${b[2]})`),o.push({path:u,detail:'No <meta name="ad.size"> found'})):(l="FAIL",t.push("Primary file detected; no ad.size and no size token in filename"),o.push({path:u,detail:"Missing dimensions"}))}return{id:"primaryAsset",title:"Primary HTML Asset",severity:l,messages:t,offenders:o}}function Ft(n,a){const o=[],t=[];let l="PASS";const u=[];for(const m of n.references)if(!m.external&&!m.inZip){const v=`${m.url} referenced from ${m.from}`;o.push({path:m.from,detail:v}),u.push(m.url)}return u.length?(l=a.missingAssetSeverity,t.push(`${u.length} missing asset(s)`)):t.push("All referenced in-bundle assets found"),{id:"assetReferences",title:"Referenced Assets Present",severity:l,messages:t,offenders:o}}function Et(n,a){return{hosts:new Set(n.map(o=>o.toLowerCase())),filetypes:new Set(a.map(o=>o.toLowerCase()))}}function Dt(n,a){var I;const o=[],t=[];let l="PASS";const u=Et(a.externalHostAllowlist,a.externalFiletypeAllowlist);let m=0,v=0;for(const b of n.references)if(b.external){m++;try{const S=new URL(b.url,"https://placeholder.local"),L=S.host.toLowerCase(),T=(((I=S.pathname.match(/\.[A-Za-z0-9]+$/))==null?void 0:I[0])||"").toLowerCase(),M=u.hosts.has(L),h=T&&u.filetypes.has(T);!M&&!h&&(v++,o.push({path:b.from,detail:`External: ${b.url}`}))}catch{o.push({path:b.from,detail:`Unparseable external URL: ${b.url}`}),v++}}return m===0?t.push("No external resources referenced"):t.push(`${m} external reference(s), ${v} outside allowlist`),v>0&&(l=a.externalResourceSeverity),{id:"externalResources",title:"External Resource Policy",severity:l,messages:t,offenders:o}}function Ot(n,a){const o=[],t=[];let l="PASS",u=0,m=0;for(const v of n.references)v.external&&m++,v.external&&/^http:\/\//i.test(v.url)&&(u++,o.push({path:v.from,detail:v.url}));return u===0?t.push(`All ${m} external reference(s) use HTTPS`):(t.push(`${u} HTTP (non-secure) external reference(s)`),l=a.httpSeverity),{id:"httpsOnly",title:"HTTPS Only",severity:l,messages:t,offenders:o}}function Ht(n,a,o){const t=o.iabInitialLoadKB||150,l=o.iabSubsequentLoadKB||1e3,u=o.iabMaxZippedKB||200,m=a.totalBytes??Object.values(n.files).reduce((A,e)=>A+e.byteLength,0),v=a.initialBytes??m,I=a.subsequentBytes??Math.max(0,m-v),b=m/1024,S=v/1024,L=I/1024,T=(a.zippedBytes||n.bytes.length)/1024,M=[];let h="PASS";return S>t?(h="FAIL",M.push(`Initial load ${S.toFixed(1)}KB exceeds cap ${t}KB`)):M.push(`Initial load ${S.toFixed(1)}KB within cap ${t}KB`),L>l?(h="FAIL",M.push(`Subsequent (polite) load ${L.toFixed(1)}KB exceeds cap ${l}KB`)):M.push(`Subsequent (polite) load ${L.toFixed(1)}KB within cap ${l}KB`),T>u?(h!=="FAIL"&&(h="WARN"),M.push(`Compressed creative size ${T.toFixed(1)}KB exceeds recommended max ${u}KB`)):M.push(`Compressed creative size ${T.toFixed(1)}KB within recommended max ${u}KB`),M.push(`Total uncompressed ${b.toFixed(1)}KB (initial + subsequent)`),{id:"iabWeight",title:"IAB Weight",severity:h,messages:M,offenders:[]}}const Ut=new Set(["thumbs.db",".ds_store"]);function qt(n,a){const o=[];let t=!1;for(const u of Object.keys(n.files)){const m=u.toLowerCase();if(m.startsWith("__macosx/")){t=!0,o.push({path:u,detail:"macOS resource fork directory entry"});continue}const v=m.split("/").pop()||m;Ut.has(v)&&o.push({path:u,detail:"OS metadata file"})}if(o.length===0)return{id:"systemArtifacts",title:"System Artifacts",severity:"PASS",messages:["No disallowed OS metadata artifacts found"],offenders:[]};const l=[];return t&&l.push("Contains __MACOSX resource fork entries"),o.some(u=>/thumbs\.db$/i.test(u.path))&&l.push("Contains Thumbs.db"),o.some(u=>/\.ds_store$/i.test(u.path))&&l.push("Contains .DS_Store"),l.length===0&&l.push("Contains disallowed system artifact files"),{id:"systemArtifacts",title:"System Artifacts",severity:"FAIL",messages:l,offenders:o}}function Kt(n,a,o){const t=[];return t.push(Bt(a)),t.push(Ft(a,o)),t.push(Dt(a,o)),t.push(Ot(a,o)),(o.profile??"IAB")==="IAB"&&t.push(Ht(n,a,o)),t.push(qt(n)),t}const Gt=["doubleclick.net","googletagmanager.com","google-analytics.com","adsrvr.org","everesttech.net","crwdcntrl.net","impactradius","moatads.com","adroll.com","adnxs.com","demdex.net","omtrdc.net"];async function Zt(n,a,o){var S,L,T,M,h,A;const t=[],l=Object.keys(n.files),u=(S=a.primary)==null?void 0:S.path,m=u?new TextDecoder().decode(n.files[u]):"",v=u?u.split("/").pop()||u:void 0,b=(o.profile??"IAB")==="IAB";{const r=n.mode==="zip",c=l.filter(z=>/(\.zip|\.adz)$/i.test(z)),g=l.filter(z=>!z.includes("/")),d=Array.from(new Set(l.filter(z=>z.includes("/")).map(z=>z.split("/")[0]))),f=[/unzip/i,/for[-_]?delivery/i,/delivery/i,/_zip/i,/_final/i],w=d.filter(z=>f.some(ae=>ae.test(z))),$=d.length===1?d[0]:void 0,P=[];P.push(`Package: ${r?"ZIP/ADZ":"not ZIP/ADZ"}`),P.push(`Nested archives: ${c.length}`),P.push(`Top-level: ${g.length} file(s), ${d.length} folder(s)`),w.length&&P.push(`Wrapper folders detected: ${w.slice(0,5).join(", ")}`),$&&g.length===0&&P.push(`All content inside single folder: "${$}" — zip the folder's contents, not the folder`);const V=c.map(z=>({path:z,detail:"Nested archive (.zip/.adz) — remove inner ZIP and include its files at top level"}));t.push({id:"pkg-format",title:"Packaging Format",severity:!r||c.length>0?"FAIL":"PASS",messages:P,offenders:V});const Y=l.filter(z=>/\.(html?)$/i.test(z)),U=Y.length,q=new Set;if(a.references&&Array.isArray(a.references))for(const z of a.references)z.inZip&&z.normalized&&q.add(z.normalized.toLowerCase());(L=a.primary)!=null&&L.path&&q.add(a.primary.path.toLowerCase());const O=[];for(const z of l){const ae=z.toLowerCase();Y.includes(z)||q.has(ae)||O.push({path:z,detail:"Not referenced by entry file"})}let E=[];E.push(`Entry HTML files: ${U} (expected 1)`),E.push(`Unreferenced files: ${O.length}`);const ee=U!==1?"FAIL":O.length>0?"WARN":"PASS";t.push({id:"entry-html",title:"Single Entry HTML & References",severity:ee,messages:E,offenders:O});const pe=l.length,ye=a.zippedBytes||((T=n.bytes)==null?void 0:T.length)||0,ve=pe>100,fe=ye>10*1024*1024,N=[`Files: ${pe} / 100`,`Zip size: ${(ye/1024).toFixed(1)} KB / 10240.0 KB`];t.push({id:"file-limits",title:"File Count and Upload Size",severity:ve||fe?"FAIL":"PASS",messages:N,offenders:[]});const K=new Set([".html",".htm",".js",".css",".jpg",".jpeg",".gif",".png",".json",".xml",".svg",".eot",".otf",".ttf",".woff",".woff2"]),oe=[];for(const z of l){const ae=z.toLowerCase().match(/\.[a-z0-9]+$/),X=ae?ae[0]:"";(!X||!K.has(X))&&oe.push({path:z,detail:X||"(no extension)"})}t.push({id:"allowed-ext",title:"Allowed File Extensions",severity:oe.length?"FAIL":"PASS",messages:[`Disallowed extension files: ${oe.length}`],offenders:oe});const be=[],de=/(^|[^.$\w])(?:window\.)?(?:parent|top)\.(?!postMessage\b)/i,Z=/document\.domain\s*=/i;for(const z of l)if(/\.(js|html?)$/i.test(z)){const X=new TextDecoder().decode(n.files[z]).split(/\r?\n/);for(let Q=0;Q<X.length;Q++){const te=X[Q];if(Z.test(te)){be.push({path:z,line:Q+1,detail:te.trim().slice(0,200)});continue}de.exec(te)&&be.push({path:z,line:Q+1,detail:te.trim().slice(0,200)})}}t.push({id:"iframe-safe",title:"Iframe Safe (No Cross-Frame DOM)",severity:be.length?"FAIL":"PASS",messages:[`Cross-frame access references: ${be.length}`],offenders:be});let we=!1,xe=!1,Ae=!1,ce=!1;const $e=[],Oe=/\b(?:window\.)?(clicktag|clickTag|clickTAG)\d*\b/i,Fe=/\bwindow\.(clicktag|clickTag|clickTAG)\d*\b/i,ze=/window\.open\s*\(\s*(?:window\.)?(clickTAG|clickTag)\d*\b/i,i=/window\.open\s*\(\s*([^)]*)\)/ig,j=/\b(?:var|let|const)\s+([A-Za-z_$][\w$]*)\s*=\s*[^;]*clicktag\d*[^;]*;/ig,C=/\b([A-Za-z_$][\w$]*)\s*=\s*[^;]*clicktag\d*[^;]*;/ig,p=/\b(?:studio\.)?Enabler\.(?:exit|dynamicExit)\s*\(/i,y=/<a\b[^>]*\bhref=["']\s*javascript:\s*window\.open\s*\([^"']*(?:window\.)?(clickTAG|clickTag)\d*/i,x=/<a\b[^>]*\bonclick=["'][^"']*(?:window\.)?open\s*\([^"']*(?:window\.)?(clickTAG|clickTag)\d*/i,_=/(window|document|top)\.location\s*=\s*(?:window\.)?(clickTAG|clickTag)\d*/i;for(const z of l)if(/(\.(js|html?))$/i.test(z)){const ae=new TextDecoder().decode(n.files[z]),X=new Set;let Q;for(j.lastIndex=0;Q=j.exec(ae);)Q&&Q[1]&&X.add(Q[1]);for(C.lastIndex=0;Q=C.exec(ae);){if(!Q||!Q[1])continue;const k=Q.index??0,R=k>0?ae[k-1]:"";R==="."||R==="$"||R==="]"||X.add(Q[1])}const te=ae.split(/\r?\n/),se=new Set;for(let k=0;k<te.length;k++){const R=te[k];if(Oe.test(R)){we=!0;const B=`${z}:${k+1}:var`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"var",detail:R.trim().slice(0,200)}))}if(Fe.test(R)){xe=!0;const B=`${z}:${k+1}:varw`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"varw",detail:R.trim().slice(0,200)}))}if(ze.test(R)){Ae=!0;const B=`${z}:${k+1}:open`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"open",detail:R.trim().slice(0,200)}))}i.lastIndex=0;let H;for(;H=i.exec(R);){const B=(H[1]||"").trim();if(!B)continue;const G=/clicktag/i.test(B);let ne=!1,re="";const le=B.match(/^([A-Za-z_$][\w$]*)$/);if(le&&le[1]&&(re=le[1],X.has(re)&&(ne=!0)),!G&&!ne)continue;const ge=G?`${z}:${k+1}:open`:`${z}:${k+1}:open-alias:${re||B}`;se.has(ge)||G&&se.has(`${z}:${k+1}:open`)||(Ae=!0,se.add(ge),$e.push({path:z,line:k+1,kind:G?"open":"open-alias",detail:R.trim().slice(0,200)}))}if(p.test(R)){ce=!0;const B=`${z}:${k+1}:enabler`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"enabler",detail:R.trim().slice(0,200)}))}if(y.test(R)){Ae=!0;const B=`${z}:${k+1}:ahref`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"ahref",detail:R.trim().slice(0,200)}))}if(x.test(R)){Ae=!0;const B=`${z}:${k+1}:aonclick`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"aonclick",detail:R.trim().slice(0,200)}))}if(_.test(R)){Ae=!0;const B=`${z}:${k+1}:assign`;se.has(B)||(se.add(B),$e.push({path:z,line:k+1,kind:"assign",detail:R.trim().slice(0,200)}))}}}const F=Ae,W=ce||we&&F,ie=W?"PASS":!W&&(we||xe||F||ce)?"WARN":"FAIL",me=[];we||xe||ce?me.push("clickTag detected"):me.push("clickTag not detected"),W&&me.push("clickTag referenced for redirect"),t.push({id:"clicktag",title:"ClickTag Present and Used",severity:ie,messages:me,offenders:$e});const he=[],Se=/(localStorage|sessionStorage|indexedDB|openDatabase)\b/i;for(const z of l)if(/\.(js|html?)$/i.test(z)){const X=new TextDecoder().decode(n.files[z]).split(/\r?\n/);for(let Q=0;Q<X.length;Q++){const te=X[Q];Se.test(te)&&he.push({path:z,line:Q+1,detail:te.trim().slice(0,200)})}}t.push({id:"no-webstorage",title:"No Web Storage APIs",severity:he.length?"FAIL":"PASS",messages:[`Storage API references: ${he.length}`],offenders:he})}{const e=window.__audit_last_summary||{};if(typeof e.memoryMB=="number"){const r=Number(e.memoryMB)||0,c=typeof e.memoryMinMB=="number"?Number(e.memoryMinMB):void 0,g=typeof e.memoryMaxMB=="number"?Number(e.memoryMaxMB):void 0,d=w=>typeof w=="number"&&isFinite(w)?(Math.round(w*10)/10).toFixed(1):"n/a",f=c!==void 0||g!==void 0?`~${d(c)} – ${d(g)} MB`:`~${d(r)} MB`;t.push({id:"memoryUsage",title:"Memory Usage",severity:"WARN",messages:[`Preview JS heap ${f}`,"Source: performance.memory (Chromium); advisory only"],offenders:[]})}}if(b){const r=a.initialRequests??0;t.push({id:"host-requests-initial",title:"Initial Host Requests",severity:r>10?"FAIL":"PASS",messages:[`Initial requests: ${r} / 10`],offenders:[]});try{const c=window.__audit_last_summary,g=typeof(c==null?void 0:c.longTasksMs)=="number"?Math.max(0,Math.min(3e3,Math.round(c.longTasksMs))):void 0;if(typeof g=="number"){const d=Math.round(g/3e3*100);t.push({id:"cpu-budget",title:"CPU Busy Budget",severity:d>30?"FAIL":"PASS",messages:[`Main thread busy ~${d}% (long tasks ${g} ms / 3000 ms)`],offenders:[]})}else t.push({id:"cpu-budget",title:"CPU Busy Budget",severity:"PASS",messages:["Not measured in preview"],offenders:[]})}catch{}try{const c=[];try{const U=m||"",q=Array.from(U.matchAll(/<style[^>]*>([\s\S]*?)<\/style>/gi)).map(O=>O[1]||"");c.push(...q)}catch{}for(const U of l)if(/\.css$/i.test(U))try{c.push(new TextDecoder().decode(n.files[U]))}catch{}const g=m||"";c.push(g);let d=0,f=1,w=!1,$=[];const P=U=>{const q=String(U||"").trim();let O=/^([\d.]+)\s*s$/i.exec(q);if(O)return parseFloat(O[1])||0;if(O=/^([\d.]+)\s*ms$/i.exec(q),O)return(parseFloat(O[1])||0)/1e3;const E=parseFloat(q);return isFinite(E)?E:0};for(const U of c){const q=/(?:^|;|\n|\{)\s*(?:-webkit-)?animation-duration\s*:\s*([^;\n\r]+)[;\n\r]/gi;let O;for(q.lastIndex=0;O=q.exec(U);){const ve=String(O[1]||"").split(",");for(const fe of ve){const N=P(fe);isFinite(N)&&(d=Math.max(d,N))}}const E=/(?:^|;|\n|\{)\s*(?:-webkit-)?animation-iteration-count\s*:\s*([^;\n\r]+)[;\n\r]/gi;let ee;for(E.lastIndex=0;ee=E.exec(U);){const ve=String(ee[1]||"").split(",");for(const fe of ve){const N=fe.trim().toLowerCase();if(N==="infinite")w=!0,f=Math.max(f,9999);else{const K=parseFloat(N);isFinite(K)&&(f=Math.max(f,Math.round(K)))}}}const pe=/(?:^|;|\n|\{)\s*(?:-webkit-)?animation\s*:\s*([^;\n\r]+)[;\n\r]/gi;let ye;for(pe.lastIndex=0;ye=pe.exec(U);){const ve=String(ye[1]||"").split(",");for(const fe of ve){const K=fe.trim().replace(/\([^)]*\)/g,"").split(/\s+/);for(const oe of K)if(/^([\d.]+)(ms|s)$/i.test(oe)){const be=P(oe);be>d&&(d=be)}else if(oe.toLowerCase()==="infinite")w=!0,f<9999&&(f=9999);else if(/^\d+$/.test(oe)){const be=parseInt(oe,10);be>f&&(f=be)}}}}if(d===0&&!w&&f<=1)try{const U=window.__audit_last_summary;U&&(typeof U.animMaxDurationS=="number"||typeof U.animMaxLoops=="number"||U.animInfinite)&&(d=Math.max(0,Number(U.animMaxDurationS||0)),f=Math.max(1,Number(U.animMaxLoops||1)),w=!!U.animInfinite)}catch{}const V=(w||f>3)&&d>15,Y=[];d===0&&!w&&f<=1?Y.push("No CSS animation detected (JS animation or unsupported syntax)"):(Y.push(`Max animation duration ~${d.toFixed(2)} s`),Y.push(`Max loops ${w?"infinite":f}`)),t.push({id:"animation-cap",title:"Animation Length Cap",severity:V?"FAIL":"PASS",messages:Y,offenders:$})}catch{}}if(l.length===1){const e=l[0];if(/\.(png|jpe?g|gif|webp)$/i.test(e))try{const r=n.files[e],c=new Uint8Array(r.byteLength);c.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength));const g=new Blob([c.buffer],{type:Ve(e)}),d=URL.createObjectURL(g),f=new Image;await new Promise((w,$)=>{f.onload=()=>w(),f.onerror=()=>$(new Error("img load")),f.src=d}),t.push({id:"imageMeta",title:"Image Metadata",severity:"PASS",messages:[`Dimensions ${f.naturalWidth}x${f.naturalHeight}`,`Size ${Math.round(n.files[e].byteLength/1024*10)/10} KB`],offenders:[],tags:["debug"]}),URL.revokeObjectURL(d)}catch{}if(/\.(mp4|webm|ogg|mov)$/i.test(e))try{const r=n.files[e],c=new Uint8Array(r.byteLength);c.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength));const g=new Blob([c.buffer],{type:Ve(e)}),d=URL.createObjectURL(g),f=document.createElement("video");f.preload="metadata",f.src=d,await new Promise(w=>{f.onloadedmetadata=()=>w(),setTimeout(()=>w(),3e3)}),t.push({id:"videoMeta",title:"Video Metadata",severity:"PASS",messages:[`Dimensions ${f.videoWidth}x${f.videoHeight}`,`Duration ${isFinite(f.duration)?f.duration.toFixed(2):"n/a"}s`,`Size ${Math.round(n.files[e].byteLength/1024*10)/10} KB`],offenders:[],tags:["debug"]}),URL.revokeObjectURL(d)}catch{}if(/\.(mp3|wav|ogg|m4a)$/i.test(e))try{const r=n.files[e],c=new Uint8Array(r.byteLength);c.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength));const g=new Blob([c.buffer],{type:Ve(e)}),d=URL.createObjectURL(g),f=new Audio;f.preload="metadata",f.src=d,await new Promise(w=>{f.onloadedmetadata=()=>w(),setTimeout(()=>w(),3e3)}),t.push({id:"audioMeta",title:"Audio Metadata",severity:"PASS",messages:[`Duration ${isFinite(f.duration)?f.duration.toFixed(2):"n/a"}s`,`Size ${Math.round(n.files[e].byteLength/1024*10)/10} KB`],offenders:[],tags:["debug"]}),URL.revokeObjectURL(d)}catch{}}{const e=/<style[\s>]/i.test(m),r=(m.match(/ style=/gi)||[]).length,c=e||r>0?"PASS":"FAIL";t.push({id:"cssEmbedded",title:"CSS Embedded",severity:c,messages:[e?"Style tags present":"",r?`${r} inline style attributes`:""].filter(Boolean),offenders:[]})}{let e=0,r=0,c=0,g=0;const d=[];for(const P of l)if(/\.(js|css)$/i.test(P)){const Y=new TextDecoder().decode(n.files[P]).split(/\r?\n/),U=Y.filter(E=>E.length>2e3),q=Y.filter(E=>E.length>200&&E.replace(/\s+/g,"").length/E.length>.98),O=U.length>0||q.length>20;/\.js$/i.test(P)?c++:g++,O?/\.js$/i.test(P)?e++:r++:d.push({path:P,detail:"not minified (heuristic)"})}const f=Math.max(0,c-e),w=Math.max(0,g-r),$=f+w===0?"PASS":"FAIL";t.push({id:"minified",title:"CSS/JS Minified",severity:$,messages:[`JS minified: ${e}/${c}`,`CSS minified: ${r}/${g}`],offenders:d})}{const e=l.length;Math.round((a.totalBytes||0)/102.4)/10,t.push({id:"hostedCount",title:"Hosted File Count",severity:"PASS",messages:[`Files: ${e}`],offenders:[],tags:["debug"]})}{const e=Math.round((a.totalBytes||0)/1024),r=e<=2500?"PASS":"FAIL";t.push({id:"hostedSize",title:"Hosted File Size",severity:r,messages:[`Uncompressed ${e} KB`,"Target: <= 2500 KB"],offenders:[]})}{const e=window.__audit_last_summary,r=(e==null?void 0:e.dialogs)||0;t.push({id:"dialogs",title:"Dialogs and Modals",severity:r>0?"FAIL":"PASS",messages:[`Count: ${r}`],offenders:[]})}{const e=window.__audit_last_summary,r=(e==null?void 0:e.cookies)||0,c=(e==null?void 0:e.localStorage)||0;t.push({id:"cookies",title:"Cookies Dropped",severity:r>0?"FAIL":"PASS",messages:[`Cookie sets: ${r}`],offenders:[]}),t.push({id:"localStorage",title:"Local Storage",severity:c>0?"FAIL":"PASS",messages:[`setItem calls: ${c}`],offenders:[]})}{const e=window.__audit_last_summary,r=e==null?void 0:e.domContentLoaded,c=e==null?void 0:e.visualStart,g=e==null?void 0:e.frames;t.push({id:"timing",title:"Timing Metrics",severity:"PASS",messages:[`DOMContentLoaded ${Math.round(r||0)} ms`,`Time to Render ~${Math.round(c||0)} ms`,`Frames observed ${g||0}`],offenders:[],tags:["debug"]});{const f=typeof c=="number"&&isFinite(c),w=f&&c<500?"PASS":"WARN",$=f?`Render start ~${Math.round(c)} ms`:"Not captured";t.push({id:"timeToRender",title:"Time to Render",severity:w,messages:[$,"Target: < 500 ms"],offenders:[]})}typeof r=="number"&&t.push({id:"domContentLoaded",title:"DOMContentLoaded",severity:r<1e3?"PASS":"FAIL",messages:[`DCL ${Math.round(r)} ms`,"Target: < 1000 ms"],offenders:[]});const d=[];typeof(e==null?void 0:e.rewrites)=="number"&&e.rewrites>0&&d.push(`Rewrites: ${e.rewrites}`),typeof(e==null?void 0:e.imgRewrites)=="number"&&e.imgRewrites>0&&d.push(`Image URLs Rewritten: ${e.imgRewrites}`),typeof(e==null?void 0:e.mediaRewrites)=="number"&&e.mediaRewrites>0&&d.push(`Media URLs Rewritten: ${e.mediaRewrites}`),typeof(e==null?void 0:e.scriptRewrites)=="number"&&e.scriptRewrites>0&&d.push(`Script URLs Rewritten: ${e.scriptRewrites}`),typeof(e==null?void 0:e.linkRewrites)=="number"&&e.linkRewrites>0&&d.push(`Link URLs Rewritten: ${e.linkRewrites}`),typeof(e==null?void 0:e.setAttrRewrites)=="number"&&e.setAttrRewrites>0&&d.push(`Attributes Rewritten: ${e.setAttrRewrites}`),typeof(e==null?void 0:e.styleUrlRewrites)=="number"&&e.styleUrlRewrites>0&&d.push(`Style URLs Rewritten: ${e.styleUrlRewrites}`),typeof(e==null?void 0:e.domImages)=="number"&&e.domImages>0&&d.push(`DOM Images: ${e.domImages}`),typeof(e==null?void 0:e.domBgUrls)=="number"&&e.domBgUrls>0&&d.push(`DOM Background URLs: ${e.domBgUrls}`),typeof(e==null?void 0:e.enablerStub)=="boolean"&&e.enablerStub&&d.push("DoubleClick Enabler stub: active"),d.length&&t.push({id:"previewDiag",title:"Runtime Diagnostics",severity:"PASS",messages:d,offenders:[],tags:["debug"]})}{const e=[];for(const g of a.references||[])if(g.external)try{const d=new URL(g.url,"https://x");Gt.some(f=>d.hostname.toLowerCase().includes(f))&&e.push({path:g.from,detail:g.url})}catch{}const r=e.length,c=r>=5?"FAIL":r>0?"WARN":"PASS";t.push({id:"measurement",title:"Measurement Pixels",severity:c,messages:[`${r} known tracking references`,"Target: < 5"],offenders:e})}{const e=[],r=l.filter(c=>/\.(js|html?)$/i.test(c)).map(c=>new TextDecoder().decode(n.files[c])).join(`
`);/createjs\./i.test(r)&&e.push("CreateJS"),/gsap\(|TweenMax|TweenLite/i.test(r)&&e.push("GSAP"),/pixi\.js/i.test(r)&&e.push("PixiJS"),/jquery|\$\(/i.test(r)&&e.push("jQuery"),t.push({id:"html5lib",title:"HTML5 Library",severity:e.length?"FAIL":"PASS",messages:[e.length?e.join(", "):"None detected"],offenders:[]})}{const e=l.filter(d=>/(\.mp4|\.webm|\.ogg|\.mov)$/i.test(d)),r=(m.match(/<iframe\b/gi)||[]).length,c=l.filter(d=>/(\.png|\.jpe?g|\.gif|\.webp)$/i.test(d)),g=[];for(const d of c){const f=n.files[d].byteLength;f>300*1024&&/\.png$/i.test(d)&&g.push({path:d,detail:`PNG ${Math.round(f/1024)} KB — consider JPEG/WebP`})}t.push({id:"video",title:"Has Video",severity:"PASS",messages:[e.length?`${e.length} video file(s)`:"No"],offenders:e.map(d=>({path:d})),tags:["debug"]}),t.push({id:"iframes",title:"Iframe Count",severity:r>0?"WARN":"PASS",messages:[`iframes (static HTML): ${r}`],offenders:[]}),t.push({id:"imagesOptimized",title:"Images Optimized",severity:g.length?"FAIL":"PASS",messages:[g.length?`${g.length} image(s) could be optimized`:"OK"],offenders:g,tags:["debug"]})}if(n&&n.files){const e=Object.keys(n.files).some(r=>/^index\.html?$/i.test(r.split("/").pop()||""));t.push({id:"indexFile",title:"Index File Check",severity:e?"PASS":"FAIL",messages:[e?"index.html present":"index.html not found at root"],offenders:[]})}{const e=window.__audit_last_summary,r=(e==null?void 0:e.errors)||0;t.push({id:"syntaxErrors",title:"Syntax Errors",severity:r>0?"FAIL":"PASS",messages:[`Uncaught errors: ${r}`],offenders:[]})}{const e=window.__audit_last_summary,r=(e==null?void 0:e.documentWrites)||0,c=(e==null?void 0:e.jquery)||!1;t.push({id:"no-document-write",title:"Avoid document.write()",severity:r>0?"WARN":"PASS",messages:[r>0?`Calls detected: ${r}`:"No document.write usage detected"],offenders:[]}),t.push({id:"jquery",title:"Uses jQuery",severity:c?"WARN":"PASS",messages:[c?"Detected":"Not detected"],offenders:[]})}{const e=Object.keys(n.files).filter(c=>/(^|\/)backup\.(png|jpe?g|gif)$/i.test(c)),r=e.length?"WARN":"PASS";t.push({id:"no-backup-in-zip",title:"No Backup Image Inside ZIP",severity:r,messages:[e.length?`Found: ${e[0]}`:"No backup image in ZIP"],offenders:e.slice(0,5).map(c=>({path:c}))})}{const e=[];for(const r of a.references||[]){if(!r.inZip)continue;const c=String(r.url||"");(c.startsWith("/")||/^https?:\/\//i.test(c))&&e.push({path:r.from,line:r.line,detail:c})}t.push({id:"relative-refs",title:"Relative Paths For Packaged Assets",severity:e.length?"WARN":"PASS",messages:[e.length?`${e.length} absolute path reference(s) found`:"All packaged asset references are relative"],offenders:e})}if(b){const e=[];try{const q=m||"",O=Array.from(q.matchAll(/<style[^>]*>([\s\S]*?)<\/style>/gi)).map(E=>E[1]||"");e.push(...O);for(const E of l)if(/\.css$/i.test(E))try{e.push(new TextDecoder().decode(n.files[E]))}catch{}}catch{}let r=!1;const c=[];for(const q of e){const O=q.split(/\r?\n/);for(let E=0;E<O.length;E++){const ee=O[E];/\bborder(?:-top|-right|-bottom|-left|)\s*:\s*\d+px\s+(solid|dashed|double)/i.test(ee)&&(r=!0,c.push({path:"(css)",line:E+1,detail:ee.trim().slice(0,200)}))}}let g=r||/\bborder\s*:\s*\d+px\s+(solid|dashed|double)\b/i.test(m),d=[];const f=[];g&&d.push("Detected via CSS border");try{let q=function(de){const Z={};return de.split(";").forEach(we=>{const[xe,Ae]=we.split(":");!xe||!Ae||(Z[xe.trim().toLowerCase()]=Ae.trim().toLowerCase())}),Z},O=function(de){return de?/^0(px|)$/.test(de)||de==="0":!1},E=function(de){return de?!!/^([1-9]|1[0-6])(px)?$/.exec(de):!1},ee=function(de){return de?/^100%$/.test(de):!1},pe=function(de){return de?!/transparent|rgba\(0,\s*0,\s*0,\s*0\)/i.test(de)&&/#|rgb|hsl|\bblack\b|\bwhite\b|\bred\b|\bblue\b|\bgreen\b|\byellow\b|\bgray\b/i.test(de):!1};const ye=new DOMParser().parseFromString(m,"text/html"),ve=Array.from(ye.querySelectorAll("[style]"));let fe=!1,N=!1,K=!1,oe=!1;for(const de of ve){const Z=q(de.getAttribute("style")||""),we=Z["background-color"]||Z.background||"";if((Z.position||"")==="absolute"){if(O(Z.top)&&O(Z.left)&&ee(Z.width)&&E(Z.height)&&pe(we)){fe=!0,f.push({path:"(inline)",detail:`top line ${Z.height||""} via absolute div`});continue}if(O(Z.bottom)&&O(Z.left)&&ee(Z.width)&&E(Z.height)&&pe(we)){N=!0,f.push({path:"(inline)",detail:`bottom line ${Z.height||""} via absolute div`});continue}if(O(Z.left)&&O(Z.top)&&ee(Z.height)&&E(Z.width)&&pe(we)){K=!0,f.push({path:"(inline)",detail:`left line ${Z.width||""} via absolute div`});continue}if(O(Z.right)&&O(Z.top)&&ee(Z.height)&&E(Z.width)&&pe(we)){oe=!0,f.push({path:"(inline)",detail:`right line ${Z.width||""} via absolute div`});continue}}}const be=[fe,N,K,oe].filter(Boolean).length;be>=3&&(g=!0,d.push(`Detected via ${be} edge lines`))}catch{}try{const q=window.__audit_last_summary;q&&(q.borderSides||q.borderCssRules)&&((q.borderSides||0)>=3||(q.borderCssRules||0)>0)&&(g=!0,d.push(`Detected at runtime (${q.borderSides||0} sides, ${q.borderCssRules||0} css rule(s))`))}catch{}const w=g?"PASS":"WARN",$=window.__audit_last_summary,P=($==null?void 0:$.borderSides)??0,V=($==null?void 0:$.borderCssRules)??0,Y=[`Border detected: ${g?"yes":"no"}`,`Sides detected: ${P}`,`CSS rules: ${V}`],U=g?c.concat(f).slice(0,100):f.slice(0,4);t.push({id:"border",title:"Border Present",severity:w,messages:Y,offenders:U})}{const e=window.__audit_last_summary,r=((e==null?void 0:e.frames)||0)>0||typeof(e==null?void 0:e.visualStart)=="number",c=!!(m&&/<body[\s>]/i.test(m)),g=r||c,d=[];r?d.push("Rendered (preview)"):c?d.push("Rendered (static HTML)"):d.push("No render signal captured"),t.push({id:"creativeRendered",title:"Creative Rendered",severity:g?"PASS":"FAIL",messages:d,offenders:[]})}{const e=window.__audit_last_summary,r=(e==null?void 0:e.network)||0,c=(e==null?void 0:e.runtimeIframes)??0;t.push({id:"runtimeIframes",title:"Runtime Iframes",severity:c>0?"WARN":"PASS",messages:[`Iframes created/observed at runtime: ${c}`],offenders:[],tags:["debug"]}),t.push({id:"networkDynamic",title:"Runtime Network Requests",severity:r>0?"WARN":"PASS",messages:[`Runtime requests: ${r}`],offenders:[],tags:["debug"]})}{const e=[];for(const r of a.references||[])try{const c=String(r.url||"");try{new URL(c,"https://x")}catch{e.push({path:r.from,line:r.line,detail:`Invalid URL: ${c}`});continue}if(r.inZip&&r.normalized){const g=r.normalized.toLowerCase(),d=(M=n.lowerCaseIndex)==null?void 0:M[g];(!d||!n.files[d])&&e.push({path:r.from,line:r.line,detail:`Missing packaged asset: ${c}`})}!r.external&&/^\//.test(c)&&e.push({path:r.from,line:r.line,detail:`Absolute path not packaged: ${c}`})}catch{}t.push({id:"invalid-url-ref",title:"Invalid URL References",severity:e.length?"FAIL":"PASS",messages:[e.length?`${e.length} invalid/broken reference(s)`:"All references valid"],offenders:e});{const r=new Set;for(const g of a.references||[])g.inZip&&g.normalized&&r.add(g.normalized.toLowerCase());(h=a.primary)!=null&&h.path&&r.add(a.primary.path.toLowerCase());const c=[];for(const g of l){const d=g.toLowerCase();r.has(d)||c.push({path:g})}t.push({id:"orphaned-assets",title:"Orphaned Assets (Not Referenced)",severity:c.length?"WARN":"PASS",messages:[c.length?v?`${c.length} file(s) not referenced by entry file: ${v}`:`${c.length} file(s) not referenced by entry`:"All files referenced by entry"],offenders:c.slice(0,50)})}{const r=[],c=/[%#?;\\:*"|<>]/g;for(const q of l){const O=(q.split("/").pop()||q).toString(),E=[],ee=O.match(c);if(ee&&ee.length){const pe=Array.from(new Set(ee));E.push(`illegal character(s): ${pe.join(" ")}`)}/[ -]/.test(O)&&E.push("control characters present"),E.length&&r.push({path:q,detail:E.join("; ")})}const g=String(a.bundleName||n.name||"");let d="",f=!0;const w=[],$=a.adSize;if($&&typeof $.width=="number"&&typeof $.height=="number"&&g){const q=Math.round($.width),O=Math.round($.height),E=`${q}x${O}`;new RegExp(`(^|[^0-9])${q}s*[xX]s*${O}([^0-9]|$)`).test(g)?d=`Correct dimensions found in file name (${E})`:(f=!1,d=`Expected ${E} in ZIP name "${g}"`,w.push({path:g,detail:`missing ${E}`}))}else d="Creative dimensions unavailable for filename check";const P=r.length>0,V=P||!f?"FAIL":"PASS",Y=[];P?Y.push(`Disallowed characters found in ${r.length} file(s)`):Y.push("No disallowed characters"),d&&Y.push(d);const U=r.concat(w).slice(0,200);t.push({id:"bad-filenames",title:"Problematic Filenames",severity:V,messages:Y,offenders:U})}{const r=[];for(const c of l){const g=c.toLowerCase();if(/\.html?$/.test(g))try{const d=new TextDecoder().decode(n.files[c]);new DOMParser().parseFromString(d,"text/html").querySelector("parsererror")&&r.push({path:c,detail:"HTML parser error"})}catch{r.push({path:c,detail:"HTML parse exception"})}if(/\.svg$/.test(g))try{const d=new TextDecoder().decode(n.files[c]);new DOMParser().parseFromString(d,"image/svg+xml").querySelector("parsererror")&&r.push({path:c,detail:"SVG parser error"})}catch{r.push({path:c,detail:"SVG parse exception"})}if(/\.css$/.test(g))try{const d=new TextDecoder().decode(n.files[c]),f=(d.match(/\{/g)||[]).length,w=(d.match(/\}/g)||[]).length;f!==w&&r.push({path:c,detail:`Unmatched braces {${f}} vs }${w}`})}catch{r.push({path:c,detail:"CSS read exception"})}}t.push({id:"invalid-markup",title:"Invalid Markup (HTML/CSS/SVG)",severity:r.length?"WARN":"PASS",messages:[r.length?`${r.length} file(s) with syntax issues (heuristic)`:"No syntax issues detected"],offenders:r.slice(0,100)})}{let r=!1;const c=[];for(const g of l)if(/\.(html?|js|css)$/i.test(g))try{const d=new TextDecoder().decode(n.files[g]);(/gwd-\w+/i.test(d)||/gwd-events-support\.js/i.test(d)||/google web designer/i.test(d)||/<meta[^>]+name=["']generator["'][^>]+google web designer/i.test(d))&&(r=!0,c.push({path:g,detail:"GWD environment markers"}))}catch{}t.push({id:"gwd-env-check",title:"GWD Environment Check",severity:r?"WARN":"PASS",messages:[r?"Google Web Designer environment artifacts detected":"No GWD environment markers detected"],offenders:c})}{const r=[],c=/window\.open\s*\(\s*['"]https?:/i,g=/(window|document|top)\.location\s*=\s*['"]https?:/i,d=/<a\s+[^>]*href=["']https?:[^"']+["'][^>]*>/i;for(const f of l)if(/\.(js|html?)$/i.test(f))try{const w=new TextDecoder().decode(n.files[f]);c.test(w)&&r.push({path:f,detail:'window.open("http(s)://…")'}),g.test(w)&&r.push({path:f,detail:'location = "http(s)://…"'}),/\.html?$/i.test(f)&&d.test(w)&&r.push({path:f,detail:'<a href="http(s)://…">'})}catch{}t.push({id:"hardcoded-click",title:"Hard-coded Clickthrough",severity:r.length?"WARN":"PASS",messages:[r.length?`${r.length} potential hard-coded clickthrough(s)`:"No hard-coded clickthrough detected"],offenders:r.slice(0,100)})}}{const e=(a.initialBytes||0)/1024,r=((A=window.__audit_last_summary)==null?void 0:A.cpuScore)||0,c=e>4e3||r>.5;t.push({id:"heavyAdRisk",title:"Heavy Ad Intervention (Risk)",severity:c?"WARN":"PASS",messages:[`InitialKB ${e.toFixed(1)}, CPU ${r.toFixed?r.toFixed(2):r}`],offenders:[],tags:["debug"]})}return t}function Ve(n){const a=n.toLowerCase();return a.endsWith(".png")?"image/png":a.endsWith(".jpg")||a.endsWith(".jpeg")?"image/jpeg":a.endsWith(".gif")?"image/gif":a.endsWith(".webp")?"image/webp":a.endsWith(".mp4")?"video/mp4":a.endsWith(".webm")?"video/webm":a.endsWith(".ogg")?"video/ogg":a.endsWith(".mov")?"video/quicktime":a.endsWith(".mp3")?"audio/mpeg":a.endsWith(".wav")?"audio/wav":a.endsWith(".m4a")?"audio/mp4":"application/octet-stream"}const xt=["pkg-format","entry-html","clicktag","allowed-ext","file-limits","primaryAsset","assetReferences","httpsOnly","iframe-safe","no-webstorage","bad-filenames","systemArtifacts","syntaxErrors","creativeRendered","iabWeight","host-requests-initial","cpu-budget","animation-cap","border"],De=new Set(xt);async function Jt(n,a){const o=new TextDecoder,t={},l={},u={};for(const M of Object.keys(n.files))u[M.toLowerCase()]=M;const m=M=>{const h=n.files[M]?M:u[M.toLowerCase()]||M;if(t[h])return t[h];const A=n.files[h],e=A.buffer.slice(A.byteOffset,A.byteOffset+A.byteLength),r=new Blob([e],{type:Qt(M)}),c=URL.createObjectURL(r);return t[h]=c,l[c]=A.byteLength,c};for(const M of Object.keys(n.files))m(M);const v=o.decode(n.files[a]),I=new DOMParser().parseFromString(v,"text/html");try{const M=I.querySelector("head");if(M){const h=I.createElement("style");h.textContent=`
				html, body { margin: 0 !important; overflow: hidden !important; background: transparent !important; }
				gwd-page, gwd-pagedeck, gwd-google-ad, .gwd-page-container, .gwd-page-content {
					visibility: visible !important;
					opacity: 1 !important;
				}
				html, body { min-height: 100%; }
			`,M.appendChild(h)}}catch{}const b=[["img","src"],["script","src"],["link","href"],["video","src"],["audio","src"],["source","src"]];for(const[M,h]of b)I.querySelectorAll(`${M}[${h}]`).forEach(A=>{const e=A.getAttribute(h);if(!e)return;const r=qe(a,e);if(r){const c=n.files[r]?r:u[r.toLowerCase()];c&&A.setAttribute(h,t[c])}});I.querySelectorAll("[style]").forEach(M=>{const h=M.getAttribute("style")||"";M.setAttribute("style",Ye(h,a,n,t,u))}),I.querySelectorAll("style").forEach(M=>{M.textContent=Ye(M.textContent||"",a,n,t,u)});for(const M of Array.from(I.querySelectorAll('link[rel="stylesheet"][href]'))){const h=M.getAttribute("href");if(!h)continue;const A=qe(a,h),e=A?n.files[A]?A:u[A.toLowerCase()]:void 0;if(e&&n.files[e]){const r=new TextDecoder().decode(n.files[e]),c=Ye(r,e,n,t,u),g=I.createElement("style");g.textContent=c,M.replaceWith(g)}}try{I.querySelectorAll("img[srcset], source[srcset]").forEach(M=>{const h=M.getAttribute("srcset")||"";if(!h)return;const A=h.split(",").map(e=>{const r=e.trim(),c=r.split(/\s+/),g=c[0],d=c.slice(1).join(" "),f=qe(a,g),w=f?n.files[f]?f:u[f.toLowerCase()]:void 0;if(w&&n.files[w]){const $=t[w];return d?`${$} ${d}`:$}return r}).join(", ");M.setAttribute("srcset",A)})}catch{}const S=Xt(),L=I.querySelector("body");if(L){const M=`window.__AUDIT_ASSET_MAP = ${JSON.stringify({primary:a,map:t,sizes:l})};
;(${S})()`,h=new Blob([M],{type:"text/javascript"}),A=URL.createObjectURL(h),e=I.createElement("script");e.type="text/javascript",e.src=A,e.defer=!1,e.async=!1,L.appendChild(e)}return{html:`<!doctype html>
`+I.documentElement.outerHTML,blobMap:t,originalHtml:v}}function Qt(n){const a=n.toLowerCase();return a.endsWith(".png")?"image/png":a.endsWith(".jpg")||a.endsWith(".jpeg")?"image/jpeg":a.endsWith(".gif")?"image/gif":a.endsWith(".webp")?"image/webp":a.endsWith(".svg")?"image/svg+xml":a.endsWith(".mp4")?"video/mp4":a.endsWith(".webm")?"video/webm":a.endsWith(".ogg")?"video/ogg":a.endsWith(".mov")?"video/quicktime":a.endsWith(".mp3")?"audio/mpeg":a.endsWith(".wav")?"audio/wav":a.endsWith(".m4a")?"audio/mp4":a.endsWith(".css")?"text/css":a.endsWith(".js")?"text/javascript":a.endsWith(".html")||a.endsWith(".htm")?"text/html":"application/octet-stream"}function Ye(n,a,o,t,l){return n.replace(/url\(([^)]+)\)/gi,(u,m)=>{let v=String(m).trim().replace(/^[\'"]|[\'"]$/g,"");const I=qe(a,v),b=I?o.files[I]?I:l[I.toLowerCase()]:void 0;return b&&o.files[b]?`url(${t[b]})`:u})}function qe(n,a){if(/^https?:/i.test(a)||/^data:/i.test(a)||a.startsWith("javascript:"))return;if(a.startsWith("/"))return a.slice(1);a.startsWith("./")&&(a=a.slice(2));const o=n.split("/").slice(0,-1).join("/");return(o?o+"/"+a:a).split("/").filter(u=>u&&u!==".").reduce((u,m)=>(m===".."?u.pop():u.push(m),u),[]).join("/")}function Xt(){return function(){try{let ze=function(){try{parent.postMessage({__audit_event:1,type:"summary",summary:o},"*");try{window.__audit_last_summary=o}catch{}Fe++,Fe<10&&setTimeout(ze,500)}catch{}};var a=function(i){try{parent.postMessage(Object.assign({__audit_event:1},i),"*")}catch{}},o={domContentLoaded:void 0,visualStart:void 0,frames:0,consoleErrors:0,consoleWarnings:0,dialogs:0,cookies:0,localStorage:0,errors:0,documentWrites:0,jquery:!1,clickUrl:"",memoryMB:void 0,memoryMinMB:void 0,memoryMaxMB:void 0,cpuScore:void 0,network:0,runtimeIframes:0,rewrites:0,imgRewrites:0,mediaRewrites:0,scriptRewrites:0,linkRewrites:0,setAttrRewrites:0,styleUrlRewrites:0,styleAttrRewrites:0,domImages:0,domBgUrls:0,enablerStub:!1,animMaxDurationS:void 0,animMaxLoops:void 0,animInfinite:!1},o={domContentLoaded:void 0,visualStart:void 0,frames:0,consoleErrors:0,consoleWarnings:0,dialogs:0,cookies:0,localStorage:0,errors:0,documentWrites:0,jquery:!1,clickUrl:"",memoryMB:void 0,memoryMinMB:void 0,memoryMaxMB:void 0,cpuScore:void 0,network:0,runtimeIframes:0,rewrites:0,imgRewrites:0,mediaRewrites:0,scriptRewrites:0,linkRewrites:0,setAttrRewrites:0,styleUrlRewrites:0,styleAttrRewrites:0,domImages:0,domBgUrls:0,enablerStub:!1,animMaxDurationS:void 0,animMaxLoops:void 0,animInfinite:!1};try{o.initialRequests=0,o.totalRequests=0,o.initialBytes=0,o.subloadBytes=0}catch{}try{window.addEventListener("error",function(i){try{o.errors++,a({type:"error",message:String(i&&i.message||"error")})}catch{}})}catch{}try{var t=console.error;console.error=function(){try{o.consoleErrors++,a({type:"console",level:"error",message:Array.prototype.join.call(arguments," ")})}catch{}try{return t.apply(this,arguments)}catch{}}}catch{}try{var l=console.warn;console.warn=function(){try{o.consoleWarnings++,a({type:"console",level:"warn",message:Array.prototype.join.call(arguments," ")})}catch{}try{return l.apply(this,arguments)}catch{}}}catch{}try{var u=window.alert;window.alert=function(i){try{o.dialogs++,a({type:"dialog",kind:"alert",text:String(i)})}catch{}return u.apply(this,arguments)}}catch{}try{var m=window.confirm;window.confirm=function(i){try{o.dialogs++,a({type:"dialog",kind:"confirm",text:String(i)})}catch{}return m.apply(this,arguments)}}catch{}try{var v=window.prompt;window.prompt=function(i,j){try{o.dialogs++,a({type:"dialog",kind:"prompt",text:String(i)})}catch{}return v.apply(this,arguments)}}catch{}try{Object.defineProperty(Document.prototype,"cookie",{set:function(i){try{o.cookies++,a({type:"cookie",value:String(i)})}catch{}}})}catch{}try{var I=window.localStorage,b=I.setItem,S=I.removeItem,L=I.clear;I.setItem=function(i,j){try{o.localStorage++,a({type:"storage",op:"set",key:String(i),value:String(j)})}catch{}return b.apply(this,arguments)},I.removeItem=function(i){try{a({type:"storage",op:"remove",key:String(i)})}catch{}return S.apply(this,arguments)},I.clear=function(){try{a({type:"storage",op:"clear"})}catch{}return L.apply(this,arguments)}}catch{}try{var T=window.fetch;window.fetch=function(i){try{o.network++,a({type:"network",kind:"fetch",url:String(i)})}catch{}return T.apply(this,arguments)}}catch{}try{var M=window.XMLHttpRequest,h=M&&M.prototype;if(h&&h.open){var A=h.open;h.open=function(i,j){try{o.network++,a({type:"network",kind:"xhr",url:String(j)})}catch{}return A.apply(this,arguments)}}}catch{}try{var e=document.write;document.write=function(){try{o.documentWrites++}catch{}try{return e.apply(document,arguments)}catch{}}}catch{}try{var r=window;o.jquery=!!(r.jQuery||r.$)}catch{}try{(function(){try{let ae=function(k){try{if(!k||typeof k!="string"||/transparent/i.test(k))return!1;var R=k.match(/rgba\(([^)]+)\)/i);if(R){var H=R[1].split(",").map(function(B){return parseFloat(B.trim())});if(H.length>=4&&H[3]===0)return!1}return!0}catch{return!1}},X=function(k){k.__probe_mat||(k.__probe_mat=[1,0,0,1,0,0]),k.__probe_stack||(k.__probe_stack=[])},Q=function(k,R){return[k[0]*R[0]+k[2]*R[1],k[1]*R[0]+k[3]*R[1],k[0]*R[2]+k[2]*R[3],k[1]*R[2]+k[3]*R[3],k[0]*R[4]+k[2]*R[5]+k[4],k[1]*R[4]+k[3]*R[5]+k[5]]},te=function(k,R,H){return[k[0]*R+k[2]*H+k[4],k[1]*R+k[3]*H+k[5]]},se=function(k,R,H,B,G){try{var ne=6,re=k&&k.canvas;if(!re)return!1;var le=re.width||0,ge=re.height||0;return le<=0||ge<=0?!1:R<=ne&&H<=ne&&B>=le-ne&&G>=ge-ne}catch{return!1}};var i=window.CanvasRenderingContext2D;if(!i||!i.prototype)return;var j=i.prototype.strokeRect,C=i.prototype.rect,p=i.prototype.stroke,y=i.prototype.beginPath,x=i.prototype.moveTo,_=i.prototype.lineTo,F=i.prototype.closePath,W=i.prototype.save,J=i.prototype.restore,ie=i.prototype.setTransform,me=i.prototype.transform,he=i.prototype.translate,Se=i.prototype.scale,z=i.prototype.rotate;i.prototype.save=function(){try{X(this),this.__probe_stack.push(this.__probe_mat.slice())}catch{}return W.apply(this,arguments)},i.prototype.restore=function(){try{X(this);var k=this.__probe_stack.pop();k&&(this.__probe_mat=k)}catch{}return J.apply(this,arguments)},i.prototype.setTransform=function(k,R,H,B,G,ne){try{X(this),this.__probe_mat=[k,R,H,B,G,ne]}catch{}return ie.apply(this,arguments)},i.prototype.transform=function(k,R,H,B,G,ne){try{X(this),this.__probe_mat=Q(this.__probe_mat,[k,R,H,B,G,ne])}catch{}return me.apply(this,arguments)},i.prototype.translate=function(k,R){try{X(this),this.__probe_mat=Q(this.__probe_mat,[1,0,0,1,k,R])}catch{}return he.apply(this,arguments)},i.prototype.scale=function(k,R){try{X(this),this.__probe_mat=Q(this.__probe_mat,[k,0,0,R,0,0])}catch{}return Se.apply(this,arguments)},i.prototype.rotate=function(k){try{X(this);var R=Math.cos(k),H=Math.sin(k);this.__probe_mat=Q(this.__probe_mat,[R,H,-H,R,0,0])}catch{}return z.apply(this,arguments)},i.prototype.strokeRect=function(k,R,H,B){try{var G=this.lineWidth||1,ne=this.strokeStyle;if(X(this),G>0&&ae(ne)){var re=te(this.__probe_mat,k,R),le=te(this.__probe_mat,k+H,R),ge=te(this.__probe_mat,k+H,R+B),je=te(this.__probe_mat,k,R+B),Ce=Math.min(re[0],le[0],ge[0],je[0]),Le=Math.min(re[1],le[1],ge[1],je[1]),Me=Math.max(re[0],le[0],ge[0],je[0]),Re=Math.max(re[1],le[1],ge[1],je[1]);if(se(this,Ce,Le,Me,Re)){try{o.borderSides=Math.max(o.borderSides||0,4)}catch{}try{o.borderCssRules=Math.max(0,(o.borderCssRules||0)+1)}catch{}}}}catch{}return j.apply(this,arguments)},i.prototype.rect=function(k,R,H,B){try{X(this);var G=te(this.__probe_mat,k,R),ne=te(this.__probe_mat,k+H,R),re=te(this.__probe_mat,k+H,R+B),le=te(this.__probe_mat,k,R+B),ge=Math.min(G[0],ne[0],re[0],le[0]),je=Math.min(G[1],ne[1],re[1],le[1]),Ce=Math.max(G[0],ne[0],re[0],le[0]),Le=Math.max(G[1],ne[1],re[1],le[1]);this.__probe_lastBounds={minX:ge,minY:je,maxX:Ce,maxY:Le}}catch{}return C.apply(this,arguments)},i.prototype.beginPath=function(){try{X(this),this.__probe_pts=[]}catch{}return y.apply(this,arguments)},i.prototype.moveTo=function(k,R){try{X(this);var H=this.__probe_pts;if(H){var B=te(this.__probe_mat,k,R);H.push([B[0],B[1]])}}catch{}return x.apply(this,arguments)},i.prototype.lineTo=function(k,R){try{X(this);var H=this.__probe_pts;if(H){var B=te(this.__probe_mat,k,R);H.push([B[0],B[1]])}}catch{}return _.apply(this,arguments)},i.prototype.closePath=function(){try{var k=this.__probe_pts;k&&(k.closed=!0)}catch{}return F.apply(this,arguments)},i.prototype.stroke=function(){try{var k=this.lineWidth||1,R=this.strokeStyle,H=this.__probe_lastBounds;if(H&&k>0&&ae(R)&&se(this,H.minX,H.minY,H.maxX,H.maxY)){try{o.borderSides=Math.max(o.borderSides||0,4)}catch{}try{o.borderCssRules=Math.max(0,(o.borderCssRules||0)+1)}catch{}}else try{var B=this.__probe_pts||[],G=this.canvas,ne=G&&G.width||0,re=G&&G.height||0;if(ne>0&&re>0&&B&&B.length>=4&&k>0&&ae(R)){for(var le=1/0,ge=1/0,je=-1/0,Ce=-1/0,Le=0;Le<B.length;Le++){var Me=B[Le];Me&&(Me[0]<le&&(le=Me[0]),Me[1]<ge&&(ge=Me[1]),Me[0]>je&&(je=Me[0]),Me[1]>Ce&&(Ce=Me[1]))}if(se(this,le,ge,je,Ce)){try{o.borderSides=Math.max(o.borderSides||0,4)}catch{}try{o.borderCssRules=Math.max(0,(o.borderCssRules||0)+1)}catch{}}}}catch{}}catch{}return p.apply(this,arguments)}}catch{}})()}catch{}try{let i=function(p,y){try{parent.postMessage({type:"creative-click",url:typeof p=="string"?p:"",meta:y||{}},"*"),o.clickUrl=String(p||"")}catch{}},j=function(){try{return typeof window.clickTag=="string"?window.clickTag:typeof window.clickTAG=="string"?window.clickTAG:""}catch{return""}},C=function(){try{let F=function(W,J,ie){try{var me=typeof J=="string",he=me&&J.length?J:j(),Se=!0;i(he||"",{source:ie,name:String(W||""),present:Se});try{c.call(window,he&&he.length?he:"about:blank")}catch{}}catch{}};var p=window.Enabler;if(!p)return;if(typeof p.exit=="function"){var y=p.exit.bind(p);p.exit=function(W,J){try{F(W,J,"Enabler.exit")}catch{}try{return y.apply(p,arguments)}catch{}}}if(typeof p.exitOverride=="function"){var x=p.exitOverride.bind(p);p.exitOverride=function(W,J){try{F(W,J,"Enabler.exitOverride")}catch{}try{return x.apply(p,arguments)}catch{}}}if(typeof p.dynamicExit=="function"){var _=p.dynamicExit.bind(p);p.dynamicExit=function(W,J){try{F(W,J,"Enabler.dynamicExit")}catch{}try{return _.apply(p,arguments)}catch{}}}}catch{}};document.addEventListener("click",function(p){try{for(var y=p.target,x="";y&&y!==document.body;){if(y.tagName&&y.tagName.toUpperCase()==="A"&&y.href){x=y.getAttribute("href")||y.href;break}y=y.parentElement}x||(x=j()),x&&(p.preventDefault(),i(x,{source:"user"}))}catch{}},!0);var c=window.open;window.open=function(p){try{i(typeof p=="string"?p:j(),{source:"window.open"})}catch{}try{return c.apply(this,arguments)}catch{return null}},C();var g=0,d=setInterval(function(){g++;try{window.Enabler&&(C(),clearInterval(d))}catch{}if(g>20)try{clearInterval(d)}catch{}},200);setTimeout(function(){try{if(!window.Enabler){var p={};window.studio={events:{StudioEvent:{INIT:"init",PAGE_LOADED:"page_loaded",VISIBLE:"visible",VISIBILITY_CHANGED:"visible"}}},window.Enabler={isInitialized:function(){return!0},isPageLoaded:function(){return!0},isVisible:function(){return!0},addEventListener:function(y,x){(p[y]=p[y]||[]).push(x)},removeEventListener:function(y,x){p[y]&&(p[y]=p[y].filter(function(_){return _!==x}))},dispatch:function(y){(p[y]||[]).forEach(function(x){try{x()}catch{}})},exit:function(y,x){try{window.open(x||window.clickTag||"about:blank")}catch{}},exitOverride:function(y,x){try{window.open(x||window.clickTag||"about:blank")}catch{}},dynamicExit:function(y,x){try{window.open(x||window.clickTag||"about:blank")}catch{}},loadScript:function(y,x){try{var _=document.createElement("script");_.src=String(y),_.onload=function(){x&&x()},document.head.appendChild(_)}catch{}}},o.enablerStub=!0;try{window.Enabler.dispatch(window.studio.events.StudioEvent.INIT)}catch{}try{window.Enabler.dispatch(window.studio.events.StudioEvent.PAGE_LOADED)}catch{}try{window.Enabler.dispatch(window.studio.events.StudioEvent.VISIBLE)}catch{}}}catch{}},1500)}catch{}try{let i=function(p){return String(p||"").replace(/[?#].*$/,"")},j=function(p,y){try{if(/^https?:/i.test(y)||/^data:/i.test(y)||/^blob:/i.test(y)||/^javascript:/i.test(y))return;if(y.startsWith("/"))return y.slice(1);y.startsWith("./")&&(y=y.slice(2));var x=p.split("/").slice(0,-1).join("/"),_=x?x+"/"+y:y,F=[];return _.split("/").forEach(function(W){!W||W==="."||(W===".."?F.pop():F.push(W))}),F.join("/")}catch{return}},C=function(p){try{var y=j(f.primary||"",p);if(!y)return p;var x=i(y),_=f.map[x];if(_){try{o.rewrites++}catch{}return _}var F=x.toLowerCase();for(var W in f.map)if(W.toLowerCase()===F){try{o.rewrites++}catch{}return f.map[W]}return p}catch{return p}};var f=window.__AUDIT_ASSET_MAP||{primary:"",map:{}};try{var w=Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src");w&&w.set&&Object.defineProperty(HTMLImageElement.prototype,"src",{set:function(p){try{var y=C(String(p));if(y!==p)try{o.imgRewrites++}catch{}p=y}catch{}return w.set.call(this,p)}})}catch{}try{var $=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"src");$&&$.set&&Object.defineProperty(HTMLMediaElement.prototype,"src",{set:function(p){try{var y=C(String(p));if(y!==p)try{o.mediaRewrites++}catch{}p=y}catch{}return $.set.call(this,p)}})}catch{}try{var P=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src");P&&P.set&&Object.defineProperty(HTMLScriptElement.prototype,"src",{set:function(p){try{var y=C(String(p));if(y!==p)try{o.scriptRewrites++}catch{}p=y}catch{}return P.set.call(this,p)}})}catch{}try{var V=Object.getOwnPropertyDescriptor(HTMLLinkElement.prototype,"href");V&&V.set&&Object.defineProperty(HTMLLinkElement.prototype,"href",{set:function(p){try{var y=C(String(p));if(y!==p)try{o.linkRewrites++}catch{}p=y}catch{}return V.set.call(this,p)}})}catch{}try{var Y=Element.prototype.setAttribute;Element.prototype.setAttribute=function(p,y){try{var x=this&&this.tagName?String(this.tagName).toUpperCase():"",_=String(p).toLowerCase();if(_==="src"&&/^(IMG|VIDEO|AUDIO|SCRIPT|SOURCE)$/i.test(x)){var F=C(String(y));if(F!==y)try{o.setAttrRewrites++}catch{}y=F}if(x==="LINK"&&_==="href"){var W=C(String(y));if(W!==y)try{o.setAttrRewrites++}catch{}y=W}if(_==="style"&&typeof y=="string"&&/url\(/i.test(String(y)))try{var J=String(y).replace(/url\(([^)]+)\)/ig,function(ie,me){try{o.styleAttrRewrites++}catch{}var he=String(me).trim().replace(/^['"]|['"]$/g,"");return"url("+C(he)+")"});y=J}catch{}}catch{}return Y.call(this,p,y)}}catch{}try{var U=CSSStyleDeclaration&&CSSStyleDeclaration.prototype&&CSSStyleDeclaration.prototype.setProperty?CSSStyleDeclaration.prototype.setProperty:null;U&&(CSSStyleDeclaration.prototype.setProperty=function(p,y,x){try{typeof y=="string"&&/url\(/i.test(y)&&(y=String(y).replace(/url\(([^)]+)\)/ig,function(_,F){try{o.styleUrlRewrites++}catch{}var W=String(F).trim().replace(/^['"]|['"]$/g,"");return"url("+C(W)+")"}))}catch{}return U.call(this,p,y,x)})}catch{}try{var q=new MutationObserver(function(p){try{p.forEach(function(y){Array.prototype.slice.call(y.addedNodes||[]).forEach(function(x){try{if(x&&x.nodeType===1&&String(x.nodeName).toUpperCase()==="STYLE"){var _=x.textContent||"";/url\(/i.test(_)&&(x.textContent=String(_).replace(/url\(([^)]+)\)/ig,function(F,W){var J=String(W).trim().replace(/^['"]|['"]$/g,"");return"url("+C(J)+")"}))}}catch{}})})}catch{}});q.observe(document.documentElement,{childList:!0,subtree:!0})}catch{}try{var O=CSSStyleDeclaration&&Object.getOwnPropertyDescriptor(CSSStyleDeclaration.prototype,"cssText");O&&O.set&&Object.defineProperty(CSSStyleDeclaration.prototype,"cssText",{set:function(p){try{typeof p=="string"&&/url\(/i.test(p)&&(p=String(p).replace(/url\(([^)]+)\)/ig,function(y,x){try{o.styleUrlRewrites++}catch{}var _=String(x).trim().replace(/^['"]|['"]$/g,"");return"url("+C(_)+")"}))}catch{}return O.set.call(this,p)}})}catch{}try{setInterval(function(){try{var y=Array.prototype.slice.call(document.images||[]),x=y.filter(function(ie){return ie&&ie.naturalWidth>0}).length,_=0;try{for(var F=document.querySelectorAll("*"),W=0;W<F.length;W++){var J=getComputedStyle(F[W]);J&&J.backgroundImage&&/url\(/i.test(J.backgroundImage)&&_++}}catch{}o.domImages=x,o.domBgUrls=_}catch{}},700)}catch{}try{var E=window.fetch;window.fetch=function(p){try{typeof p=="string"&&(p=C(p))}catch{}return E.apply(this,arguments)}}catch{}try{var ee=window.XMLHttpRequest,pe=ee&&ee.prototype;if(pe&&pe.open){var ye=pe.open;pe.open=function(p,y){try{typeof y=="string"&&(y=C(y))}catch{}return ye.apply(this,arguments)}}}catch{}}catch{}try{window.addEventListener("message",function(i){try{var j=i&&i.data;if(!j||!j.__audit_event)return;if(j.type==="simulate-click"){var C=document.querySelector("a[href]");if(C)try{C.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}catch{}else if(document.body)try{document.body.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}catch{}else try{var p=globalClickTag();if(p)try{c.call(window,p)}catch{}}catch{}}}catch{}})}catch{}try{try{document.addEventListener("DOMContentLoaded",function(){try{o.domContentLoaded=Math.max(0,performance.now())}catch{}})}catch{}try{if(document.readyState!=="loading"&&o.domContentLoaded===void 0){var ve=performance.getEntriesByType&&performance.getEntriesByType("navigation");if(ve&&ve[0]&&ve[0].domContentLoadedEventEnd!=null)try{o.domContentLoaded=Math.max(0,ve[0].domContentLoadedEventEnd-ve[0].startTime)}catch{}else if(performance.timing){var fe=performance.timing;if(fe.domContentLoadedEventEnd&&fe.navigationStart)try{o.domContentLoaded=Math.max(0,fe.domContentLoadedEventEnd-fe.navigationStart)}catch{}}}}catch{}try{try{var N=new window.PerformanceObserver(function(i){try{for(var j=i.getEntries?i.getEntries():[],C=0;C<j.length;C++){var p=j[C];!o.visualStart&&(p.name==="first-contentful-paint"||p.name==="first-paint")&&(o.visualStart=Math.max(0,p.startTime||0))}}catch{}});N&&N.observe&&N.observe({type:"paint",buffered:!0})}catch{}try{o.longTasksMs=0;var K=new window.PerformanceObserver(function(i){try{for(var j=i.getEntries?i.getEntries():[],C=0;C<j.length;C++){var p=j[C];p&&typeof p.duration=="number"&&(o.longTasksMs=Math.max(0,(o.longTasksMs||0)+p.duration))}}catch{}});K&&K.observe&&K.observe({type:"longtask",buffered:!0}),setTimeout(function(){try{K&&K.disconnect&&K.disconnect()}catch{}},3e3)}catch{}try{var oe,be=new MutationObserver(function(){oe===void 0&&(oe=performance.now()),o.visualStart===void 0&&oe!==void 0&&(o.visualStart=Math.max(0,oe))});be.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),setTimeout(function(){try{be.disconnect()}catch{}},3e3)}catch{}try{requestAnimationFrame(function(){try{o.visualStart===void 0&&(o.visualStart=Math.max(0,performance.now()))}catch{}})}catch{}}catch{}}catch{}try{let i=function(){var j=performance.now(),C=j-de;de=j,C>50&&Z++,we++,o.frames=we,requestAnimationFrame(i)};var de=performance.now(),Z=0,we=0;requestAnimationFrame(i),setTimeout(function(){try{o.cpuScore=Math.min(1,Z/Math.max(1,o.frames||1))}catch{}},3e3)}catch{}try{var xe=performance&&performance.memory;if(xe&&xe.usedJSHeapSize){var Ae=xe.usedJSHeapSize/1048576;o.memoryMB=Ae;try{o.memoryMinMB=Ae,o.memoryMaxMB=Ae;var ce=0,$e=setInterval(function(){try{var i=performance.memory;if(i&&i.usedJSHeapSize){var j=i.usedJSHeapSize/1048576;o.memoryMB=j,(o.memoryMinMB===void 0||j<o.memoryMinMB)&&(o.memoryMinMB=j),(o.memoryMaxMB===void 0||j>o.memoryMaxMB)&&(o.memoryMaxMB=j)}}catch{}if(ce++,ce>10)try{clearInterval($e)}catch{}},500)}catch{}}}catch{}try{(function(){try{var j=document&&document.querySelectorAll?document.querySelectorAll("iframe").length:0;o.runtimeIframes=j}catch{}})();var Oe=new MutationObserver(function(j){try{j.forEach(function(C){try{(C.addedNodes||[]).forEach(function(p){try{p&&p.nodeType===1&&String(p.nodeName).toUpperCase()==="IFRAME"&&(o.runtimeIframes=(o.runtimeIframes||0)+1)}catch{}})}catch{}})}catch{}});Oe.observe(document.documentElement||document.body,{childList:!0,subtree:!0})}catch{}try{window.addEventListener("load",function(){try{window.__AUDIT_AFTER_ONLOAD__=!1,setTimeout(function(){try{window.__AUDIT_AFTER_ONLOAD__=!0}catch{}},0),setTimeout(function(){try{window.__AUDIT_AFTER_ONLOAD__="done"}catch{}},5e3)}catch{}})}catch{}try{let i=function(x){try{if(!x||/transparent/i.test(x))return!1;var _=x.match(/rgba\(([^)]+)\)/i);if(_){var F=_[1].split(",").map(function(W){return parseFloat(W.trim())});if(F.length>=4&&F[3]===0)return!1}return!0}catch{return!1}},j=function(x){try{if(!x)return 0;var _=String(x).match(/([\d.]+)/);return _?parseFloat(_[1]):0}catch{return 0}},C=function(){try{var x=0,_=0,F=document.body||document.documentElement;if(F){var W=getComputedStyle(F),J=j(W.borderTopWidth),ie=j(W.borderRightWidth),me=j(W.borderBottomWidth),he=j(W.borderLeftWidth),Se=i(W.borderTopColor),z=i(W.borderRightColor),ae=i(W.borderBottomColor),X=i(W.borderLeftColor);J>0&&Se&&x++,ie>0&&z&&x++,me>0&&ae&&x++,he>0&&X&&x++,(J>0||ie>0||me>0||he>0)&&_++}try{for(var Q=document.querySelectorAll("[style]"),te=0;te<Q.length;te++){var se=Q[te],k=se.getAttribute("style")||"",R=/position\s*:\s*absolute/i.test(k);if(R){var H=k.match(/height\s*:\s*([\d.]+)px/i),B=k.match(/width\s*:\s*([\d.]+)px/i),G=H?parseFloat(H[1]):NaN,ne=B?parseFloat(B[1]):NaN,re=/top\s*:\s*0(px|)/i.test(k),le=/left\s*:\s*0(px|)/i.test(k),ge=/right\s*:\s*0(px|)/i.test(k),je=/bottom\s*:\s*0(px|)/i.test(k),Ce=/width\s*:\s*100%/i.test(k),Le=/height\s*:\s*100%/i.test(k),Me=(k.match(/background(?:-color)?\s*:\s*([^;]+)/i)||[])[1]||"",Re=i(Me);Re&&(re&&le&&Ce&&G>=1&&G<=16&&(x=Math.max(x,x|1)),je&&le&&Ce&&G>=1&&G<=16&&(x=Math.max(x,x|2)),le&&re&&Le&&ne>=1&&ne<=16&&(x=Math.max(x,x|4)),ge&&re&&Le&&ne>=1&&ne<=16&&(x=Math.max(x,x|8)))}}try{for(var Te=document.documentElement?document.documentElement.clientWidth:0,Ne=document.documentElement?document.documentElement.clientHeight:0,at=(document.body?document.body:document).getElementsByTagName("*"),Ct=Math.min(at.length,2e3),Ge=0;Ge<Ct;Ge++){var ct=at[Ge],ke=getComputedStyle(ct),ue=ct.getBoundingClientRect();if(ue){var Pe=function(Ue,$t,Lt){return Math.abs(Ue-$t)<=Lt},It=ke&&ke.backgroundColor||"";i(It)&&(Pe(ue.top,0,1)&&ue.height>=1&&ue.height<=16&&ue.width>=Math.max(0,Te-2)&&(x=x|1),Ne>0&&Pe(ue.bottom,Ne,1)&&ue.height>=1&&ue.height<=16&&ue.width>=Math.max(0,Te-2)&&(x=x|2),Pe(ue.left,0,1)&&ue.width>=1&&ue.width<=16&&ue.height>=Math.max(0,Ne-2)&&(x=x|4),Te>0&&Pe(ue.right,Te,1)&&ue.width>=1&&ue.width<=16&&ue.height>=Math.max(0,Ne-2)&&(x=x|8));var Ze=j(ke&&ke.borderTopWidth),Je=j(ke&&ke.borderRightWidth),Qe=j(ke&&ke.borderBottomWidth),Xe=j(ke&&ke.borderLeftWidth),lt=ke&&i(ke.borderTopColor),dt=ke&&i(ke.borderRightColor),ut=ke&&i(ke.borderBottomColor),ht=ke&&i(ke.borderLeftColor);(Ze>0&&lt||Je>0&&dt||Qe>0&&ut||Xe>0&&ht)&&_++,Ze>=1&&Ze<=16&&lt&&Pe(ue.top,0,1)&&ue.width>=Math.max(0,Te-2)&&(x=x|1),Qe>=1&&Qe<=16&&ut&&Ne>0&&Pe(ue.bottom,Ne,1)&&ue.width>=Math.max(0,Te-2)&&(x=x|2),Xe>=1&&Xe<=16&&ht&&Pe(ue.left,0,1)&&ue.height>=Math.max(0,Ne-2)&&(x=x|4),Je>=1&&Je<=16&&dt&&Te>0&&Pe(ue.right,Te,1)&&ue.height>=Math.max(0,Ne-2)&&(x=x|8)}}}catch{}var He=0;x&1&&He++,x&2&&He++,x&4&&He++,x&8&&He++,o.borderSides=He,o.borderCssRules=_}catch{}}catch{}},p=function(x){try{if(!x)return 0;var _=String(x).trim(),F=_.match(/^([\d.]+)\s*s$/i);if(F)return parseFloat(F[1])||0;var W=_.match(/^([\d.]+)\s*ms$/i);if(W)return(parseFloat(W[1])||0)/1e3;var J=parseFloat(_);return isFinite(J)?J:0}catch{return 0}},y=function(){try{var x=0,_=1,F=!1,W=document.body||document.documentElement;if(!W)return;for(var J=W.getElementsByTagName("*"),ie=Math.min(J.length,3e3),me=0;me<ie;me++){var he=J[me],Se=null;try{Se=getComputedStyle(he)}catch{}if(Se){var z=(Se.animationDuration||Se.webkitAnimationDuration||"").toString(),ae=(Se.animationIterationCount||Se.webkitAnimationIterationCount||"").toString();if(z)for(var X=z.split(","),Q=0;Q<X.length;Q++){var te=p(X[Q]);te>x&&(x=te)}if(ae)for(var se=ae.split(","),k=0;k<se.length;k++){var R=se[k].trim().toLowerCase();if(R==="infinite")F=!0,_<9999&&(_=9999);else{var H=parseFloat(R);if(isFinite(H)){var B=Math.round(H);B>_&&(_=B)}}}try{var G=(Se.animation||Se.webkitAnimation||"").toString();if(G)for(var ne=G.split(","),re=0;re<ne.length;re++)for(var le=ne[re].trim().replace(/\([^)]*\)/g,""),ge=le.split(/\s+/),je=0;je<ge.length;je++){var Ce=ge[je];if(/^([\d.]+)(ms|s)$/i.test(Ce)){var Le=p(Ce);Le>x&&(x=Le)}else if(Ce.toLowerCase()==="infinite")F=!0,_<9999&&(_=9999);else if(/^\d+$/.test(Ce)){var Me=parseInt(Ce,10);Me>_&&(_=Me)}}}catch{}}}o.animMaxDurationS=x,o.animMaxLoops=_,o.animInfinite=!!F}catch{}};setTimeout(C,600),setTimeout(C,1500),setTimeout(y,600),setTimeout(y,1500)}catch{}var Fe=0;ze()}catch(ze){try{parent.postMessage({__audit_event:1,type:"error",message:String(ze)},"*")}catch{}}}}const Vt=({maxBodyHeight:n})=>{var Oe,Fe,ze;const{results:a,selectedBundleId:o}=Be(i=>({results:i.results,selectedBundleId:i.selectedBundleId})),t=a.find(i=>i.bundleId===o)||a[0],l=Be(i=>i.bundles.find(j=>j.id===(t==null?void 0:t.bundleId))),u=D.useRef(null),[m,v]=D.useState("preview"),[I,b]=D.useState(""),[S,L]=D.useState(""),[T,M]=D.useState({}),[h,A]=D.useState(null),[e,r]=D.useState([]),[c,g]=D.useState(800),[d,f]=D.useState(!1),[w,$]=D.useState(""),[P,V]=D.useState(!1),[Y,U]=D.useState(!1),[q,O]=D.useState(0),E=D.useRef(""),[ee,pe]=D.useState(""),[ye,ve]=D.useState(""),[fe,N]=D.useState(0),[K,oe]=D.useState(0),be=D.useRef(null),de=D.useRef(null),Z=(t==null?void 0:t.debugFindings)??[],we=Z.length>0;D.useEffect(()=>{if(!t||!t.primary||!l)return;let i=!1;return(async()=>{const j=await Jt(l,t.primary.path);i||(b(j.html),L(j.originalHtml),M(j.blobMap))})(),()=>{i=!0}},[t==null?void 0:t.bundleId,(Oe=t==null?void 0:t.primary)==null?void 0:Oe.path,l,q]),D.useEffect(()=>{function i(j){var p,y,x;const C=j==null?void 0:j.data;if(C){if(C.__audit_event){const _=C;if(r(F=>[_,...F].slice(0,200)),_.type==="summary"){A(_.summary);try{window.__audit_last_summary=_.summary;const F=(p=_.summary)==null?void 0:p.visualStart;if(typeof F=="number"&&isFinite(F)){const W=(x=(y=Be).getState)==null?void 0:x.call(y);if(W&&W.results&&Array.isArray(W.results)){const J=t==null?void 0:t.bundleId,ie=W.results.findIndex(me=>me.bundleId===J);if(ie>=0){const me=W.results.map((he,Se)=>{if(Se!==ie)return he;const z=Array.isArray(he.findings)?[...he.findings]:[],ae=z.findIndex(G=>G.id==="timeToRender"),X=F>500?"WARN":"PASS",Q=`Render start ~${Math.round(F)} ms`;ae>=0?z[ae]={...z[ae],severity:X,messages:[Q,"Target: < 500 ms"]}:z.push({id:"timeToRender",title:"Time to Render",severity:X,messages:[Q,"Target: < 500 ms"],offenders:[]});let te=0,se=0,k=0;for(const G of z)G.severity==="FAIL"?te++:G.severity==="WARN"?se++:k++;const R=z.filter(G=>De.has(G.id));let H="PASS";for(const G of R)if(G.severity==="FAIL"){H="FAIL";break}const B={...he.summary,totalFindings:z.length,fails:te,warns:se,pass:k,status:H};return{...he,findings:z,summary:B}});W.setResults(me)}}}}catch{}}}else if(C.type==="creative-click"){const _=typeof C.url=="string"?C.url:"",F=!!(C.meta&&(C.meta.present||C.meta.source));V(W=>W||F||!!_),A(W=>({...W||{},clickUrl:_})),$(_),f(!0)}}}return window.addEventListener("message",i),()=>window.removeEventListener("message",i)},[]),D.useEffect(()=>{U(!1)},[t==null?void 0:t.bundleId]),D.useEffect(()=>{m!=="preview"&&U(!1)},[m]),D.useEffect(()=>{we||U(!1)},[we]);const xe=((Fe=t==null?void 0:t.primary)==null?void 0:Fe.path)||"",Ae=xe?((ze=xe.split("/"))==null?void 0:ze.pop())||xe:"",ce=D.useMemo(()=>{const i=(()=>{try{const C=t==null?void 0:t.adSize,p=Number(C==null?void 0:C.width),y=Number(C==null?void 0:C.height);if(isFinite(p)&&isFinite(y)&&p>0&&y>0)return{width:p,height:y}}catch{}return null})();if(i)return i;const j=String(S||"");try{const C=j.match(/<meta[^>]+name=["']ad\.size["'][^>]+content=["'][^"']*width\s*=\s*(\d+)\s*,\s*height\s*=\s*(\d+)[^"']*["'][^>]*>/i);if(C){const p=Number(C[1]),y=Number(C[2]);if(isFinite(p)&&isFinite(y)&&p>0&&y>0)return{width:p,height:y}}}catch{}try{const C=j.match(/@media[^\{]*\(\s*height\s*:\s*(\d+)px\s*\)[^\{]*\(\s*width\s*:\s*(\d+)px\s*\)/i);if(C){const y=Number(C[1]),x=Number(C[2]);if(isFinite(x)&&isFinite(y)&&x>0&&y>0)return{width:x,height:y}}const p=j.match(/@media[^\{]*\(\s*width\s*:\s*(\d+)px\s*\)[^\{]*\(\s*height\s*:\s*(\d+)px\s*\)/i);if(p){const y=Number(p[1]),x=Number(p[2]);if(isFinite(y)&&isFinite(x)&&y>0&&x>0)return{width:y,height:x}}}catch{}try{const C=(Ae||(t==null?void 0:t.bundleName)||"").match(/(\d{2,4})\s*[xX]\s*(\d{2,4})/);if(C){const p=Number(C[1]),y=Number(C[2]);if(isFinite(p)&&isFinite(y)&&p>0&&y>0&&p<=4e3&&y<=4e3)return{width:p,height:y}}}catch{}try{const C=j.match(/<img[^>]*width=["']?(\d{2,4})["']?[^>]*height=["']?(\d{2,4})["']?[^>]*>/i);if(C){const p=Number(C[1]),y=Number(C[2]);if(isFinite(p)&&isFinite(y)&&p>0&&y>0)return{width:p,height:y}}}catch{}return null},[t==null?void 0:t.adSize,S,Ae]);D.useEffect(()=>{const i=ce?`${ce.width}x${ce.height}`:"";i&&i!==E.current&&(E.current=i,O(j=>j+1))},[ce==null?void 0:ce.width,ce==null?void 0:ce.height]);const $e=D.useMemo(()=>Object.entries(T).sort(([i],[j])=>i.localeCompare(j)),[T]);return D.useEffect(()=>{if(m!=="source")return;const i=be.current;if(!i)return;const j=i.querySelector(`mark[data-match-index="${fe}"]`);if(j)try{const C=i.getBoundingClientRect(),y=j.getBoundingClientRect().top-C.top,x=Math.max(60,Math.round(i.clientHeight*.25)),_=Math.max(i.scrollTop+y-x,0);i.scrollTo({top:_,behavior:"smooth"})}catch{}},[m,fe,ee]),D.useEffect(()=>{if(m!=="json")return;const i=de.current;if(!i)return;const j=i.querySelector(`mark[data-match-index="${K}"]`);if(j)try{const C=i.getBoundingClientRect(),y=j.getBoundingClientRect().top-C.top,x=Math.max(60,Math.round(i.clientHeight*.25)),_=Math.max(i.scrollTop+y-x,0);i.scrollTo({top:_,behavior:"smooth"})}catch{}},[m,K,ye]),t?t.primary?s.jsxs("div",{className:"ext-preview",style:{display:"flex",flexDirection:"column"},children:[s.jsx("style",{children:`
        mark.active-match { background: #fde68a; outline: 1px solid #f59e0b; }
      `}),s.jsx("nav",{className:"tabs",style:{borderBottom:"1px solid var(--border)",paddingBottom:6,marginBottom:6},children:["preview","source","assets","json"].map(i=>s.jsx("button",{onClick:()=>v(i),className:`tab ${m===i?"active":""}`,children:Yt(i)},i))}),s.jsxs("div",{style:{padding:8,fontSize:12},children:[m==="preview"&&s.jsx("div",{style:{minHeight:n||void 0,maxHeight:n||void 0,overflow:"visible"},children:s.jsxs("div",{style:{position:"relative"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:6,marginBottom:6},children:[s.jsxs("button",{type:"button","aria-label":"Reload preview",title:"Reload preview",onClick:()=>{O(i=>i+1),g(800),r([]),A(null)},className:"btn",style:{fontSize:11,padding:"4px 6px",display:"inline-flex",alignItems:"center",gap:6,color:"#6b7280"},children:[s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[s.jsx("path",{d:"M21 2v6h-6"}),s.jsx("path",{d:"M21 13a9 9 0 1 1-3-7l3 3"})]}),s.jsx("span",{style:{fontWeight:600,color:"#6b7280"},children:"Reload"})]}),we&&s.jsx("button",{type:"button",onClick:()=>U(i=>!i),className:`btn ${Y?"primary":""}`,style:{fontSize:11,padding:"4px 8px"},children:Y?"Hide Metadata":"Metadata"})]}),s.jsx("iframe",{ref:u,title:"Creative Preview",sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-modals",srcDoc:I,style:{width:ce?`${ce.width}px`:"100%",height:ce?ce.height:c,border:"none"},onLoad:()=>{var i;try{const j=(i=u.current)==null?void 0:i.contentDocument;if(!j)return;if(ce){g(ce.height);return}const C=j.body,p=()=>{const y=Math.min(Math.max(C.scrollHeight,600),1400);g(y)};p(),new MutationObserver(()=>p()).observe(j.documentElement,{childList:!0,subtree:!0,attributes:!0,characterData:!0})}catch{}}},`${q}-${ce?`${ce.width}x${ce.height}`:"auto"}`),s.jsx("button",{type:"button",onClick:()=>f(!0),className:"btn primary",style:{position:"absolute",right:8,bottom:8,fontSize:11,padding:"2px 6px"},children:"CTURL Status"}),Y&&we&&s.jsx("div",{style:{position:"absolute",inset:0,padding:16,display:"flex",justifyContent:"flex-end",alignItems:"flex-start",pointerEvents:"none"},children:s.jsxs("div",{style:{marginTop:40,width:"min(420px, 100%)",maxHeight:"calc(100% - 40px)",background:"var(--panel-2)",color:"var(--text)",borderRadius:12,padding:16,overflowY:"auto",pointerEvents:"auto",boxShadow:"var(--shadow)",border:"1px solid var(--border)"},children:[s.jsx("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",marginBottom:12},children:s.jsx("div",{style:{fontSize:12,fontWeight:700,letterSpacing:.3},children:"Preview Metadata"})}),s.jsx("div",{style:{display:"grid",gap:12},children:Z.map(i=>s.jsxs("div",{style:{background:"rgba(148,163,184,0.12)",borderRadius:10,padding:12},children:[s.jsx("div",{style:{marginBottom:6,fontSize:12,fontWeight:600},children:i.title}),s.jsx("ul",{style:{margin:0,paddingLeft:18,fontSize:11,lineHeight:1.5,listStyle:"disc"},children:(Array.isArray(i.messages)?i.messages:i.messages?[String(i.messages)]:[]).map((j,C)=>s.jsx("li",{children:j},C))}),Array.isArray(i.offenders)&&i.offenders.length?s.jsxs("div",{style:{marginTop:8,fontSize:10,fontFamily:"monospace",opacity:.85},children:[i.offenders.slice(0,5).map((j,C)=>s.jsxs("div",{style:{marginBottom:2},children:[s.jsx("span",{children:j.path}),xe&&s.jsxs("span",{style:{opacity:.9},children:[" ","- ",j.detail]}),typeof j.line=="number"&&s.jsxs("span",{style:{marginLeft:4},children:["#L",j.line]})]},C)),i.offenders.length>5&&s.jsxs("div",{children:["+",i.offenders.length-5," more..."]})]}):null]},i.id))})]})})]})}),m==="source"&&s.jsxs("div",{ref:be,style:{position:"relative",minHeight:n||void 0,maxHeight:n||void 0,overflow:"auto"},children:[s.jsxs("div",{style:{position:"sticky",top:0,zIndex:2,background:"var(--surface)",padding:"6px 0",display:"flex",alignItems:"center",gap:8,borderBottom:"1px solid var(--border)"},children:[s.jsx("input",{value:ee,onChange:i=>{pe(i.target.value),N(0)},onKeyDown:i=>{if(i.key==="Enter"){i.preventDefault();const j=We(S,ee);j>0&&(i.shiftKey?N(C=>(C-1+j)%j):N(C=>(C+1)%j))}},placeholder:"Search source...",style:{flex:"0 0 240px",padding:"4px 8px",border:"1px solid var(--border)",borderRadius:6,fontSize:12,background:"var(--surface)",color:"var(--text)"}}),s.jsx(bt,{total:We(S,ee),index:fe,onPrev:()=>{const i=We(S,ee);i<=0||N(j=>(j-1+i)%i)},onNext:()=>{const i=We(S,ee);i<=0||N(j=>(j+1)%i)}}),s.jsx("div",{style:{marginLeft:"auto"},children:s.jsx(et,{inline:!0,onCopy:async()=>{try{await navigator.clipboard.writeText(S)}catch{}}})})]}),s.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:11,lineHeight:1.3,background:"var(--surface-2)",color:"var(--text)",padding:8,borderRadius:6,border:"1px solid var(--border)"},children:yt(S,ee,fe)})]}),m==="assets"&&s.jsxs("div",{style:{position:"relative",paddingTop:36,minHeight:n||void 0,maxHeight:n||void 0,overflow:"auto"},children:[s.jsx(et,{onCopy:async()=>{const i=$e.map(([j,C])=>`${j}	${C}`).join(`
`);try{await navigator.clipboard.writeText(i)}catch{}}}),xe&&s.jsxs("div",{style:{position:"absolute",left:6,top:6,color:"var(--accent)",fontSize:11,fontWeight:700},title:"The entry file is the single HTML file your ad loads first (its starting point). All other files should be referenced from this file.",children:["Entry file identified as: ",xe]}),s.jsxs("div",{style:{display:"grid",gap:6},children:[$e.map(([i,j])=>{const C=i===xe||i.split("/").pop()===Ae,p=C?"The entry file is the single HTML file your ad loads first (its starting point). All other files should be referenced from this file.":"Open asset in a new tab";return s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:s.jsx("a",{href:j,target:"_blank",rel:"noreferrer",title:p,style:{fontFamily:"monospace",color:C?"var(--accent)":"var(--text)",fontWeight:C?700:void 0,textDecoration:"underline"},children:i})},i)}),$e.length===0&&s.jsx("div",{style:{color:"#666"},children:"No assets"})]})]}),m==="json"&&s.jsxs("div",{ref:de,style:{position:"relative",minHeight:n||void 0,maxHeight:n||void 0,overflow:"auto"},children:[s.jsxs("div",{style:{position:"sticky",top:0,zIndex:2,background:"var(--surface)",padding:"6px 0",display:"flex",alignItems:"center",gap:8,borderBottom:"1px solid var(--border)"},children:[s.jsx("input",{value:ye,onChange:i=>{ve(i.target.value),oe(0)},onKeyDown:i=>{if(i.key==="Enter"){i.preventDefault();const j=JSON.stringify(t,null,2),C=We(j,ye);C>0&&(i.shiftKey?oe(p=>(p-1+C)%C):oe(p=>(p+1)%C))}},placeholder:"Search JSON...",style:{flex:"0 0 240px",padding:"4px 8px",border:"1px solid var(--border)",borderRadius:6,fontSize:12,background:"var(--surface)",color:"var(--text)"}}),s.jsx(bt,{total:We(JSON.stringify(t,null,2),ye),index:K,onPrev:()=>{const i=We(JSON.stringify(t,null,2),ye);i<=0||oe(j=>(j-1+i)%i)},onNext:()=>{const i=We(JSON.stringify(t,null,2),ye);i<=0||oe(j=>(j+1)%i)}}),s.jsx("div",{style:{marginLeft:"auto"},children:s.jsx(et,{inline:!0,onCopy:async()=>{try{await navigator.clipboard.writeText(JSON.stringify(t,null,2))}catch{}}})})]}),s.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:11,lineHeight:1.3,background:"var(--surface-2)",color:"var(--text)",padding:8,borderRadius:6,border:"1px solid var(--border)"},children:yt(JSON.stringify(t,null,2),ye,K)})]})]}),d&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50},onClick:i=>{i.target===i.currentTarget&&f(!1)},children:s.jsxs("div",{className:"panel",style:{padding:12,width:"min(520px, 92vw)"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[s.jsx("div",{style:{fontSize:13,fontWeight:700},children:"Clickthrough Status"}),s.jsx("button",{onClick:()=>f(!1),className:"btn",style:{fontSize:12,padding:"2px 6px"},children:"Close"})]}),((h==null?void 0:h.clickUrl)||w)&&s.jsx("div",{style:{fontFamily:"monospace",fontSize:12,background:"var(--surface-2)",color:"var(--text)",padding:8,borderRadius:6,wordBreak:"break-all",border:"1px solid var(--border)"},children:(h==null?void 0:h.clickUrl)||w}),!(h!=null&&h.clickUrl)&&!w&&s.jsx("div",{style:{fontSize:12,background:"rgba(245,158,11,0.12)",color:"var(--text)",border:"1px solid rgba(245,158,11,0.3)",padding:8,borderRadius:6},children:P?"Clickthrough present but not set (blank opened).":"No clickthrough URL captured. Creative may rely on ad-server macros or hasn't set clickTag."}),s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:10},children:P&&s.jsxs(s.Fragment,{children:[s.jsxs("a",{href:(h==null?void 0:h.clickUrl)||w||"about:blank",target:"_blank",rel:"noreferrer",className:"btn primary",style:{fontSize:12,padding:"6px 10px",textDecoration:"none"},children:["Open",!(h!=null&&h.clickUrl)&&!w?" Blank":""]}),((h==null?void 0:h.clickUrl)||w)&&s.jsx("button",{onClick:()=>{const i=(h==null?void 0:h.clickUrl)||w||"";i&&navigator.clipboard.writeText(i).catch(()=>{})},className:"btn",style:{fontSize:12,padding:"6px 10px"},children:"Copy"})]})})]})})]}):s.jsx("div",{style:{fontSize:12,color:"#555"},children:"No primary HTML detected."}):s.jsx("div",{style:{fontSize:12,color:"#555"},children:"No bundle selected."})};function Yt(n){return n==="preview"?"Preview":n==="source"?"Source":n==="assets"?"Assets":"JSON"}function We(n,a){try{const o=String(a||"").trim();if(!o)return 0;const t=new RegExp(o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");return(String(n||"").match(t)||[]).length}catch{return 0}}function yt(n,a,o){try{const t=String(n||""),l=String(a||"").trim();if(!l)return t;const u=new RegExp(l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),m=[];let v=0,I,b=0;for(;(I=u.exec(t))!==null;){const S=I.index;S>v&&m.push(t.slice(v,S));const L=b===o;m.push(s.jsx("mark",{className:L?"active-match":void 0,"data-match-index":b,children:I[0]},S)),v=S+I[0].length,b++}return v<t.length&&m.push(t.slice(v)),m}catch{return n}}const bt=({total:n,index:a,onPrev:o,onNext:t})=>{const l=n<=1;return s.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[s.jsx("button",{className:"btn",title:"Previous match","aria-label":"Previous match",disabled:l,onClick:o,style:{fontSize:11,padding:"2px 6px"},children:"←"}),s.jsx("span",{style:{fontSize:11,opacity:.8},children:n?`${a+1} of ${n}`:"0 matches"}),s.jsx("button",{className:"btn",title:"Next match","aria-label":"Next match",disabled:l,onClick:t,style:{fontSize:11,padding:"2px 6px"},children:"→"})]})},et=({onCopy:n,inline:a})=>{const[o,t]=D.useState(!1);return s.jsx("button",{"aria-label":"Copy",title:o?"Copied!":"Copy",onClick:async()=>{try{await n(),t(!0),setTimeout(()=>t(!1),1200)}catch{}},className:"btn",style:{position:a?"static":"absolute",right:a?void 0:6,top:a?void 0:6,borderRadius:6,fontSize:11,padding:"4px 8px"},children:o?"Copied":"Copy"})};let tt=null;async function ei(){return tt||(tt=Rt(()=>import("./xlsx-Ao6DAF9L.js"),[],import.meta.url)),tt}function ti(n,a){if(!n)return;const o=!!(a&&n.path&&a.toLowerCase()===n.path.toLowerCase()),t=n.path&&!o?` in ${n.path}`:o?" in primary HTML":"";switch(n.method){case"meta":return'<meta name="ad.size"> tag';case"gwd-admetadata":return"GWD admetadata script";case"css-media":return`CSS @media rule${t}`.trim();case"css-rule":return`CSS rule${t}`.trim();case"inline-style":return o?"inline style attribute in primary HTML":"inline style attribute";case"css-file":return n.path?`CSS file ${n.path}`:"CSS file";default:return}}function ii(n,a,o){var m;if(!n)return;const t=[`${n.width}x${n.height}`],l=ti(a,o);l&&t.push(`via ${l}`);const u=(m=a==null?void 0:a.snippet)==null?void 0:m.trim();return u&&t.push(`“${u}”`),t.join(" — ")}const pi=()=>{const{bundles:n,results:a,settings:o,setResults:t,selectedBundleId:l,selectBundle:u}=Be(S=>({bundles:S.bundles,results:S.results,settings:S.settings,setResults:S.setResults,selectedBundleId:S.selectedBundleId,selectBundle:S.selectBundle})),[m,v]=D.useState(!1),I=D.useRef(0);async function b(){var T;const S=++I.current;v(!0);const L=[];try{for(const M of n){let h,A,e,r=[];try{if(M.mode==="zip"){const N=Tt(M);if(h=N==null?void 0:N.primary,!h){const K=N&&Array.isArray(N.htmlCandidates)&&N.htmlCandidates.length?N.htmlCandidates:Object.keys(M.files||{}).filter(oe=>/\.html?$/i.test(oe));K.length&&(h={path:di(K)})}if(h){const K=mt(M,h);A=K.adSize,e=K.adSizeSource,r=K.references,h={...h,adSize:A,sizeSource:e}}}else{const N=Object.keys(M.files||{})[0]||"";if(/\.html?$/i.test(N)){h={path:N};const K=mt(M,h);A=K.adSize,e=K.adSizeSource,r=K.references,h={...h,adSize:A,sizeSource:e}}}}catch{}const c=Object.values(M.files||{}).reduce((N,K)=>N+((K==null?void 0:K.byteLength)||0),0),g=new Set;try{for(const N of r||[])N&&N.inZip&&N.normalized&&g.add(N.normalized)}catch{}try{const N=h!=null&&h.path?String(h.path).toLowerCase():"";N&&g.add(N)}catch{}let d=0;for(const N of g){const K=(T=M.lowerCaseIndex)==null?void 0:T[N];K&&M.files[K]&&(d+=M.files[K].byteLength)}d===0&&(d=c);const f=Math.max(0,c-d),w=g.size||(h?1:0),$=g.size,P={bundleId:M.id,bundleName:M.name,primary:h,adSize:A,adSizeSource:e,references:r,totalBytes:c,initialBytes:d,subsequentBytes:f,zippedBytes:(M.bytes||new Uint8Array).length,initialRequests:w,totalRequests:$,findings:[],summary:{status:"PASS",totalFindings:0,fails:0,warns:0,pass:0,orphanCount:0,missingAssetCount:0}},V={...o||{},clickTagPatterns:Array.from(new Set([...(o==null?void 0:o.clickTagPatterns)||[],String(/\bclicktag\b/i),String(/\bwindow\.clicktag\b/i)]))},Y=Kt(M,P,V)||[],U=await Zt(M,P,V)||[],q=[...Y,...U].filter(N=>!(!N||!N.id||N.id==="hardcodedClickUrl"||N.id==="clickTags"||N.id==="iabRequests"||N.id==="packaging")),O=q.filter(N=>Array.isArray(N==null?void 0:N.tags)&&N.tags.includes("debug")),E=q.filter(N=>!Array.isArray(N==null?void 0:N.tags)||!N.tags.includes("debug"));P.findings=E,P.debugFindings=O;let ee=0,pe=0,ye=0;for(const N of E){const K=N&&N.severity||"PASS";K==="FAIL"?ee++:K==="WARN"?pe++:ye++}const ve=E.filter(N=>De.has(N&&N.id||""));let fe="PASS";for(const N of ve)if(N.severity==="FAIL"){fe="FAIL";break}if(P.summary={...P.summary,status:fe,totalFindings:E.length,fails:ee,warns:pe,pass:ye},L.push(P),I.current!==S)return}if(I.current!==S)return;t(L);try{const M=l;(!M||!L.some(h=>h.bundleId===M))&&L[0]&&u(L[0].bundleId)}catch{}}finally{I.current===S&&v(!1)}}return D.useEffect(()=>(n.length>0&&b(),()=>{I.current++}),[n.length]),s.jsxs("div",{children:[s.jsx("style",{children:`
        @keyframes ext-spinner {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `}),s.jsxs("div",{className:"toolbar",style:{marginBottom:8},children:[s.jsx(ci,{}),s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s.jsx("button",{type:"button",className:"btn",onClick:()=>vt("https://support.google.com/campaignmanager/answer/6088202","CM360 HTML5 Guidelines"),children:"CM360 Guidelines"}),s.jsx("button",{type:"button",className:"btn",onClick:()=>vt("https://iabtechlab.com/standards/ad-portfolios/","IAB Display Guidelines"),children:"IAB Display Guidelines"})]})]}),s.jsxs("div",{className:"panel",style:{marginTop:12,overflow:"hidden"},children:[m&&s.jsxs("div",{role:"status","aria-live":"polite",style:{position:"absolute",top:8,right:8,display:"inline-flex",alignItems:"center",gap:10,padding:"6px 10px",borderRadius:999,background:"rgba(99, 102, 241, 0.18)",color:"#4338ca",boxShadow:"0 8px 18px rgba(79, 70, 229, 0.18)",zIndex:5,fontSize:12,fontWeight:600},title:"Processing uploaded bundle(s)",children:[s.jsx("span",{"aria-hidden":"true",style:{width:18,height:18,borderRadius:"50%",border:"3px solid rgba(165, 180, 252, 0.28)",borderTopColor:"#7c3aed",borderRightColor:"#7c3aed",animation:"ext-spinner 0.9s linear infinite"}}),s.jsx("span",{children:"Processing…"})]}),s.jsx(si,{})]}),s.jsx(ri,{})]})};function vt(n,a){try{const l=window.top||window,u=(l.outerHeight?l.outerHeight:window.innerHeight)/2+(l.screenY||window.screenY||0)-720/2,m=(l.outerWidth?l.outerWidth:window.innerWidth)/2+(l.screenX||window.screenX||0)-980/2;window.open(n,a,`popup=yes,width=980,height=720,left=${Math.max(0,Math.floor(m))},top=${Math.max(0,Math.floor(u))},resizable=yes,scrollbars=yes`)}catch{window.open(n,a)}}const Ie={packaging:"ZIP Packaging",primaryAsset:"Primary File and Size",assetReferences:"All Files Referenced",externalResources:"Off-Domain References",httpsOnly:"HTTPS Only",clickTags:"Click-Through Configured",iabWeight:"Weight Budgets",iabRequests:"Initial Request Count",systemArtifacts:"System Artifacts Removed",syntaxErrors:"Runtime Errors",creativeRendered:"Rendered Successfully","no-document-write":"Avoid document.write",indexFile:"Root Index File",minified:"Minified Code",cssEmbedded:"Inline CSS Usage",dialogs:"Blocking Dialogs",domContentLoaded:"DOMContentLoaded Timing",timeToRender:"Time to First Render",measurement:"Tracker and Measurement Hosts",html5lib:"Frameworks Detected",imagesOptimized:"Image Optimization",hostedSize:"Total Uncompressed Size",jquery:"jQuery Usage",backup:"Backup Image Present",iframes:"Iframe Elements",networkDynamic:"Runtime Network Calls",heavyAdRisk:"Heavy Ad Risk Indicator",memoryUsage:"Peak JS Heap",hostedCount:"Hosted File Count","invalid-url-ref":"Invalid URL References","orphaned-assets":"Orphaned Assets (Not Referenced)","bad-filenames":"Problematic Filenames","invalid-markup":"Invalid Markup (HTML/CSS/SVG)","gwd-env-check":"GWD Environment Check","hardcoded-click":"Hard-coded Clickthrough","pkg-format":"Packaging Format","entry-html":"Single Entry HTML & References","file-limits":"File Count and Upload Size","allowed-ext":"Allowed File Extensions","iframe-safe":"Iframe Safe (No Cross-Frame DOM)",clicktag:"ClickTag Present and Used","no-webstorage":"No Web Storage APIs","no-backup-in-zip":"No Backup Image Inside ZIP","relative-refs":"Relative Paths For Packaged Assets","host-requests-initial":"Initial Host Requests","cpu-budget":"CPU Busy Budget","animation-cap":"Animation Length Cap",border:"Border Present"},si=()=>{const{results:n,bundles:a,selectedBundleId:o,selectBundle:t,removeBundle:l}=Be(h=>({results:h.results,bundles:h.bundles,selectedBundleId:h.selectedBundleId,selectBundle:h.selectBundle,removeBundle:h.removeBundle})),u=_e.useRef(null),m=[{key:"creative",label:"Creative",min:200},{key:"status",label:"Status",min:80},{key:"dim",label:"Dimensions",min:90},{key:"issues",label:"Issues",min:90},{key:"initialkb",label:"Initial KB",min:90},{key:"totalkb",label:"Total KB",min:90},{key:"initialreqs",label:"Initial",min:80}],v="ext_table_colw_v2";function I(h,A){const e={};if(!h||typeof h!="object"||Array.isArray(h))return e;const r=new Map(A.map(c=>[c.key,Math.max(c.min||60,40)]));for(const[c,g]of Object.entries(h)){const d=typeof g=="number"&&isFinite(g)?g:NaN,f=c;if(!isNaN(d)&&r.has(f)){const w=r.get(f);e[f]=Math.max(d,w)}}return e}const[b,S]=_e.useState(null),[L,T]=_e.useState(()=>{try{const h=localStorage.getItem(v);if(h)return I(JSON.parse(h),m)}catch{}return{}}),M=_e.useRef(null);return _e.useEffect(()=>{try{localStorage.setItem(v,JSON.stringify(L))}catch{}},[L]),_e.useEffect(()=>{if(!u.current)return;let h=!1;try{h=L&&typeof L=="object"&&Object.keys(L).length>0}catch{h=!1}if(h)return;const A=u.current.querySelectorAll("thead th[data-colkey]"),e={};A.forEach(r=>{const c=r.getAttribute("data-colkey")||"";if(!c)return;const g=m.find(f=>f.key===c),d=Math.max((g==null?void 0:g.min)||60,40);e[c]=Math.max(r.getBoundingClientRect().width|0,d)}),Object.keys(e).length&&T(e)},[]),_e.useEffect(()=>{var h;if(u.current&&!(!n||n.length===0))try{const A=document.createElement("canvas").getContext("2d");if(!A)return;const e=getComputedStyle(u.current),r=e.font&&e.font.trim()?e.font:`${e.fontSize||"12px"} ${e.fontFamily||"system-ui,sans-serif"}`;A.font=r;let c=0;for(const w of n){const $=Ke(w.bundleName),P=A.measureText($).width;P>c&&(c=P)}const g=Math.ceil(c+24),d=Math.max(((h=m.find(w=>w.key==="creative"))==null?void 0:h.min)||200,200),f=Math.max(g,d);T(w=>{const $=typeof w.creative=="number"?w.creative:void 0;return typeof $=="number"&&$>=f?w:{...w,creative:f}})}catch{}},[n,u.current]),_e.useEffect(()=>{function h(e){if(!M.current)return;e.preventDefault();const r=e.clientX-M.current.startX,c=M.current.startW,g=M.current.min,d=M.current.neighborStartW,f=M.current.neighborMin;let w=Math.max(c+r,g),$=d-r;if($<f){const P=d-f;w=Math.max(c+P,g),$=f}T(P=>({...P,[M.current.key]:w,[M.current.neighborKey]:$}))}function A(){M.current=null,document.body.style.cursor=""}return window.addEventListener("mousemove",h),window.addEventListener("mouseup",A),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",A)}},[]),n.length===0?null:s.jsxs("div",{style:{marginTop:0,overflowX:"auto"},children:[s.jsx("style",{children:`
        .table tbody tr td:first-child { position: relative; padding-right: 30px; }
        .table tbody tr .creative-cell { display: inline-flex; align-items: center; gap: 10px; min-height: 26px; position: relative; }
        .table tbody tr .creative-remove {
          opacity: 0;
          transform: scale(0.88);
          width: 26px;
          height: 26px;
          border-radius: 999px;
          border: 1px solid rgba(148, 163, 184, 0.45);
          background: rgba(148, 163, 184, 0.18);
          color: #64748b;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          transition: opacity .12s ease, transform .12s ease, color .12s ease, border-color .12s ease, background-color .12s ease, box-shadow .12s ease;
          cursor: pointer;
        }
        .table tbody tr .creative-cell:hover .creative-remove,
        .table tbody tr .creative-remove:focus-visible {
          opacity: 1;
          transform: scale(1);
        }
        .table tbody tr .creative-remove:hover {
          background: rgba(248, 250, 252, 0.92);
          color: #1f2937;
          border-color: rgba(148, 163, 184, 0.75);
          box-shadow: 0 1px 3px rgba(15, 23, 42, 0.18);
        }
        .table tbody tr.remove-hover td { color: #9ca3af; }
      `}),s.jsxs("table",{ref:u,className:"table",style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},children:[s.jsx("colgroup",{children:m.map(h=>s.jsx("col",{style:{width:L[h.key]?`${L[h.key]}px`:void 0}},h.key))}),s.jsx("thead",{children:s.jsx("tr",{children:m.map(h=>s.jsxs("th",{"data-colkey":h.key,style:{...ai,position:"relative"},onMouseMove:A=>{const e=A.currentTarget;e.getBoundingClientRect().right-A.clientX<6?(e.classList.add("near-edge"),e.style.cursor="col-resize"):(e.classList.remove("near-edge"),e.style.cursor="")},onMouseLeave:A=>{const e=A.currentTarget;e.classList.remove("near-edge"),e.style.cursor=""},children:[h.label,s.jsx("span",{role:"separator","aria-orientation":"vertical",title:"Drag to resize",onMouseDown:A=>{var V,Y;const e=A.currentTarget.parentElement,r=m.findIndex(U=>U.key===h.key),c=r>=0&&r<m.length-1?r+1:r>0?r-1:-1;if(c<0)return;const g=m[c].key,d=u.current,f=L&&L[h.key]||(e?e.getBoundingClientRect().width:120)||120;let w=L&&L[g]||0;if(!w&&d){const U=d.querySelector(`thead th[data-colkey="${g}"]`);w=U&&U.getBoundingClientRect().width||120}const $=Math.max(((V=m[r])==null?void 0:V.min)||60,40),P=Math.max(((Y=m[c])==null?void 0:Y.min)||60,40);M.current={key:h.key,startX:A.clientX,startW:f,min:$,neighborKey:g,neighborStartW:w,neighborMin:P},document.body.style.cursor="col-resize",A.preventDefault()},style:{position:"absolute",right:0,top:0,height:"100%",width:6,cursor:"col-resize",userSelect:"none"}})]},h.key))})}),s.jsx("tbody",{children:n.map(h=>{var g;a.find(d=>d.id===h.bundleId);const A=o?o===h.bundleId:((g=n[0])==null?void 0:g.bundleId)===h.bundleId;let e=0,r=0;try{for(const d of h.findings||[])De.has(d.id)&&(d.severity==="FAIL"?e++:d.severity==="WARN"&&r++)}catch{}const c=b===h.bundleId;return s.jsxs("tr",{className:[A?"selected":"",c?"remove-hover":""].filter(Boolean).join(" ")||void 0,onClick:()=>t(h.bundleId),onMouseLeave:()=>S(d=>d===h.bundleId?null:d),style:{cursor:"pointer",background:A?"rgba(79,70,229,0.12)":"transparent"},title:"Click to view details",children:[s.jsx("td",{style:{...Ee,position:"relative",paddingRight:30},children:s.jsxs("div",{className:"creative-cell",children:[s.jsx("span",{className:"creative-label",children:Ke(h.bundleName)}),s.jsx("button",{type:"button",className:"creative-remove",title:"Remove creative","aria-label":`Remove ${Ke(h.bundleName)}`,onMouseEnter:()=>S(h.bundleId),onMouseLeave:()=>S(null),onFocus:()=>S(h.bundleId),onBlur:()=>S(d=>d===h.bundleId?null:d),onClick:d=>{d.stopPropagation();try{l(h.bundleId)}catch{}},children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"12",height:"12",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{d:"M18.3 5.7 12 12l6.3 6.3-1.3 1.3L10.7 13.3 4.4 19.6 3.1 18.3 9.4 12 3.1 5.7 4.4 4.4 10.7 10.7 17 4.4z"})})})]})}),s.jsx("td",{style:{...Ee},children:rt(h.summary.status)}),s.jsx("td",{style:Ee,children:h.adSize?`${h.adSize.width}x${h.adSize.height}`:"-"}),s.jsx("td",{style:Ee,title:`${e} FAIL/${r} WARN`,"aria-label":`${e} FAIL/${r} WARN`,children:`${e}F / ${r}W`}),s.jsx("td",{style:Ee,children:wt(h.initialBytes)}),s.jsx("td",{style:Ee,children:wt(h.totalBytes)}),s.jsx("td",{style:Ee,children:h.initialRequests||0})]},h.bundleId)})})]})]})},ri=()=>{const n=D.useRef(null),a=D.useRef(null),o=D.useRef(null),t=D.useRef(null),l=D.useRef(!1),[u,m]=D.useState(!1),[v,I]=D.useState(()=>new Set(["FAIL","WARN","PASS"])),[b,S]=D.useState(()=>{try{const A=localStorage.getItem("ext_split");if(A){const e=parseFloat(A);if(!isNaN(e))return Math.min(.75,Math.max(.25,e))}}catch{}return .5});D.useEffect(()=>{try{localStorage.setItem("ext_split",String(b))}catch{}},[b]),D.useEffect(()=>{function A(r){var f;if(!l.current)return;const c=(f=n.current)==null?void 0:f.getBoundingClientRect();if(!c)return;const g=r.clientX-c.left,d=Math.min(.75,Math.max(.25,g/Math.max(1,c.width)));S(d),r.preventDefault()}function e(){l.current=!1,document.body.style.cursor=""}return window.addEventListener("mousemove",A),window.addEventListener("mouseup",e),()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",e)}},[]);const[L,T]=D.useState(void 0);D.useEffect(()=>{function A(){var f,w;const r=((f=a.current)==null?void 0:f.offsetHeight)||0,c=((w=o.current)==null?void 0:w.offsetHeight)||0;let g=0;try{if(t.current){const $=getComputedStyle(t.current),P=parseFloat($.paddingTop||"0"),V=parseFloat($.paddingBottom||"0");g=(isNaN(P)?0:P)+(isNaN(V)?0:V)}}catch{}const d=Math.max(0,r-c-g);T(Number.isFinite(d)&&d>0?d:void 0)}A();let e;try{"ResizeObserver"in window&&(e=new ResizeObserver(()=>A()),a.current&&e.observe(a.current))}catch{}return window.addEventListener("resize",A),()=>{try{e&&a.current&&e.unobserve(a.current)}catch{}window.removeEventListener("resize",A)}},[]),D.useEffect(()=>{if(!u)return;const A=e=>{const r=e.target;if(!r)return;const c=document.getElementById("priority-filter-panel"),g=document.getElementById("priority-filter-btn");c&&!c.contains(r)&&g&&!g.contains(r)&&m(!1)};return window.addEventListener("click",A,{capture:!0}),()=>window.removeEventListener("click",A,{capture:!0})},[u]);const M=`${Math.round(b*1e3)/10}%`,h=`${Math.round((1-b)*1e3)/10}%`;return s.jsxs("div",{children:[s.jsxs("div",{ref:n,className:"split",style:{minHeight:360},children:[s.jsxs("div",{ref:a,style:{width:M,minWidth:240,overflowX:"hidden",overflowY:"auto"},className:"left",children:[s.jsxs("div",{className:"title",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[s.jsx("span",{children:"Priority Checks"}),s.jsx(Mt,{explanation:"Checks that are necessary for the creative to function and pass common platform policies.",why:`Fixing failures here helps ensure reliable rendering and acceptance across placements.

Note: WARNs here do not impact overall PASS/FAIL status.`})]}),s.jsxs("span",{style:{position:"relative"},children:[s.jsx("button",{id:"priority-filter-btn",type:"button","aria-label":"Filter priority checks",className:"btn",onClick:()=>m(A=>!A),title:"Filter by severity",style:{width:24,height:24,padding:0,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:s.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:s.jsx("path",{d:"M3 4h18l-7 8v6l-4 2v-8L3 4z"})})}),u&&s.jsxs("div",{id:"priority-filter-panel",role:"dialog","aria-label":"Priority filters",className:"panel",style:{position:"absolute",right:0,top:28,zIndex:20,padding:8,minWidth:160},children:[s.jsx("div",{style:{fontSize:12,fontWeight:700,marginBottom:4},children:"Show severities"}),["FAIL","WARN","PASS"].map(A=>s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:12,padding:"4px 2px",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:v.has(A),onChange:e=>{I(r=>{const c=new Set(r);return e.target.checked?c.add(A):c.delete(A),c})}}),s.jsx("span",{children:A})]},A))]})]})]}),s.jsx("div",{className:"body",children:s.jsx(ni,{filter:v})})]}),s.jsx("div",{role:"separator","aria-orientation":"vertical",title:"Drag to resize",onMouseDown:A=>{l.current=!0,document.body.style.cursor="col-resize",A.preventDefault()},className:"separator",children:s.jsx("i",{})}),s.jsxs("div",{style:{width:h,minWidth:320,overflow:"visible"},className:"right",children:[s.jsx("div",{ref:o,className:"title",children:"Preview"}),s.jsx("div",{ref:t,className:"body",style:{height:L,minHeight:L?void 0:360,overflow:"hidden"},children:s.jsx(Vt,{maxBodyHeight:L})})]})]}),s.jsx("div",{style:{marginTop:12},children:s.jsx(oi,{})})]})},ni=({filter:n})=>{const{results:a,selectedBundleId:o,bundles:t}=Be(v=>({results:v.results,selectedBundleId:v.selectedBundleId,bundles:v.bundles})),l=a.find(v=>v.bundleId===o)||a[0];if(!l)return null;const u=xt;let m=l.findings.filter(v=>De.has(v.id)).sort((v,I)=>{const b=u.indexOf(v.id),S=u.indexOf(I.id),L=b<0?Number.MAX_SAFE_INTEGER:b,T=S<0?Number.MAX_SAFE_INTEGER:S;return L-T});return n&&n.size>0&&(m=m.filter(v=>n.has(v.severity))),s.jsx("div",{style:{display:"grid",gap:8,gridTemplateColumns:"1fr",alignItems:"start"},children:m.map(v=>s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"title",children:[s.jsx("div",{children:rt(v.severity)}),s.jsxs("div",{className:"title-wrap",style:{display:"inline-flex",alignItems:"center",gap:6},children:[s.jsx("span",{className:"title-text",children:Ie[v.id]||v.title}),s.jsx(jt,{checkId:v.id})]})]}),s.jsx("ul",{className:"items",children:(()=>{const I=Array.isArray(v.offenders)?v.offenders:[],b=Array.isArray(v.messages)?v.messages:v.messages?[String(v.messages)]:[],S=String(v.severity)==="PASS";if(I.length>0&&!(S&&(v.id==="clicktag"||v.id==="border"))){const L=`${I.length} offender(s) found`;return s.jsx("li",{children:L})}return b.map((L,T)=>s.jsx("li",{children:L},T))})()}),(()=>{var M,h,A,e;const I=t.find(r=>r.id===l.bundleId),b=Array.isArray(v.offenders)?v.offenders:[],S=b.length>0,T=String(v.severity)==="PASS"?"Details":"Offenders";if(!S&&v.id==="primaryAsset"){const r=((M=l==null?void 0:l.primary)==null?void 0:M.path)||null,c=r?String(r).split("/").pop()||String(r):null,g=l==null?void 0:l.adSize,d=(l==null?void 0:l.adSizeSource)||((h=l==null?void 0:l.primary)==null?void 0:h.sizeSource),f=[];c&&f.push({label:"File name",value:c});const w=ii(g,d,r);if(w&&f.push({label:"Size",value:w}),f.length>0)return s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`Details (${f.length})`}),s.jsx("ul",{className:"offenders",children:f.map(($,P)=>s.jsxs("li",{children:[s.jsxs("span",{style:{fontWeight:600},children:[$.label,":"]})," ",$.value]},P))})]})}if(!S&&v.id==="file-limits"&&I&&I.files){const r=Object.keys(I.files||{});if(r.length>0)return s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`Details (${r.length})`}),s.jsx("ul",{className:"offenders",children:r.map((c,g)=>s.jsx("li",{children:c},g))})]})}if(!S&&v.id==="httpsOnly"){const r=Array.isArray(l==null?void 0:l.references)?l.references.filter(c=>c&&c.external):[];if(r.length>0)return s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`Details (${r.length})`}),s.jsx("ul",{className:"offenders",children:r.map((c,g)=>s.jsxs("li",{children:[c.url,c.from?` — from ${c.from}`:""]},g))})]})}if(v.id==="bad-filenames"){const r=Array.isArray(v.offenders)?v.offenders:[],c=Array.isArray(v.messages)?v.messages:v.messages?[String(v.messages)]:[],g=typeof(l==null?void 0:l.bundleName)=="string"?String(l.bundleName):I!=null&&I.name?String(I.name):"",d=$=>li($||""),f=($,{specials:P})=>{let V=d($);return P&&(V=V.replace(/(%|#|\?|;|\\|:|\*|"|\|)/g,"<strong>$1</strong>")),V=V.replace(/(\d{2,4}\s*[xX]\s*\d{2,4})/g,"<strong>$1</strong>"),V},w=[];for(const $ of c)/^No disallowed characters$/i.test($)||w.push(f($,{specials:!1}));if(r.length>0)for(const $ of r){const P=f(($==null?void 0:$.path)||"",{specials:!0}),V=$!=null&&$.detail?String($.detail):"",Y=V?f(V,{specials:!0}):"",U=Y?`${P} — ${Y}`:P;w.push(U)}else g&&w.push(f(g,{specials:!1}));if(w.length>0)return s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`Details (${w.length})`}),s.jsx("ul",{className:"offenders",children:w.map(($,P)=>s.jsx("li",{dangerouslySetInnerHTML:{__html:$}},P))})]})}if(!S&&v.id==="host-requests-initial"&&I&&I.files){const r=new Set;try{for(const f of l.references||[])f&&f.inZip&&f.normalized&&r.add(String(f.normalized).toLowerCase())}catch{}try{const f=(A=l==null?void 0:l.primary)==null?void 0:A.path;f&&r.add(String(f).toLowerCase())}catch{}const c=[],g=I.lowerCaseIndex||{};for(const f of Array.from(r)){const w=g[f]||f,$=((e=I.files[w])==null?void 0:e.byteLength)||0;c.push({path:w,size:$})}c.sort((f,w)=>f.path.localeCompare(w.path));const d=f=>(Math.round(f/1024*10)/10).toFixed(1)+" KB";if(c.length>0)return s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`Details (${c.length})`}),s.jsx("ul",{className:"offenders",children:c.map((f,w)=>s.jsxs("li",{children:[f.path," — ",d(f.size)]},w))})]})}if(!S&&(v.id==="clicktag"||v.id==="border")){const r=Array.isArray(v.offenders)?v.offenders:[];if(r.length>0){const c=[...r];v.id==="clicktag"&&c.sort((d,f)=>{const w=$=>$?$.kind==="ahref"?2:$.kind==="aonclick"?1:0:0;return w(d)-w(f)});const g=d=>{try{const f=/(window\.)?clicktag\d*|clickTag\d*/gi;return d.replace(f,w=>`<mark class="ct-hi">${w}</mark>`)}catch{return d}};return s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`Details (${c.length})`}),s.jsx("style",{children:".ct-hi{ background: transparent; color: #7c3aed; font-weight: 700; }"}),s.jsx("ul",{className:"offenders",children:c.map((d,f)=>s.jsxs("li",{children:[d.path,d.line?`:${d.line}`:"",d.detail?s.jsx("span",{dangerouslySetInnerHTML:{__html:" — "+(v.id==="clicktag"?g(String(d.detail)):String(d.detail))}}):null]},f))})]})}}return S?s.jsxs("details",{style:{marginTop:6},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#4b5563"},children:`${T} (${b.length})`}),s.jsx("ul",{className:"offenders",children:b.map((r,c)=>s.jsxs("li",{children:[r.path,r.detail?` — ${r.detail}`:""]},c))})]}):null})(),s.jsx("div",{className:"help",children:s.jsx(St,{checkId:v.id,group:"priority"})})]},v.id))})},oi=()=>{const{results:n,selectedBundleId:a,bundles:o}=Be(b=>({results:b.results,selectedBundleId:b.selectedBundleId,bundles:b.bundles})),[t,l]=_e.useState(!1),u=n.find(b=>b.bundleId===a)||n[0];if(!u)return null;const m=new Set(u.findings.map(b=>b.id));function v(b,S){switch(b){case"clickTags":return S.has("clicktag");case"iabRequests":return S.has("host-requests-initial");case"fileTypes":return S.has("allowed-ext");case"creativeBorder":return S.has("border");case"docWrite":return S.has("no-document-write");case"gwdEnvironment":return S.has("gwd-env-check");case"orphanAssets":return S.has("orphaned-assets");case"cpuUsage":return S.has("cpu-budget");case"indexFile":return S.has("entry-html");default:return!1}}const I=u.findings.filter(b=>!De.has(b.id)).filter(b=>!v(b.id,m)).sort((b,S)=>{const L=r=>r==="FAIL"?0:r==="WARN"?1:2,T=L(b.severity)-L(S.severity);if(T!==0)return T;const M=r=>{try{const c=nt(r);if(c.includes("CM360"))return 0;if(c.includes("H5"))return 1;if(c.includes("IAB"))return 2}catch{}return 3},h=M(b.id)-M(S.id);if(h!==0)return h;const A=(Ie==null?void 0:Ie[b.id])||b.title||"",e=(Ie==null?void 0:Ie[S.id])||S.title||"";return String(A).localeCompare(String(e))});return s.jsxs("div",{className:"panel",style:{padding:12},children:[s.jsx("button",{type:"button",onClick:()=>l(b=>!b),"aria-expanded":t,style:{width:"100%",textAlign:"left",background:"rgba(255,255,255,0.02)",border:"1px solid var(--border)",borderRadius:8,padding:"8px 10px",fontSize:12,fontWeight:700},children:s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[s.jsxs("span",{children:["Additional Checks ",t?"▾":"▸"]}),s.jsxs("span",{style:{fontWeight:400,color:"#6b7280"},children:["(",I.length,")"]}),s.jsx(Mt,{stopClickPropagation:!0,explanation:"Checks that are advised for optimal quality, performance, and maintainability.",why:`Addressing these can improve reliability and user experience, though needs vary by placement.

Note: These checks do not impact overall PASS/FAIL status.`})]})}),t&&s.jsx("div",{style:{display:"grid",gap:8,marginTop:8,gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))"},children:I.map(b=>s.jsxs("div",{className:"card small",style:{minHeight:0},children:[s.jsxs("div",{className:"title",style:{gap:6},children:[s.jsx("div",{children:rt(b.severity)}),s.jsxs("div",{className:"title-wrap",style:{display:"inline-flex",alignItems:"center",gap:6,fontSize:12},children:[s.jsx("span",{className:"title-text",children:(Ie==null?void 0:Ie[b.id])||b.title}),s.jsx(jt,{checkId:b.id})]})]}),s.jsx("ul",{className:"items",style:{marginTop:4,fontSize:11},children:(()=>{const S=Array.isArray(b.offenders)?b.offenders:[],L=Array.isArray(b.messages)?b.messages:b.messages?[String(b.messages)]:[],T=String(b.severity)==="PASS";if(S.length>0&&!(T&&(b.id==="clicktag"||b.id==="border"))){const M=`${S.length} offender(s) found`;return s.jsx("li",{children:M})}return L.map((M,h)=>s.jsx("li",{children:M},h))})()}),(()=>{var A,e,r;const S=o.find(c=>c.id===u.bundleId),L=Array.isArray(b.offenders)?b.offenders:[],T=L.length>0,h=String(b.severity)==="PASS"?"Details":"Offenders";if(!T&&b.id==="file-limits"&&S&&S.files){const c=Object.keys(S.files||{});if(c.length>0)return s.jsxs("details",{style:{marginTop:4},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#4b5563"},children:`Details (${c.length})`}),s.jsx("ul",{className:"offenders",style:{fontSize:10,maxHeight:160},children:c.map((g,d)=>s.jsx("li",{children:g},d))})]})}if(!T&&b.id==="primaryAsset"){const c=(A=u==null?void 0:u.primary)==null?void 0:A.path,g=c?String(c).split("/").pop()||String(c):null;if(g)return s.jsxs("details",{style:{marginTop:4},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#4b5563"},children:"Details (1)"}),s.jsx("ul",{className:"offenders",style:{fontSize:10,maxHeight:160},children:s.jsx("li",{children:g})})]})}if(!T&&b.id==="httpsOnly"){const c=Array.isArray(u==null?void 0:u.references)?u.references.filter(g=>g&&g.external):[];if(c.length>0)return s.jsxs("details",{style:{marginTop:4},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#4b5563"},children:`Details (${c.length})`}),s.jsx("ul",{className:"offenders",style:{fontSize:10,maxHeight:160},children:c.map((g,d)=>s.jsxs("li",{children:[g.url,g.from?` — from ${g.from}`:""]},d))})]})}if(!T&&b.id==="host-requests-initial"&&S&&S.files){const c=new Set;try{for(const w of u.references||[])w&&w.inZip&&w.normalized&&c.add(String(w.normalized).toLowerCase())}catch{}try{const w=(e=u==null?void 0:u.primary)==null?void 0:e.path;w&&c.add(String(w).toLowerCase())}catch{}const g=[],d=S.lowerCaseIndex||{};for(const w of Array.from(c)){const $=d[w]||w,P=((r=S.files[$])==null?void 0:r.byteLength)||0;g.push({path:$,size:P})}g.sort((w,$)=>w.path.localeCompare($.path));const f=w=>(Math.round(w/1024*10)/10).toFixed(1)+" KB";if(g.length>0)return s.jsxs("details",{style:{marginTop:4},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#4b5563"},children:`Details (${g.length})`}),s.jsx("ul",{className:"offenders",style:{fontSize:10,maxHeight:160},children:g.map((w,$)=>s.jsxs("li",{children:[w.path," — ",f(w.size)]},$))})]})}if(!T&&(b.id==="clicktag"||b.id==="border")){const c=Array.isArray(b.offenders)?b.offenders:[];if(c.length>0){const g=[...c];b.id==="clicktag"&&g.sort((f,w)=>{const $=P=>!P||!P.kind?0:P.kind==="aonclick"?1:P.kind==="ahref"?2:0;return $(f)-$(w)});const d=f=>{try{const w=/(window\.)?clicktag\d*|clickTag\d*/gi;return f.replace(w,$=>`<mark class="ct-hi">${$}</mark>`)}catch{return f}};return s.jsxs("details",{style:{marginTop:4},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#4b5563"},children:`Details (${g.length})`}),s.jsx("style",{children:".ct-hi{ background: transparent; color: #7c3aed; font-weight: 700; }"}),s.jsx("ul",{className:"offenders",style:{fontSize:10,maxHeight:160},children:g.map((f,w)=>s.jsxs("li",{children:[f.path,f.line?`:${f.line}`:"",f.detail?s.jsx("span",{dangerouslySetInnerHTML:{__html:" — "+(b.id==="clicktag"?d(String(f.detail)):String(f.detail))}}):null]},w))})]})}}return T?s.jsxs("details",{style:{marginTop:4},children:[s.jsx("summary",{style:{cursor:"pointer",fontSize:11,color:"#4b5563"},children:`${h} (${L.length})`}),s.jsx("ul",{className:"offenders",style:{fontSize:10,maxHeight:160},children:L.map((c,g)=>s.jsxs("li",{children:[c.path,c.detail?` — ${c.detail}`:""]},g))})]}):null})(),s.jsx("div",{className:"help",style:{right:6,top:6},children:s.jsx(St,{checkId:b.id,group:"optional"})})]},b.id))})]})},ai={textAlign:"left",padding:8,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},Ee={padding:8,verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};function rt(n){const a=n==="FAIL"?"badge fail":n==="WARN"?"badge warn":"badge pass";return s.jsx("span",{className:a,children:n})}function wt(n){return(Math.round(n/1024*10)/10).toFixed(1)+" KB"}function Ke(n){return String(n||"").replace(/\.zip$/i,"")}const ci=()=>{const{results:n}=Be(t=>({results:t.results}));if(n.length===0)return null;function a(t,l){var L;const u=l.utils.book_new(),m=[];for(const T of n){const M=(T.findings||[]).filter(A=>De.has(A.id)),h=M.some(A=>A.severity==="FAIL"||A.severity==="WARN");if(!(t==="failwarn"&&!h))for(const A of M){const e={Bundle:Ke(T.bundleName),Status:((L=T.summary)==null?void 0:L.status)||"",CheckID:A.id,Check:A.title,Severity:A.severity,Messages:(A.messages||[]).join(" | ")};if(!A.offenders||A.offenders.length===0)m.push({...e,OffenderPath:"",Detail:""});else for(const r of A.offenders)m.push({...e,OffenderPath:r.path||"",Detail:r.detail||""})}}m.length===0&&m.push({Bundle:"—",Status:"PASS",CheckID:"—",Check:"No Priority Issues",Severity:"PASS",Messages:"No issues in scope",OffenderPath:"",Detail:""});const v=l.utils.json_to_sheet(m);l.utils.book_append_sheet(u,v,"Table");const I=[],b=new Set;for(const T of Array.from(De)){const M=ot[T]||"",h=nt(T);!h.includes("CM360")&&!h.includes("IAB")||b.has(T)||(b.add(T),I.push({ID:T,Check:(Ie==null?void 0:Ie[T])||T,Source:h.join(", "),Guideline:M}))}const S=l.utils.json_to_sheet(I);return l.utils.book_append_sheet(u,S,"Guidelines"),u}async function o(t){const l=await ei(),u=a(t,l),m=t==="all"?"audits_all.xlsx":"audits_fail_warn.xlsx";l.writeFile(u,m)}return s.jsxs("div",{style:{display:"flex",gap:8},children:[s.jsx("button",{onClick:()=>void o("all"),className:"btn",children:"Download All Audits"}),s.jsx("button",{onClick:()=>void o("failwarn"),className:"btn primary",children:"Download FAIL/WARN Audits"})]})};function li(n){return String(n||"").replace(/[&<>]/g,a=>a==="&"?"&amp;":a==="<"?"&lt;":"&gt;")}function di(n){const a=u=>u.split("/").length,o=u=>/\/(index\.html?)$/i.test("/"+u),t=n.filter(o);return t.length?(t.sort((u,m)=>a(u)-a(m)||u.length-m.length),t[0]):[...n].sort((u,m)=>a(u)-a(m)||u.length-m.length)[0]}const ui={packaging:`Validates ZIP packaging: no nested archives or disallowed file types.

Why it matters: mispackaged zips are rejected by ad servers and creatives never leave trafficking.`,primaryAsset:`Detects main HTML file & required ad.size meta width/height.

Why it matters: without a primary file and declared size, ad servers cannot determine slot fit and will reject the creative.`,assetReferences:`Ensures all HTML/CSS referenced assets exist in the bundle.

Why it matters: missing assets render blanks that fail QA and waste impressions.`,orphanAssets:`Lists files not referenced by primary asset dependency graph.

Why it matters: unused assets inflate weight and can breach contractual caps.`,externalResources:`Flags external network references outside allowlist.

Why it matters: off-domain calls violate publisher policies and get placements denied.`,httpsOnly:`Requires all external references to use HTTPS.

Why it matters: insecure HTTP requests are blocked in secure frames, leaving the ad non-functional.`,"pkg-format":`ZIP packaging format: upload is a .zip/.adz with a normal folder structure and no nested archives.

Why it matters: nested zips and wrapper folders are rejected by CM360 and most exchanges, blocking ingestion.`,"entry-html":`Entry HTML: exactly one top-level HTML file acts as the creative’s start file; all other files are referenced from it.

Why it matters: multiple or missing entry files confuse ad servers and can cause blank or rejected uploads.`,"allowed-ext":`Allowed file types: only typical creative extensions (html, htm, js, css, json, images, fonts, svg) are included.

Why it matters: unusual or executable types trip security scanners and get uploads quarantined or denied.`,"file-limits":`File count and ZIP size: keep total files ≤ 100 and compressed ZIP ≤ 10 MB (CM360 defaults).

Why it matters: exceeding intake caps slows QA and often blocks upload or serving.`,clickTags:`Detects clickTag variables / exit APIs and hard-coded navigations.

Why it matters: broken exit plumbing stops click tracking and campaign billing.`,clicktag:`Clickthrough plumbing: a global clickTag is defined and used for navigation (e.g., window.open(clickTag)).

Why it matters: without clickTag, exits can’t be tracked or trafficked correctly and creatives are rejected.`,gwdEnvironment:`Identifies Google Web Designer runtime artifacts.

Why it matters: leftover runtime can conflict with host pages and bloat load times.`,iabWeight:`Compares initial/polite & compressed weights to the standard IAB display budgets.

Why it matters: overweight assets violate buyer contracts and get paused by ad servers.`,iabRequests:`Counts initial load asset requests vs the configured cap.

Why it matters: excessive requests drag render performance and fail certification.`,systemArtifacts:`OS metadata (Thumbs.db, .DS_Store) / __MACOSX entries.

Why it matters: scanning tools flag these as contamination and block uploads.`,hardcodedClickUrl:`Hard-coded absolute clickthrough URL(s) in code/markup.

Why it matters: bypassing macros removes tracking and causes trafficking rejections.`,animDuration:`Heuristic scan of CSS animation/transition durations.

Why it matters: overly long motion breaks brand rules and triggers QA escalations.`,cssEmbedded:`Inline CSS usage (style tags/attributes).

Why it matters: heavy inline styling inflates HTML size and complicates dynamic QA edits.`,minified:`Heuristic detection of minified JS/CSS files.

Why it matters: unminified code increases payload and can push creatives over weight limits.`,dialogs:`alert/confirm/prompt usage inside creative.

Why it matters: disruptive dialogs violate platform policies and will be blocked.`,cookies:`document.cookie writes detected in runtime.

Why it matters: unmanaged cookies can violate privacy policies and trigger compliance holds.`,localStorage:`localStorage writes detected in runtime.

Why it matters: storage usage may be disallowed by partners and requires disclosure.`,"no-webstorage":`No Web Storage/DB APIs: avoid localStorage, sessionStorage, IndexedDB, or WebSQL (openDatabase).

Why it matters: storage access is commonly disallowed and can trigger policy violations or rejections.`,timing:`DOMContentLoaded, time to render, frames observed.

Why it matters: slow render metrics predict viewability issues and heavy-ad interventions.`,timeToRender:`Time to first visible render of the ad; < 500 ms is recommended.

Why it matters: delayed first paint hurts viewability guarantees.`,measurement:`Known analytics/measurement host references.

Why it matters: stacking trackers raises privacy concerns and can be blocked by supply partners.`,domContentLoaded:`DOMContentLoaded budget.

Why it matters: exceeding ~1s signals heavy creatives that partners can reject.`,html5lib:`Common creative libraries detected (CreateJS, GSAP, Pixi, jQuery).

Why it matters: knowing libraries helps validate licensing and optimization plans.`,video:`Video asset(s) in bundle.

Why it matters: video placements enforce extra specs, so trafficking must attach the correct serving settings.`,iframes:`Iframe tags in markup.

Why it matters: creatives are served inside secure iframes/SafeFrame; nested frames are often disallowed and can break integrations.`,"iframe-safe":`Iframe-safe behavior: no attempts to access parent/top windows or document.domain at runtime.

Why it matters: cross-frame access is blocked in secure placements and will break or be flagged by CM360.`,imagesOptimized:`Potentially large images to optimize (heuristic).

Why it matters: oversized imagery drives weight over limits and slows load times.`,indexFile:`index.html presence at root.

Why it matters: This is the de facto standard entry point for HTML5 creatives. CM360 typically expects index.html for ZIP ingestion. The Trade Desk lets you choose a primary file, but index.html is recommended for automation. IAB specs do not strictly mandate index.html, but most ad servers and workflows assume it.`,hostedSize:`Total uncompressed size of files.

Why it matters: large payloads exceed ad server caps and may be auto-throttled.`,cpuUsage:`Long tasks total (first 3s) budget.

Why it matters: high CPU usage triggers heavy-ad rules and throttles delivery.`,memoryUsage:`Peak JS heap usage budget.

Why it matters: memory spikes crash host pages and get creatives blacklisted.`,perfHeuristics:`Advisory signal from preview-only measurements (CPU jitter, JS heap).

Why it matters: sustained main‑thread blocking or memory spikes can trigger heavy‑ad throttling and hurt viewability. Treat as a hint; confirm on standardized hardware if gating.`,syntaxErrors:`Uncaught runtime errors during preview.

Why it matters: crashing scripts show blanks and result in automatic takedowns.`,docWrite:`document.write calls used.

Why it matters: document.write is blocked in most modern ad slots, preventing any render.`,jquery:`jQuery presence detected.

Why it matters: heavy frameworks inflate payloads and are banned in many lightweight placements.`,backup:`Backup image presence (heuristic).

Why it matters: without a backup image, fallback delivery fails and impressions are lost.`,hostedCount:`Count of files in bundle.

Why it matters: excessive files complicate QA and can push weight budgets over limits.`,fileTypes:`File types outside a conservative allowlist.

Why it matters: unusual file types trip security scans and block approvals.`,creativeBorder:`Presence of border styles (heuristic).

Why it matters: missing borders violate spec requirements for publisher separation.`,creativeRendered:`Render activity observed during preview.

Why it matters: confirming render ensures the creative will not serve blank in production.`,networkDynamic:`Runtime fetch/XHR requests detected.

Why it matters: unexpected calls breach data policies and raise monitoring alerts.`,heavyAdRisk:`Risk indicator from initial size/CPU jitter.

Why it matters: creatives flagged heavy are throttled or unloaded by Chrome and major DSPs.`,imageMeta:`Image metadata (dimensions/size).

Why it matters: quick audit confirms assets meet spec prior to trafficking.`,videoMeta:`Video metadata (dimensions/duration/size).

Why it matters: ensures motion assets align with placement length and resolution requirements.`,audioMeta:`Audio metadata (duration/size).

Why it matters: audio assets must meet rich-media specs to avoid rejection.`,"host-requests-initial":`Initial Host Requests is the number of files the ad loads immediately from the entry HTML (HTML, CSS, JS, images, fonts, etc.). The IAB guideline is to keep this count at 10 or fewer.

Why it matters: While an ad with more than 10 calls can still run, many exchanges and publishers enforce this guideline through QA tools and policies. Exceeding it often leads to slower initial load and a higher risk of warnings or rejection.`,"cpu-budget":`Keep main-thread busy time ≤ 30% in the first 3s (via Long Tasks) per IAB guidance.

Why it matters: excessive main-thread blocking triggers heavy-ad throttling.`,"animation-cap":`Animation must be ≤ 15s total or ≤ 3 loops under the IAB display standard.

Why it matters: long/looping motion violates common IAB/publisher specs.`,border:`A visible 1px border/keyline must be present per IAB display guidance.

Why it matters: borders visually separate ads from page content per spec.`,"invalid-url-ref":`Broken or invalid URL references (including absolute non-packaged paths).

Why it matters: missing or malformed URLs break loads and cause blanks.`,"orphaned-assets":`Files in the ZIP that are not referenced by the entry HTML.

Why it matters: unused files inflate weight and complicate QA.`,"bad-filenames":`Filenames and naming: avoid disallowed characters and ensure the ZIP file name includes the creative dimensions (e.g., 300x250).

Why it matters: problematic names break ad servers and missing size tokens in the ZIP make trafficking harder.`,"invalid-markup":`Heuristic HTML/CSS/SVG syntax validation.

Why it matters: invalid markup can render inconsistently or be blocked by sanitizers.`,"gwd-env-check":`Detects Google Web Designer environment artifacts.

Why it matters: leftover environment code can conflict with host pages.`,"hardcoded-click":`Hard-coded clickthrough detected (bypasses clickTag).

Why it matters: breaks exit tracking and trafficking rules.`},St=({checkId:n,group:a="optional"})=>{const[o,t]=_e.useState(!1),l=ui[n]||"";function u(S){return S.replace(/\bmust\b/gi,"should").replace(/\bis required\b/gi,"is typically expected").replace(/\brequires\b/gi,"typically requires").replace(/\bwill be\b/gi,"can be").replace(/\bwill\b/gi,"can").replace(/\bare rejected\b/gi,"may be rejected").replace(/\bare blocked\b/gi,"may be blocked").replace(/\bare disallowed\b/gi,"may not be allowed").replace(/\bviolates\b/gi,"may violate").replace(/\bresults in\b/gi,"can result in")}const m="why it matters:";let v=l,I="";if(l){const S=l.toLowerCase().indexOf(m);S>=0&&(v=l.slice(0,S).trim(),I=l.slice(S+m.length).trim())}if(!v){const S=ot[n];v=S?S.replace(/^.*?:\s*/,""):(Ie==null?void 0:Ie[n])||n}I||(I=a==="optional"?"Improving this can enhance reliability or performance and reduce the chance of policy friction.":"Issues here can cause delivery problems or lead to platform rejections."),a==="optional"&&I&&(I=u(I));const b=[v,`Why it matters: ${I}`].filter(Boolean).join(`

`);return s.jsxs("span",{style:{position:"relative",display:"inline-block"},onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),children:[s.jsx("button",{type:"button","aria-label":`Help for ${n}`,onClick:()=>t(S=>!S),className:"btn",style:{width:20,height:20,borderRadius:999,padding:0},children:"?"}),o&&s.jsx("div",{role:"tooltip",className:"tip",style:{position:"absolute",top:"50%",right:"110%",transform:"translateY(-50%)",zIndex:100,pointerEvents:"auto",whiteSpace:"pre-wrap",maxWidth:420},children:b})]})},kt=new Set(["bad-filenames","clicktag","entry-html","file-limits","host-requests-initial","no-backup-in-zip","relative-refs","pkg-format","animation-cap","cpu-budget","border","gwd-env-check","invalid-url-ref","orphaned-assets","invalid-markup","hardcoded-click","minified","packaging","primaryAsset","assetReferences","externalResources","httpsOnly","iabWeight","iabRequests","systemArtifacts","syntaxErrors","creativeRendered","no-document-write","indexFile","dialogs","domContentLoaded","timeToRender","measurement","html5lib","imagesOptimized","hostedSize","jquery","backup","iframes","networkDynamic","heavyAdRisk","memoryUsage","hostedCount","packaging","primaryAsset","assetReferences","externalResources","httpsOnly","clickTags","systemArtifacts","indexFile","creativeRendered","docWrite","syntaxErrors","pkg-format","entry-html","file-limits","allowed-ext","iframe-safe","clicktag","no-webstorage","no-backup-in-zip","relative-refs","no-document-write","bad-filenames"]),At=new Set(["iabWeight","iabRequests","host-requests-initial","cpu-budget","animation-cap","border"]);function nt(n){const a=At.has(n),o=kt.has(n);return a&&o?["IAB","CM360"]:a?["IAB"]:o?["CM360"]:["H5"]}const ot={iabWeight:"IAB: Ad weight budgets (initial/polite/zip) per configured settings. Exceeding caps fails.","host-requests-initial":"IAB: Initial host requests ≤ 10.","cpu-budget":"IAB: Main-thread busy ≤ 30% in first 3 seconds (Long Tasks ≤ 900ms).","animation-cap":"IAB: Animation length ≤ 15s or ≤ 3 loops (infinite loops not allowed).",border:"IAB: A visible 1px border or keyline is required.",packaging:"CM360: ZIP packaging, no nested archives or OS artifacts.",primaryAsset:"CM360: One primary HTML with declared size (ad.size meta).",assetReferences:"CM360: All referenced files must exist in the ZIP.",externalResources:"CM360: No disallowed off-domain references.",httpsOnly:"CM360: All external requests must use HTTPS.",clickTags:"CM360: Click-through configured via clickTag/exit API; no hard-coded destinations.",systemArtifacts:"CM360: No OS/system artifacts in ZIP.",indexFile:"CM360: Root entry HTML present (name is flexible; one entry required).",creativeRendered:"CM360: Creative must render successfully.",docWrite:"CM360: Do not use document.write in runtime.",syntaxErrors:"CM360: No uncaught runtime errors during load.","pkg-format":"CM360: Upload is ZIP/ADZ; no nested .zip/.adz.","entry-html":"CM360: Exactly one root entry HTML; all other files referenced by it.","file-limits":"CM360: ≤ 100 files and ≤ 10 MB upload (compressed).","allowed-ext":"CM360: Only typical creative extensions allowed (html, js, css, images, fonts, etc.).","iframe-safe":"CM360: No cross-frame DOM access (parent/top/document.domain).",clicktag:"CM360: Global clickTag present and used via window.open(clickTag).","no-webstorage":"CM360: Do not reference Web Storage APIs (localStorage/sessionStorage), IndexedDB, or WebSQL (openDatabase).","no-backup-in-zip":"CM360 (recommended): Do not include backup image in the ZIP.","relative-refs":"CM360 (recommended): Use relative paths for packaged assets.","no-document-write":"CM360 (recommended): Avoid document.write usage.","invalid-url-ref":"H5: Broken/invalid references and absolute non-packaged paths are disallowed.","orphaned-assets":"H5: Files not referenced by the entry file should be removed.","bad-filenames":"CM360: Filenames should avoid disallowed characters, and the ZIP filename must include the creative dimensions (e.g., 300x250).","invalid-markup":"H5: HTML/SVG must parse without errors; CSS braces should be balanced.","gwd-env-check":"H5: Google Web Designer environment artifacts may cause conflicts.","hardcoded-click":"H5: Hard-coded clickthroughs bypass tracking; use clickTag.",minified:"H5: JS/CSS should be minified in production.",cssEmbedded:"H5: Inline CSS is allowed but keep minimal; prefer external CSS.",dialogs:"H5: Avoid alert/confirm/prompt in creatives.",domContentLoaded:"H5: DOMContentLoaded target < 1000ms.",timeToRender:"H5: Time to first render < 500ms is recommended.",measurement:"H5: Minimize tracker/measurement hosts.",html5lib:"H5: Library use (CreateJS/GSAP/jQuery/etc.) flagged for awareness.",imagesOptimized:"H5: Optimize large images (PNG → JPEG/WebP where reasonable).",hostedSize:"H5: Total uncompressed size should meet partner limits.",jquery:"H5: Consider avoiding jQuery in lightweight placements.",iframes:"H5: Avoid nested iframes in creatives.",networkDynamic:"H5: Avoid unexpected runtime network calls.",heavyAdRisk:"H5: Large initial size or CPU jitter may trigger heavy-ad intervention.",memoryUsage:"H5: Peak JS heap < 10 MB on test hardware.",hostedCount:"H5: Keep file count practical for QA and packaging.",video:"H5: Video assets require appropriate spec handling.",timing:"H5: Reported timing metrics from preview.",imageMeta:"H5: Image metadata diagnostics (dimensions/size).",videoMeta:"H5: Video metadata diagnostics.",audioMeta:"H5: Audio metadata diagnostics."},jt=({checkId:n})=>{const a=nt(n),o=ot[n]||"No spec text available.",t=At.has(n);kt.has(n);const l=b=>b.replace(/^IAB(?:\s*\([^)]*\))?:\s*/i,"");function u(b){if(b==="CM360"){if(t)return`CM360: Aligns with IAB for this check.

${l(o)}`;const S=l(o);return S.startsWith("CM360:")?S:`CM360: ${S}`}return b==="IAB"?/^IAB(?:\s*\([^)]*\))?:\s*/i.test(o)?o:`IAB: ${o}`:o}const m={display:"inline-block",padding:"1px 6px",borderRadius:6,fontSize:10,fontWeight:700,border:"1px solid var(--border)",color:"#6b7280",background:"rgba(255,255,255,0.02)"},v={display:"inline-flex",gap:6,alignItems:"center"},I=b=>b==="IAB"?"#0ea5e9":b==="CM360"?"#22c55e":"#a855f7";return s.jsx("span",{style:v,children:a.map((b,S)=>s.jsx("span",{className:"spec-badge",title:u(b),style:{...m,borderColor:I(b),color:I(b)},children:b},S))})},Mt=({explanation:n,why:a,stopClickPropagation:o})=>{const[t,l]=_e.useState(!1);return s.jsxs("span",{style:{position:"relative",display:"inline-block"},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[s.jsx("button",{type:"button","aria-label":"Section info",className:"btn",onClick:u=>{o&&u.stopPropagation(),l(m=>!m)},style:{width:20,height:20,borderRadius:999,padding:0},children:"?"}),t&&s.jsxs("div",{role:"tooltip",className:"tip",style:{position:"absolute",top:"calc(100% + 8px)",left:"110%",transform:"none",zIndex:100,pointerEvents:"auto",width:260,background:"var(--panel-2)",color:"var(--text)",padding:10,borderRadius:10,fontSize:11,boxShadow:"var(--shadow)",whiteSpace:"pre-line",border:"1px solid var(--border)"},children:[n,`

`,`Why it matters: ${a}`]})]})};export{pi as ExtendedResults};
