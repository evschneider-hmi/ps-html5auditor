import{r as i,j as e}from"./index-Dykb5sAM.js";import{u as j}from"./ExtendedHome-Bj2mkDZV.js";import{p as R,H as _}from"./bulk-QCl06fV8.js";const C=5,H={minHeight:120,fontFamily:"monospace",fontSize:12,background:"var(--surface)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:6,padding:8},w={fontFamily:"monospace",fontSize:11,minHeight:80,background:"var(--surface-2)",color:"var(--text)",padding:6,borderRadius:6,border:"1px solid var(--border)"},I={width:"100%",height:300,border:"1px solid var(--border)",borderRadius:6},W=()=>{const[l,u]=i.useState(""),[k,f]=i.useState([]),[A,x]=i.useState([]),v=i.useRef(null),g=j(t=>t.setVastSeed),E=j(t=>t.tagSeed),V=j(t=>t.setTagSeed);i.useEffect(()=>{try{const t=E;t&&typeof t=="string"&&(u(t),V(void 0))}catch{}},[]),i.useEffect(()=>{f([]),x([])},[l]);const n=i.useMemo(()=>R(l),[l]),d=n.length>1,h=i.useMemo(()=>{const t=[];for(const s of _)n.some(r=>r.params[s])&&t.push(s);return t.slice(0,C)},[n]);function S(){if(f([]),x([]),d)return;const t=(l||"").trim(),s=t.startsWith("<"),r=/<\s*VAST[\s>]/i.test(t),o=/^https?:\/\/[^\s]+\.(xml)(\?|#|$)/i.test(t)||/^https?:\/\//i.test(t)&&/vast|adtag|adtaguri/i.test(t);if(s&&r||o){try{g(s?{mode:"xml",value:t}:{mode:"url",value:t})}catch{}try{const a=Array.from(document.querySelectorAll(".tabs .tab")).find(c=>{var m;return((m=c.textContent)==null?void 0:m.trim())==="VAST"});a==null||a.click()}catch{}return}const y=`<html><head><meta charset='utf-8'><title>Tag</title></head><body>${t}</body></html>`,p=v.current;p&&(p.srcdoc=y)}function b(t){if(t.type==="VAST XML"||t.type==="VAST URL"){try{g(t.type==="VAST XML"?{mode:"xml",value:t.raw}:{mode:"url",value:t.raw})}catch{}try{const s=Array.from(document.querySelectorAll(".tabs .tab")).find(r=>{var o;return((o=r.textContent)==null?void 0:o.trim())==="VAST"});s==null||s.click()}catch{}}else t.type==="Ad Tag"&&(u(t.raw),setTimeout(()=>S(),0))}return i.useEffect(()=>{function t(s){const r=s.data;r&&r.__tag_test&&(r.kind==="error"&&f(o=>[...o,r.text]),r.kind==="info"&&x(o=>[...o,r.text]))}return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[]),e.jsx("div",{children:e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("textarea",{value:l,onChange:t=>u(t.target.value),onPaste:t=>{var a;const r=(((a=t.clipboardData)==null?void 0:a.getData("text"))||"").trim();if(!r)return;const o=r.startsWith("<"),y=/<\s*VAST[\s>]/i.test(r),p=/^https?:\/\/[^\s]+\.(xml)(\?|#|$)/i.test(r)||/^https?:\/\//i.test(r)&&/vast|adtag|adtaguri/i.test(r);if(o&&y||p){t.preventDefault();try{g(o?{mode:"xml",value:r}:{mode:"url",value:r})}catch{}try{const c=Array.from(document.querySelectorAll(".tabs .tab")).find(m=>{var T;return((T=m.textContent)==null?void 0:T.trim())==="VAST"});c==null||c.click()}catch{}return}},placeholder:"Paste your ad tag here (single or multiple lines)",style:H}),e.jsx("div",{style:{display:"flex",gap:8},children:e.jsx("button",{onClick:S,className:"btn primary",children:d?"Parse List":"Run Tag"})}),d&&e.jsxs("div",{className:"panel",style:{padding:8},children:[e.jsxs("div",{style:{fontSize:12,fontWeight:700,marginBottom:6},children:["Detected ",n.length," tags"]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Vendor"}),e.jsx("th",{children:"Host"}),h.map(t=>e.jsx("th",{children:t.toUpperCase()},t)),e.jsx("th",{children:"Other Params"})]})}),e.jsxs("tbody",{children:[n.map(t=>e.jsxs("tr",{role:"button",tabIndex:0,onClick:()=>b(t),onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),b(t))},style:{cursor:"pointer"},children:[e.jsx("td",{children:t.i}),e.jsx("td",{children:t.type}),e.jsx("td",{children:t.vendor}),e.jsx("td",{children:t.host||"-"}),h.map(s=>e.jsx("td",{children:t.params[s]||"-"},s)),e.jsx("td",{style:{maxWidth:520,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(()=>{const s=Object.entries(t.params).filter(([r])=>!h.includes(r)).slice(0,6).map(([r,o])=>`${r}=${o}`);return s.length?s.join("  "):"-"})()})]},t.i)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5+h.length,style:{fontStyle:"italic",color:"#6b7280"},children:"No entries parsed"})})]})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Errors"}),e.jsx("ul",{style:w,children:k.map((t,s)=>e.jsx("li",{children:t},s))})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,fontWeight:700},children:"Info"}),e.jsx("ul",{style:w,children:A.map((t,s)=>e.jsx("li",{children:t},s))})]})]}),!d&&e.jsx("iframe",{ref:v,title:"Tag Preview",sandbox:"allow-scripts allow-same-origin allow-popups",srcDoc:`<html><body><script>(()=>{ try{ const p=(m)=>parent.postMessage({__tag_test:1, ...m}, '*');
    const origErr = window.onerror; window.onerror=(msg)=>{ p({kind:'error', text:String(msg)}); if(origErr) try{origErr.apply(this, arguments);}catch{} };
    setTimeout(()=>{ try{ const hasCT = (typeof (window as any).clickTag==='string') || (typeof (window as any).clickTAG==='string'); p({kind:'info', text: 'clickTag present: '+hasCT}); }catch(e){} }, 50);
  }catch(e){ parent.postMessage({__tag_test:1, kind:'error', text:String(e)}, '*'); } })();<\/script></body></html>`,style:I})]})})};export{W as TagTester};
