import{r as d,j as r}from"./index-Dykb5sAM.js";import{J as T}from"./jszip.min-CwPCxiH3.js";import{u as v}from"./ExtendedHome-Bj2mkDZV.js";const $=({mode:t})=>{const b=v(e=>e.addBundle),S=v(e=>e.setTab),j=v(e=>e.setVastAutoPayload),i=d.useRef(null),k=d.useId(),[C,m]=d.useState(!1),[D,g]=d.useState(""),[E,n]=d.useState(!1),w=t==="zip"?".zip":t==="video"?"video/*":t==="image"?"image/*":"audio/*";async function y(e){if(!(!e||!e.length)){m(!0),g("");try{const o=Array.from(e);for(const a of o)if(t==="zip"){if(!/\.zip$/i.test(a.name)){g(c=>c?c+`
${a.name} is not a .zip`:`${a.name} is not a .zip`);continue}const s=new Uint8Array(await a.arrayBuffer()),l=await T.loadAsync(s),p={},u={},x=Object.keys(l.files);let z=!1;for(const c of x){const h=l.file(c);if(!h||h.dir)continue;const R=new Uint8Array(await h.async("uint8array")),f=c.replace(/^\/+/,"");p[f]=R,u[f.toLowerCase()]=f,/\.(xlsx|xlsm|xlsb|xls|csv)$/i.test(f)&&(z=!0)}const A={id:String(Date.now())+Math.random().toString(36).slice(2),name:a.name,bytes:s,files:p,lowerCaseIndex:u};if(b({...A,mode:t}),z){try{j(s)}catch{}try{S("vast")}catch{}}}else{const s=new Uint8Array(await a.arrayBuffer()),l=a.name,p={[l]:s},u={[l.toLowerCase()]:l},x={id:String(Date.now())+Math.random().toString(36).slice(2),name:a.name,bytes:s,files:p,lowerCaseIndex:u};b({...x,mode:t})}}catch(o){g(o.message||"Failed to read file")}finally{m(!1)}}}function I(){if(i.current){try{i.current.value=""}catch{}i.current.click()}}return r.jsxs("div",{role:"button",tabIndex:0,"aria-label":`Upload ${t.toUpperCase()} files`,"data-testid":"dropzone",onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),I())},onDragOver:e=>{e.preventDefault(),n(!0)},onDragEnter:e=>{e.preventDefault(),n(!0)},onDragLeave:e=>{e.preventDefault(),n(!1)},onDrop:e=>{if(e.preventDefault(),n(!1),i.current)try{i.current.value=""}catch{}y(e.dataTransfer.files)},style:{border:"2px dashed var(--border)",borderRadius:12,padding:t==="zip"?32:20,minHeight:t==="zip"?320:180,background:E?"var(--surface-2)":"var(--surface)",color:"var(--text)",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",position:"relative",cursor:"pointer",outline:"none",transition:"background 120ms ease, border-color 120ms ease",userSelect:"none"},children:[r.jsx("style",{children:`
        @keyframes ext-spinner {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `}),C&&r.jsxs("div",{role:"status","aria-live":"polite",style:{position:"absolute",top:t==="zip"?18:12,right:t==="zip"?18:12,display:"flex",alignItems:"center",gap:10,padding:"8px 12px",borderRadius:999,background:"rgba(99, 102, 241, 0.18)",color:"#4338ca",boxShadow:"0 8px 18px rgba(79, 70, 229, 0.18)",pointerEvents:"none",zIndex:5,fontSize:12,fontWeight:600},children:[r.jsx("span",{style:{width:22,height:22,borderRadius:"50%",border:"3px solid rgba(165, 180, 252, 0.28)",borderTopColor:"#7c3aed",borderRightColor:"#7c3aed",animation:"ext-spinner 0.9s linear infinite"},"aria-hidden":"true"}),r.jsx("span",{children:"Uploading..."})]}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:t==="zip"?16:14,fontWeight:700,marginBottom:6},children:["Drop ",t.toUpperCase()," here or click anywhere to choose files"]}),r.jsxs("div",{style:{fontSize:12,opacity:.8},children:["Accept: ",w,t==="zip"?" (multiple allowed)":""]}),r.jsx("div",{style:{marginTop:10},children:r.jsx("div",{"aria-hidden":"true",style:{display:"inline-flex",alignItems:"center",gap:8,padding:"8px 12px",borderRadius:8,background:"var(--accent)",color:"white",fontSize:12,fontWeight:600,boxShadow:"0 2px 8px rgba(0,0,0,0.12)",pointerEvents:"none",userSelect:"none"},children:"Upload ZIP files"})}),r.jsx("input",{ref:i,type:"file",id:k,"data-testid":"file-input",accept:w,multiple:t==="zip",onClick:e=>{try{e.currentTarget.value=""}catch{}},onChange:e=>void y(e.target.files),onDragOver:e=>{e.preventDefault(),n(!0)},onDragEnter:e=>{e.preventDefault(),n(!0)},onDragLeave:e=>{e.preventDefault(),n(!1)},onDrop:e=>{var o;e.preventDefault(),n(!1);try{e.currentTarget.value=""}catch{}y(((o=e.dataTransfer)==null?void 0:o.files)??null)},style:{position:"absolute",inset:0,width:"100%",height:"100%",opacity:0,cursor:"pointer",zIndex:5}}),D&&r.jsx("div",{style:{fontSize:12,color:"#b91c1c",marginTop:8},children:D})]})]})};export{$ as ExtendedDropZone};
